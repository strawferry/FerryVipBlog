<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>App 打包构建系统</title>
    <url>/2019/06/03/App%20%E6%89%93%E5%8C%85%E6%9E%84%E5%BB%BA%E7%B3%BB%E7%BB%9F/</url>
    <content><![CDATA[<h1 id="App-打包构建系统"><a href="#App-打包构建系统" class="headerlink" title="App 打包构建系统"></a>App 打包构建系统</h1><h2 id="0-由来"><a href="#0-由来" class="headerlink" title="0. 由来"></a>0. 由来</h2><p>根据开发测试等实际应用需求设计了一套打包构建系统,系统包括以下主要功能:</p>
<ol>
<li>App 多环境打包;</li>
<li>App 自动发布热更新;</li>
<li>App 管理托管;</li>
</ol>
<hr>
<p>系统的基本组成:</p>
<ol>
<li>通过 Jenkins 来做打包,热更新推包,自动测试服务;</li>
<li>应用打包完成上传到蒲公英,并把蒲公英上的下载地址等信息通过自建的 Node 服务做应用的托管,这样我们就可以在 Node 中对应用做相应的管理操作;</li>
<li>热更新推包后,我们记录相应的数据后,也记录到 Node 服务中,这样我们也可以在 Node 服务中对热更新做出查看或者撤回更新等操作;</li>
</ol>
<blockquote>
<p><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1g540zcsjwrj22aw1akjzc.jpg"></p>
</blockquote>
<h2 id="打包对比"><a href="#打包对比" class="headerlink" title="打包对比"></a>打包对比</h2><p><strong>手动打包 VS 自动打包</strong></p>
<table>
<thead>
<tr>
<th align="center">手动打包</th>
<th align="center">自动打包</th>
</tr>
</thead>
<tbody><tr>
<td align="center">耗时长,效率低;</td>
<td align="center">自动化打包,解放双手;</td>
</tr>
<tr>
<td align="center">重复性多,人工成本高;</td>
<td align="center">配置好后,一键操作;</td>
</tr>
<tr>
<td align="center">出错性概率大;</td>
<td align="center">可配置一键远程打包;</td>
</tr>
</tbody></table>
<h2 id="1-主要功能点"><a href="#1-主要功能点" class="headerlink" title="1. 主要功能点"></a>1. 主要功能点</h2><blockquote>
<p><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1g540zcc9ggj22b41b079q.jpg"><br><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1g540zd6a0vj22as1ag43c.jpg"><br><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1g540zdcck5j22as1aejwy.jpg"><br><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1g540zd226hj22ay1ag447.jpg"><br><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1g540zcz0t8j22aq1aoq9k.jpg"></p>
</blockquote>
<h2 id="2-主要实现点"><a href="#2-主要实现点" class="headerlink" title="2. 主要实现点"></a>2. 主要实现点</h2><blockquote>
<p><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1g540zd2vfnj22ao1asai0.jpg"></p>
</blockquote>
]]></content>
  </entry>
  <entry>
    <title>CJS、AMD、UMD和ESM规范</title>
    <url>/2021/12/02/CJS%E3%80%81AMD%E3%80%81UMD%E5%92%8CESM%E8%A7%84%E8%8C%83/</url>
    <content><![CDATA[<h2 id="1-常用的文件类型规范"><a href="#1-常用的文件类型规范" class="headerlink" title="1. 常用的文件类型规范"></a>1. 常用的文件类型规范</h2><ul>
<li>客户端基本上都是ES的开发规范;</li>
<li>nodejs服务端项目基本上都是CJS的开发规范;</li>
<li>近两年的nestjs框架才让服务端出现了ES的文件类型;</li>
</ul>
<h2 id="2-介绍"><a href="#2-介绍" class="headerlink" title="2. 介绍"></a>2. 介绍</h2><h3 id="1-CJS"><a href="#1-CJS" class="headerlink" title="1. CJS"></a>1. CJS</h3><p>CJS 是 CommonJS的缩写，通过 module|require 来导入导出：</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// importing </span></span><br><span class="line"><span class="keyword">const</span> doSomething = <span class="built_in">require</span>(<span class="string">&#x27;./doSomething.js&#x27;</span>); </span><br><span class="line"></span><br><span class="line"><span class="comment">// exporting </span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="keyword">function</span> <span class="title function_">doSomething</span>(<span class="params">n</span>) &#123;</span><br><span class="line"><span class="comment">// do something </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>CJS通常是在Node中、Node服务端框架中。</li>
<li>CJS是同步导入模块</li>
<li>你可以从node-modules中引入一个库或者从本地目录引入一个文件</li>
<li>CJS不能在浏览器中工作，它必须经过转换和打包</li>
<li>CJS的输出是运行时加载，输出的内容是值的拷贝而不是值的引用。</li>
</ul>
<h3 id="2-AMD"><a href="#2-AMD" class="headerlink" title="2. AMD"></a>2. AMD</h3><p>AMD代表异步模块定义</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="title function_">define</span>([<span class="string">&#x27;dep1&#x27;</span>, <span class="string">&#x27;dep2&#x27;</span>], <span class="keyword">function</span> (<span class="params">dep1, dep2</span>) &#123; </span><br><span class="line"><span class="comment">//Define the module value by returning a value. </span></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;&#125;; </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li>AMD 是异步(asynchronously)导入模块的(因此得名)</li>
<li>一开始被提议的时候，AMD 是为前端而做的(而 CJS 是后端)</li>
<li>AMD 的语法不如 CJS 直观。</li>
</ul>
<h3 id="3-UMD"><a href="#3-UMD" class="headerlink" title="3. UMD"></a>3. UMD</h3><p>UMD 代表通用模块定义（Universal Module Definition）</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">(<span class="keyword">function</span> (<span class="params">root, factory</span>) &#123; </span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> define === <span class="string">&quot;function&quot;</span> &amp;&amp; define.<span class="property">amd</span>) &#123; </span><br><span class="line">        <span class="title function_">define</span>([<span class="string">&quot;jquery&quot;</span>, <span class="string">&quot;underscore&quot;</span>], factory); </span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="built_in">exports</span> === <span class="string">&quot;object&quot;</span>) &#123; </span><br><span class="line">        <span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title function_">factory</span>(<span class="built_in">require</span>(<span class="string">&quot;jquery&quot;</span>), <span class="built_in">require</span>(<span class="string">&quot;underscore&quot;</span>)); </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123; </span><br><span class="line">        root.<span class="property">Requester</span> = <span class="title function_">factory</span>(root.<span class="property">$</span>, root.<span class="property">_</span>); </span><br><span class="line">    &#125; </span><br><span class="line">&#125;(<span class="variable language_">this</span>, <span class="keyword">function</span> (<span class="params">$, _</span>) &#123; </span><br><span class="line">    <span class="comment">// this is where I defined my module implementation var Requester = &#123; // ... &#125;; return Requester; </span></span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure>
<ul>
<li>在前端和后端都适用（“通用”因此得名）</li>
<li>与 CJS 或 AMD 不同，UMD 更像是一种配置多个模块系统的模式。这里可以找到更多的模式</li>
<li>当使用 Rollup&#x2F;Webpack 之类的打包器时，UMD 通常用作备用模块</li>
<li>UMD先判断支持Node.js的模块（exports）是否存在，存在则使用Node.js模块模式。再判断是否支持AMD（define是否存在），存在则使用AMD方式加载模块。都不行就挂载到 window 全局对象上面去</li>
</ul>
<h3 id="4-ESM"><a href="#4-ESM" class="headerlink" title="4. ESM"></a>4. ESM</h3><p>ESM 代表 ES 模块。这是 Javascript 提出的实现一个标准模块系统的方案。<br>我相信你们很多人都看到过这个:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"> </span><br><span class="line"> <span class="comment">//or</span></span><br><span class="line"> </span><br><span class="line"> <span class="keyword">import</span> &#123;useState,useEffect&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"> </span><br><span class="line"> <span class="comment">//or</span></span><br><span class="line"> </span><br><span class="line"> <span class="keyword">const</span> <span class="title function_">demo</span>=(<span class="params"></span>)=&gt; <span class="number">1</span>;</span><br><span class="line"> <span class="keyword">export</span> <span class="keyword">default</span> demo;</span><br><span class="line"> <span class="comment">//or</span></span><br><span class="line"> <span class="keyword">export</span> &#123;demo&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>在很多<span class="exturl" data-url="aHR0cHM6Ly9saW5rLmp1ZWppbi5jbi8/dGFyZ2V0PWh0dHBzOi8vY2FuaXVzZS5jb20vZXM2LW1vZHVsZQ==">现代浏览器<i class="fa fa-external-link-alt"></i></span>可以使用</li>
<li>它兼具两方面的优点：具有 CJS 的简单语法和 AMD 的异步</li>
<li>ESM是编译时输出接口，输出的是值得引用。</li>
<li>ES6 模块不是对象，而是通过 export命令显式指定输出的代码，import时采用静态命令的形式。JS 引擎对脚本静态分析的时候，遇到模块加载命令import，就会生成一个只读引用。等到脚本真正执行时，再根据这个只读引用，到被加载的那个模块里面去取值。模块内部引用的变化，会反应在外部。</li>
<li>在import时可以指定加载某个输出值，而不是加载整个模块，这种加载称为“编译时加载”。在编译时就引入模块代码，而不是在代码运行时加载，所以无法实现条件加载。也正因为这个，使得静态分析成为可能。 </li>
<li>得益于 ES6 的<span class="exturl" data-url="aHR0cHM6Ly9leHBsb3Jpbmdqcy5jb20vZXM2L2NoX21vZHVsZXMuaHRtbCNzZWNfZGVzaWduLWdvYWxzLWVzNi1tb2R1bGVz">静态模块结构<i class="fa fa-external-link-alt"></i></span>，可以进行 <span class="exturl" data-url="aHR0cHM6Ly93ZWIuZGV2L3JlZHVjZS1qYXZhc2NyaXB0LXBheWxvYWRzLXdpdGgtdHJlZS1zaGFraW5nLw==">Tree Shaking<i class="fa fa-external-link-alt"></i></span></li>
<li>ESM 允许像 Rollup 这样的打包器，<span class="exturl" data-url="aHR0cHM6Ly9kZXYudG8vYmVubnlwb3dlcnMveW91LXNob3VsZC1iZS11c2luZy1lc20ta24z">删除不必要的代码<i class="fa fa-external-link-alt"></i></span>，减少代码包可以获得更快的加载</li>
<li>可以在 HTML 中调用，只要如下</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;module&quot;</span>&gt;</span><span class="language-javascript"> </span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">import</span> &#123;func1&#125; <span class="keyword">from</span> <span class="string">&#x27;my-lib&#x27;</span>; </span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">func1</span>(); </span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>但是<span class="exturl" data-url="aHR0cHM6Ly9qYWtlYXJjaGliYWxkLmNvbS8yMDE3L2VzLW1vZHVsZXMtaW4tYnJvd3NlcnMv">不是所有的浏览器都支持<i class="fa fa-external-link-alt"></i></span></p>
<h2 id="3-结论"><a href="#3-结论" class="headerlink" title="3.结论"></a>3.结论</h2><ul>
<li>UMD 随处可见，通常在 ESM 不起作用的情况下用作备用</li>
<li>ESM 是异步的，适合前端，ESM输出是静态的，在编译时就能完成输出，输出的是值的引用，ESM(ESModule)是ECMAScript自己的模块化体系，具有简单的语法，异步特性和可摇树性，因此它是最好的模块化方案</li>
<li>CJS 是同步的，适合后端,CJS输出是一个对象，所以输出是在脚本运行完成后才执行，输出的是值的拷贝</li>
<li>AMD 是异步的，适合前端</li>
</ul>
]]></content>
      <tags>
        <tag>前端</tag>
      </tags>
  </entry>
  <entry>
    <title>Chrome 的多种断点方式</title>
    <url>/2021/11/04/Chrome%20%E7%9A%84%E5%A4%9A%E7%A7%8D%E6%96%AD%E7%82%B9%E6%96%B9%E5%BC%8F/</url>
    <content><![CDATA[<h2 id="1-断点"><a href="#1-断点" class="headerlink" title="1. 断点"></a>1. 断点</h2><p>在 Chrome 的 dev tools 里面断点是有多种方式的，但是最简单的断点方式对于调试一些 race  condition 的代码是有负面影响的，特别是多重断点对于调试流程阻碍性很强。<br>那么就需要一些新的方式来组合使用保证调试到目标逻辑代码。</p>
<h2 id="2-代码断点"><a href="#2-代码断点" class="headerlink" title="2. 代码断点"></a>2. 代码断点</h2><p>右键对应的行数，有相关菜单功能出来</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/strawferry/GSS@master/uPic/2023-08-20/wps_doc_0-16-18-3jQF7Z.png" alt="wps_doc_0-16-18-3jQF7Z"></p>
<h3 id="1-Add-breakpoint"><a href="#1-Add-breakpoint" class="headerlink" title="1.Add breakpoint"></a>1.Add breakpoint</h3><p>最简单的基础断点功能</p>
<h3 id="2-Add-conditional-breakpoint"><a href="#2-Add-conditional-breakpoint" class="headerlink" title="2. Add conditional breakpoint"></a>2. Add conditional breakpoint</h3><p>具备条件执行断点功能的断点方式，允许通过调用执行代码环境的变量判断是否需要断点。<br><img data-src="https://cdn.jsdelivr.net/gh/strawferry/GSS@master/uPic/2023-08-20/wps_doc_1-16-18-b8OiKv.png" alt="wps_doc_1-16-18-b8OiKv"></p>
<p>表达式的执行允许修改变量的值</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">a = 5 &amp;&amp; false</span><br></pre></td></tr></table></figure>

<h3 id="3-Add-logpoint"><a href="#3-Add-logpoint" class="headerlink" title="3. Add logpoint"></a>3. Add logpoint</h3><p>日志断点，类似条件断点的 console.log({expression}) &amp;&amp; false, 始终不会断点，但是可以不断输出环境里面的变量和计算的值。</p>
<h2 id="3-断点工具栏"><a href="#3-断点工具栏" class="headerlink" title="3. 断点工具栏"></a>3. 断点工具栏</h2><p>断点控制栏，除了常见的暂停、return 等功能，我们可以看到还有最右边两个功能<br><img data-src="https://cdn.jsdelivr.net/gh/strawferry/GSS@master/uPic/2023-08-20/wps_doc_2-16-18-iEx6tF.png" alt="wps_doc_2-16-18-iEx6tF"></p>
<h3 id="1-Deactivated-breakpoint"><a href="#1-Deactivated-breakpoint" class="headerlink" title="1. Deactivated breakpoint"></a>1. Deactivated breakpoint</h3><p>禁止所有的断点</p>
<h3 id="2-Pause-on-exceptions"><a href="#2-Pause-on-exceptions" class="headerlink" title="2. Pause on exceptions"></a>2. Pause on exceptions</h3><p>当发生 uncaught exceptions 时，将会直接断点。<br>如果勾选了 Pause on caught exceptions 时，只要碰到  throw 关键字，会自动断点。</p>
<h2 id="4-网络断点与事件断点"><a href="#4-网络断点与事件断点" class="headerlink" title="4. 网络断点与事件断点"></a>4. 网络断点与事件断点</h2><h3 id="1-网络断点"><a href="#1-网络断点" class="headerlink" title="1. 网络断点"></a>1. 网络断点</h3><p>网络断点将在发起网络请求的时候直接断点住对应代码，目前最大的作用是断点后修改其参数来实现一些目的。</p>
<h3 id="2-事件断点"><a href="#2-事件断点" class="headerlink" title="2. 事件断点"></a>2. 事件断点</h3><p>目前来说事件断点在 react fiber 的实现下功能并没有特别大的用处，但是对于一些原生调试还是有用的。<br><img data-src="https://cdn.jsdelivr.net/gh/strawferry/GSS@master/uPic/2023-08-20/wps_doc_3-16-18-ruYm6N.png" alt="wps_doc_3-16-18-ruYm6N"></p>
<h3 id="5-Dom-断点"><a href="#5-Dom-断点" class="headerlink" title="5. Dom 断点"></a>5. Dom 断点</h3><p>Deactivated breakpoints 对 dom 断点无效<br>Dom 断点是一个特殊的功能，对于一些实现奇葩的情况下是可以直接找到修改 dom 代码的源头进行追踪代码的。<br>使用方式<br><img data-src="https://cdn.jsdelivr.net/gh/strawferry/GSS@master/uPic/2023-08-20/wps_doc_4-16-18-ItHN05.png" alt="wps_doc_4-16-18-ItHN05"><br>1.Subtree modifications<br>当 children 发生变化的时候，将会断点到对应的代码<br>2.Attribute modifications<br>当 dom 属性发生变化的时候，将会断点到对应的代码<br>3.Node removal<br>当被选择的 dom 被删除的时候（如果是父级 dom 删除不算），将会断点到对应代码调用栈<br><img data-src="https://cdn.jsdelivr.net/gh/strawferry/GSS@master/uPic/2023-08-20/wps_doc_5-16-18-VcZpIa.png" alt="wps_doc_5-16-18-VcZpIa"></p>
]]></content>
      <tags>
        <tag>前端, 调试, chrome</tag>
      </tags>
  </entry>
  <entry>
    <title>CodePush 基本安装</title>
    <url>/2016/07/20/CodePush%20%E5%9F%BA%E6%9C%AC%E5%AE%89%E8%A3%85/</url>
    <content><![CDATA[<h2 id="1-电脑安装CodePush环境"><a href="#1-电脑安装CodePush环境" class="headerlink" title="1.电脑安装CodePush环境"></a>1.电脑安装CodePush环境</h2><blockquote>
<ol>
<li><p>安装命令<code>cnpm install -g code-push-cli</code></p>
</li>
<li><p>查看版本<code>code-push -v</code></p>
</li>
<li><p>注册账号<code>code-push register</code></p>
</li>
<li><p>登陆 <code>code-push login</code></p>
</li>
<li><p>注销 <code>code-push logout</code></p>
</li>
<li><p>列出 登陆的token <code>code-push access-key ls</code></p>
</li>
<li><p>删除某个access-key <code>code-push access-key rm &lt;accessKey&gt;</code></p>
</li>
</ol>
</blockquote>
<h3 id="CodePush一些app管理指令"><a href="#CodePush一些app管理指令" class="headerlink" title="CodePush一些app管理指令"></a>CodePush一些app管理指令</h3><blockquote>
<ol>
<li><p>增加app的指令 <code>code-push app add &lt;appName&gt;</code></p>
</li>
<li><p>列出所有app <code>code-push app ls</code></p>
</li>
<li><p>更名 <code>code-push app rename 旧名字 新名字</code></p>
</li>
<li><p>删除 <code>code-push app rm 旧名字</code></p>
</li>
</ol>
</blockquote>
<h3 id="CodePush-app部署管理指令"><a href="#CodePush-app部署管理指令" class="headerlink" title="CodePush app部署管理指令"></a>CodePush app部署管理指令</h3><blockquote>
<p>默认部署类型 Production  Staging，还可以自己加例如dev  alpha beta等</p>
<ol>
<li><p>列出app的部署环境 <code>code-push deployment ls &lt;appName&gt;</code></p>
</li>
<li><p>增加部署环境 <code>code-push deployment add &lt;appName&gt; &lt;部署名字&gt;</code></p>
</li>
<li><p>重命名部署名字：<code>code-push deployment rename app名字 旧部署名字 新部署名字</code></p>
</li>
<li><p>删除部署名字 <code>code-push deployment rm app名字 部署名字</code></p>
</li>
<li><p>查看历史版本<code>code-push deployment history appName deploymentName</code></p>
</li>
</ol>
</blockquote>
<h2 id="1-CodePush-项目目录下安装"><a href="#1-CodePush-项目目录下安装" class="headerlink" title="1.CodePush 项目目录下安装"></a>1.CodePush 项目目录下安装</h2><blockquote>
<p>npm install –save react-native-code-push@latest</p>
</blockquote>
<h2 id="2-iOS-Setup"><a href="#2-iOS-Setup" class="headerlink" title="2.iOS Setup"></a>2.iOS Setup</h2><h3 id="2-1推荐使用RNPM安装-React-Native-Package-Manager"><a href="#2-1推荐使用RNPM安装-React-Native-Package-Manager" class="headerlink" title="2.1推荐使用RNPM安装-React Native Package Manager"></a>2.1推荐使用RNPM安装-React Native Package Manager</h3><blockquote>
<p>工具安装命令 <code>npm i -g rnpm</code></p>
</blockquote>
<blockquote>
<p>Run <code>rnpm link react-native-code-push</code></p>
</blockquote>
<p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL01pY3Jvc29mdC9yZWFjdC1uYXRpdmUtY29kZS1wdXNo">其他安装方法<i class="fa fa-external-link-alt"></i></span></p>
<blockquote>
<p>react-native bundle –platform ios –entry-file index.ios.js –bundle-output main.jsbundle </p>
<p>code-push release newCPT react-native bundle –platform ios –entry-file index.ios.js –bundle-output main.jsbundl 1.0.0  [–deploymentName Staging] [–description 描述1.0.0] [–mandatory true] </p>
</blockquote>
]]></content>
  </entry>
  <entry>
    <title>CodePush 热更新操作</title>
    <url>/2016/07/20/CodePush%20%E7%83%AD%E6%9B%B4%E6%96%B0%E6%93%8D%E4%BD%9C/</url>
    <content><![CDATA[<p>因为<span class="exturl" data-url="aHR0cHM6Ly9taWNyb3NvZnQuZ2l0aHViLmlvL2NvZGUtcHVzaC9kb2NzL2NsaS5odG1s">微软开源<i class="fa fa-external-link-alt"></i></span>的这个做的还不错,所以拿来用了</p>
<h3 id="1-CodePush-CLI安装"><a href="#1-CodePush-CLI安装" class="headerlink" title="1.   CodePush CLI安装"></a>1.   CodePush CLI安装</h3><ul>
<li>首先要安装<span class="exturl" data-url="aHR0cHM6Ly9ub2RlanMub3JnL2VuLw==">Node.js<i class="fa fa-external-link-alt"></i></span></li>
<li>CodePush CLI安装 : <code>npm install -g code-push-cli</code></li>
</ul>
<h3 id="2-Account-账号管理"><a href="#2-Account-账号管理" class="headerlink" title="2. Account 账号管理"></a>2. Account 账号管理</h3><ul>
<li>注册<code>code-push register</code><br><img data-src="http://img.blog.csdn.net/20160804224117391" alt="codePush注册页面"><br>一般可以使用github登录(建议),也可以注册微软的账号!</li>
<li>退出账号后可以用<code>code-push link</code>,进入页面</li>
<li>登录 <code>code-push login</code><blockquote>
<p>条状页面,通过上面的那些图登录<br><img data-src="http://img.blog.csdn.net/20160804225819229" alt="选择登录方式"></p>
<p><img data-src="http://img.blog.csdn.net/20160804225840433" alt="登录的key"></p>
<p><img data-src="http://img.blog.csdn.net/20160804225951309" alt="输入key"></p>
</blockquote>
</li>
<li>当前登录账号 <code>code-push whoami</code></li>
<li>退出当前登录 <code>code-push logout</code></li>
<li>显示在那些电脑上面登录过账号 <code>code-push session ls</code></li>
<li>移除在某台电脑的登录 <code>code-push session rm &lt;machineName&gt;</code></li>
</ul>
<hr>
<ul>
<li>获取access-key不通过浏览器 <code>code-push access-key add &quot;VSTS Integration&quot;</code></li>
<li>通过上面的key登录 <code>code-push login --accessKey &lt;accessKey&gt;</code></li>
<li>设置key到期时间  <code>code-push access-key patch &lt;accessKeyName&gt; --name &quot;new name&quot; --ttl 10d</code></li>
<li>登录<code>HTTPS_PROXY or HTTP_PROXY</code>安全的一些东西<code>code-push login --noProxy</code> <code>code-push login --proxy https://foo.com:3454</code></li>
</ul>
<h3 id="3-App-管理"><a href="#3-App-管理" class="headerlink" title="3. App 管理"></a>3. App 管理</h3><ul>
<li><p>新建推送热更新的App <code>code-push app add &lt;appName&gt;</code></p>
<blockquote>
<p>建议是iOS和安卓版本分开创建<br><code>code-push app add MyApp-Android</code><br><code>code-push app add MyApp-iOS</code></p>
</blockquote>
</li>
<li><p>对App进行改名字 <code>code-push app rename &lt;appName&gt; &lt;newAppName&gt;</code></p>
</li>
<li><p>移除App <code>code-push app rm &lt;appName&gt;</code></p>
</li>
<li><p>列出账号的所有App <code>code-push app ls</code></p>
</li>
<li><p>App 增加参与的管理者(一般少用) <code>code-push collaborator add &lt;appName&gt; &lt;collaboratorEmail&gt;</code> </p>
</li>
<li><p>移除参与的管理者 <code>code-push collaborator rm &lt;appName&gt; &lt;collaboratorEmail&gt;</code></p>
</li>
<li><p>列出所有的参与者 <code>code-push collaborator ls &lt;appName&gt;</code></p>
</li>
<li><p>把自己的这个App管理权限转移给其他人 <code>code-push app transfer &lt;appName&gt; &lt;newOwnerEmail&gt;</code></p>
</li>
</ul>
<h3 id="4-开发环境管理"><a href="#4-开发环境管理" class="headerlink" title="4. 开发环境管理"></a>4. 开发环境管理</h3><ul>
<li>增加开发环境 <code>code-push deployment add &lt;appName&gt; &lt;deploymentName&gt;</code></li>
<li>移除 <code>code-push deployment rm &lt;appName&gt; &lt;deploymentName&gt;</code></li>
<li>换名字 <code>code-push deployment rename &lt;appName&gt; &lt;deploymentName&gt; &lt;newDeploymentName&gt;</code></li>
<li>列出所有的开发环境 <code>code-push deployment ls &lt;appName&gt;</code></li>
<li>列出所有的开发环境和对应access-key <code>code-push deployment ls &lt;appName&gt; --displayKeys 或者 -k</code><br><img data-src="http://img.blog.csdn.net/20160804231831147" alt="环境"><blockquote>
<p>Active 当前表示激活比例<br>Total  总共多少<br>Pending 处于未升级和不确定因素<br>Rollbacks 回滚的数<br>Rollout<br>Disabled</p>
</blockquote>
</li>
</ul>
<h3 id="5-更新版本管理"><a href="#5-更新版本管理" class="headerlink" title="5. 更新版本管理"></a>5. <span class="exturl" data-url="aHR0cHM6Ly9taWNyb3NvZnQuZ2l0aHViLmlvL2NvZGUtcHVzaC9kb2NzL2NsaS5odG1sI3JlbGVhc2luZy11cGRhdGVzLXJlYWN0LW5hdGl2ZQ==">更新版本管理<i class="fa fa-external-link-alt"></i></span></h3><ul>
<li>最简单的方法 <code>code-push release-react MyApp ios</code> <code>code-push release-react MyApp android</code></li>
<li>code-push release-react hxlivei ios -d “PrePush” –des “停车场”<blockquote>
<p>code-push release-react <appName> <platform><br>[–bundleName <bundleName>]<br>[–deploymentName <deploymentName>]<br>[–description <description>]<br>[–development <development>]<br>[–disabled <disabled>]<br>[–entryFile <entryFile>]<br>[–mandatory]<br>[–plistFile <plistFile>]<br>[–plistFilePrefix <plistFilePrefix>]<br>[–sourcemapOutput <sourcemapOutput>]<br>[–targetBinaryVersion <targetBinaryVersion>]<br>[–rollout <rolloutPercentage>]</p>
</blockquote>
</li>
</ul>
<h3 id="6-其他"><a href="#6-其他" class="headerlink" title="6. 其他"></a>6. 其他</h3><ul>
<li>清除更新记录 <code>code-push deployment clear &lt;appName&gt; &lt;deploymentName&gt;</code><br><img data-src="http://img.blog.csdn.net/20160804232838412" alt="清除历史"></li>
</ul>
]]></content>
  </entry>
  <entry>
    <title>Coding设置Webhook到钉钉</title>
    <url>/2017/08/16/Coding%E8%AE%BE%E7%BD%AEWebhook%E5%88%B0%E9%92%89%E9%92%89/</url>
    <content><![CDATA[<h1 id="起因"><a href="#起因" class="headerlink" title="起因"></a>起因</h1><p>最近用着钉钉,突然发现有个神奇的功能叫 Webhook 机器人,里面有 <code>Github</code> 的机器人,然鹅竟然没有我一直在用的 <strong><span class="exturl" data-url="aHR0cHM6Ly9jb2RpbmcubmV0Lw==">Coding.net<i class="fa fa-external-link-alt"></i></span></strong> 的机器人,这个不能忍,本着程序员自己动手丰衣足食的勤劳准则,想着就自己折腾弄一个玩玩;</p>
<p>因为自己只会点 <code>Node.js</code> 所以就做了个包,具体的看下面;</p>
<p>效果图</p>
<blockquote>
<p><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1filid4rbgug21ka0w77hd.gif"></p>
</blockquote>
<h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><p>找了一下两家的文档</p>
<blockquote>
<p><span class="exturl" data-url="aHR0cHM6Ly9vcGVuLmNvZGluZy5uZXQvd2ViaG9va3Mv">Coding Webhook 文档<i class="fa fa-external-link-alt"></i></span></p>
</blockquote>
<blockquote>
<p><span class="exturl" data-url="aHR0cHM6Ly9vcGVuLWRvYy5kaW5ndGFsay5jb20vZG9jcy9kb2MuaHRtP3NwbT1hMjE5YS43NjI5MTQwLjAuMC5WOFdiMk8mdHJlZUlkPTI1NyZhcnRpY2xlSWQ9MTA1NzM1JmRvY1R5cGU9MQ==">钉钉自定义机器人文档<i class="fa fa-external-link-alt"></i></span></p>
</blockquote>
<p>大概原理就是,钉钉提供一个发送消息的 Webhook 地址给你,然后 Coding 家提供了一个给你填入 Webhook 的地址接口,当仓库有信息变化,就会给你这个地址接口发消息;然而钉钉没有做这个 Coding 的接口,所以不能提供 Coding 直接把消息发到钉钉上,所以只能自己搭个服务器,先把 Coding 的消息解析一下,在发给钉钉.基本原理就是这样,说的有点乱,哈哈;</p>
<blockquote>
<p><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1filia2e2chj21pe15sjz0.jpg"></p>
</blockquote>
<h2 id="服务器"><a href="#服务器" class="headerlink" title="服务器"></a>服务器</h2><p>设置 Webhook 路由;</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>),</span><br><span class="line">    bodyParser = <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>),</span><br><span class="line">    <span class="variable constant_">CWD</span> = <span class="built_in">require</span>(<span class="string">&#x27;./../index&#x27;</span>),</span><br><span class="line">    app = <span class="title function_">express</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 一般都会设置 bodyParser ,需要用到; </span></span><br><span class="line">app.<span class="title function_">use</span>(bodyParser.<span class="title function_">urlencoded</span>(&#123; <span class="attr">extended</span>: <span class="literal">true</span> &#125;));</span><br><span class="line">app.<span class="title function_">use</span>(bodyParser.<span class="title function_">json</span>());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置 Webhook 路由,已经中间件 CWD</span></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/webhook&#x27;</span>, <span class="title function_">CWD</span>());</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">5566</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Express server listening on port http://localhost:6666&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>CWD 中间件;</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> request = <span class="built_in">require</span>(<span class="string">&#x27;request&#x27;</span>);</span><br><span class="line"><span class="built_in">exports</span> = <span class="variable language_">module</span>.<span class="property">exports</span> = <span class="keyword">function</span> (<span class="params">options</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span> <span class="title function_">CodingHookDingDing</span> (req, res, next) &#123;</span><br><span class="line">        <span class="keyword">let</span> event = req.<span class="property">headers</span>[<span class="string">&#x27;x-coding-event&#x27;</span>],</span><br><span class="line">            body = req.<span class="property">body</span>;</span><br><span class="line">            <span class="comment">// 通过头文件的 event 事件判断传入的参数等,做相应的信息解析;</span></span><br><span class="line">        <span class="keyword">switch</span> (event)&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;push&quot;</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="title class_">Push</span>(req, res, next); <span class="comment">// 对 push 做解析</span></span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;ping&quot;</span>:</span><br><span class="line">                <span class="keyword">return</span> res.<span class="title function_">json</span>(&#123;</span><br><span class="line">                    <span class="string">&quot;token&quot;</span>: <span class="string">&quot;123&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;zen&quot;</span>: <span class="string">&quot;Coding！ 让开发更简单&quot;</span></span><br><span class="line">                &#125;);</span><br><span class="line">            <span class="attr">default</span>:</span><br><span class="line">                <span class="keyword">return</span> res.<span class="title function_">json</span>(body);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Push</span>(<span class="params">req, res, next</span>) &#123;</span><br><span class="line">	<span class="comment">/*-- 消息的解析拼接 --*/</span></span><br><span class="line">    <span class="keyword">let</span> body = req.<span class="property">body</span>;</span><br><span class="line">    <span class="keyword">let</span> ding = body.<span class="property">token</span>;</span><br><span class="line">    <span class="keyword">let</span> count = body.<span class="property">commits</span>.<span class="property">length</span>;</span><br><span class="line">    <span class="keyword">let</span> whopush = body.<span class="property">commits</span>[<span class="number">0</span>].<span class="property">committer</span>.<span class="property">name</span>;</span><br><span class="line">    <span class="keyword">let</span> repourl = <span class="string">`<span class="subst">$&#123;body.repository.owner.web_url&#125;</span>/p/<span class="subst">$&#123;body.repository.name&#125;</span>/git/tree/<span class="subst">$&#123;getbranch(body.ref)&#125;</span>`</span>;</span><br><span class="line">    <span class="keyword">let</span> branch = <span class="string">`# [[<span class="subst">$&#123;body.repository.name&#125;</span>/<span class="subst">$&#123;getbranch(body.ref)&#125;</span>]](<span class="subst">$&#123;repourl&#125;</span>)`</span>;</span><br><span class="line">    <span class="keyword">let</span> text = <span class="string">`<span class="subst">$&#123;branch&#125;</span> <span class="subst">$&#123;count&#125;</span> commit,push by <span class="subst">$&#123;whopush&#125;</span>\n ## commits:\n`</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; count; i++)&#123;</span><br><span class="line">        <span class="keyword">let</span> com = body.<span class="property">commits</span>[i];</span><br><span class="line">        <span class="keyword">let</span> name = com.<span class="property">committer</span>.<span class="property">name</span>;</span><br><span class="line">        <span class="keyword">let</span> mes = com.<span class="property">short_message</span>;</span><br><span class="line">        <span class="keyword">let</span> hash6 = com.<span class="property">sha</span>.<span class="title function_">substring</span>(<span class="number">0</span>,<span class="number">6</span>);</span><br><span class="line">        <span class="keyword">let</span> commit = <span class="string">`&gt; &lt;/&gt; <span class="subst">$&#123;name&#125;</span>: [[<span class="subst">$&#123;hash6&#125;</span>]](<span class="subst">$&#123;com.web_url&#125;</span>)-<span class="subst">$&#123;mes&#125;</span>\n`</span>;</span><br><span class="line">        text = text + commit;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(text);</span><br><span class="line">    <span class="comment">/*-- 消息的解析拼接 --*/</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 钉钉消息格式等 body 设置 </span></span><br><span class="line">    <span class="keyword">let</span> rqbody = &#123;</span><br><span class="line">        <span class="attr">msgtype</span>: <span class="string">&quot;markdown&quot;</span>,</span><br><span class="line">        <span class="attr">markdown</span>: &#123;</span><br><span class="line">            <span class="attr">title</span>:<span class="string">&quot;仓库有新的代码更新咯!&quot;</span>,</span><br><span class="line">            <span class="attr">text</span>: text</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> options = &#123;</span><br><span class="line">        <span class="attr">url</span>: ding,</span><br><span class="line">        <span class="attr">headers</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">body</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(rqbody) <span class="comment">// 消息体内容</span></span><br><span class="line">    &#125;;</span><br><span class="line">	<span class="comment">// request 向钉钉发送消息 Webhook</span></span><br><span class="line">    request.<span class="title function_">post</span>(options, <span class="function">(<span class="params">err, res, body</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!err &amp;&amp; res.<span class="property">statusCode</span> == <span class="number">200</span>)&#123;</span><br><span class="line">            <span class="keyword">let</span> info = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(body);</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(info);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    res.<span class="title function_">json</span>(&#123;<span class="attr">mes</span>: <span class="string">&#x27;ok&#x27;</span>&#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getbranch</span>(<span class="params">str</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> arr = str.<span class="title function_">split</span>(<span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> arr[arr.<span class="property">length</span>-<span class="number">1</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><h3 id="1-首先钉钉群里设置自定义机器人"><a href="#1-首先钉钉群里设置自定义机器人" class="headerlink" title="1. 首先钉钉群里设置自定义机器人"></a>1. 首先钉钉群里设置自定义机器人</h3><p><strong>1. 设置自定义机器人</strong></p>
<blockquote>
<p><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1filid4pd50j20mv0n479k.jpg"></p>
</blockquote>
<p><strong>2. 填入机器人名称</strong></p>
<blockquote>
<p><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1filid4ortwj20ix0ffq46.jpg"></p>
</blockquote>
<p><strong>3. 复制 webhook 地址,后面有用</strong><br><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1filid4omjxj20iy0ffmyo.jpg"></p>
<h3 id="2-Coding-仓库-Webhook-设置"><a href="#2-Coding-仓库-Webhook-设置" class="headerlink" title="2. Coding 仓库 Webhook 设置"></a>2. Coding 仓库 Webhook 设置</h3><p><strong>1. 点击到要设置的仓库 Webhook 页面,点击新建 Webhook</strong></p>
<blockquote>
<p><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1filid4p9tbj20yf0egq5j.jpg"></p>
</blockquote>
<p><strong>2. url 填入服务器上要监听的地址, token 填入刚才钉钉复制的 Webhook 地址,以及选取底部的监听类型,至少要勾选 Push</strong></p>
<blockquote>
<p><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1filid4qf5fj21a40qajwl.jpg"></p>
</blockquote>
<p><strong>3. 如果配置顺利,在你以后每次仓库的变化,在钉钉上面都会收到消息提醒</strong></p>
<blockquote>
<p><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1filid4tw0uj20qo0v4wnh.jpg"></p>
</blockquote>
<h2 id="npm-包"><a href="#npm-包" class="headerlink" title="npm 包"></a>npm 包</h2><p>后面就干脆做了个 npm 包发布上去,目前只对 push 操作做消息发送,后续有时间在完善下其他操作;</p>
<blockquote>
<p>安装</p>
</blockquote>
<p><code>npm i --save hookding</code></p>
<blockquote>
<p>使用方法</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="variable constant_">CWD</span> = <span class="built_in">require</span>(<span class="string">&#x27;hookding&#x27;</span>);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/router&#x27;</span>, <span class="title function_">CWD</span>());</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h2 id="本文参与-Coding-征文计划"><a href="#本文参与-Coding-征文计划" class="headerlink" title="本文参与 Coding 征文计划"></a><span class="exturl" data-url="aHR0cHM6Ly9jb2RpbmcubmV0L3dvdy9zdG9yaWVzLw==">本文参与 Coding 征文计划<i class="fa fa-external-link-alt"></i></span></h2>]]></content>
  </entry>
  <entry>
    <title>CodePush 热更新自定义弹窗提示</title>
    <url>/2018/10/31/CodePush%20%E7%83%AD%E6%9B%B4%E6%96%B0%E8%87%AA%E5%AE%9A%E4%B9%89%E5%BC%B9%E7%AA%97%E6%8F%90%E7%A4%BA/</url>
    <content><![CDATA[<h2 id="项目说明"><a href="#项目说明" class="headerlink" title="项目说明"></a>项目说明</h2><p>在用 ReactNative 开发 App 时,会用到 CodePush 做应用的热更新,但是在升级的时候没有好看的弹窗提示,自己就找了个时间写了一个简单集成 ReactNative 又有好看的更新弹窗;</p>
<h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><ol>
<li>首先是安装 react-native-code-push,  <code>yarn add react-native-code-push</code>;</li>
<li>link 一下项目, <code>react-native link react-native-code-push</code>;</li>
<li>安装 react-native-code-push-dialog, <code>yarn add react-native-code-push-dialog</code>;</li>
</ol>
<h2 id="项目中配置"><a href="#项目中配置" class="headerlink" title="项目中配置"></a>项目中配置</h2><p>最简单的配置如下,尽量把 <HotUpdate /> 节点放在顶层的节点处;</p>
<figure class="highlight plaintext"><figcaption><span>js</span></figcaption><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">import React, &#123;Component&#125; from &#x27;react&#x27;;</span><br><span class="line">import &#123;Platform, StyleSheet, Text, View, Button, Dimensions&#125; from &#x27;react-native&#x27;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">import HotUpdate, &#123; ImmediateCheckCodePush &#125; from &#x27;react-native-code-push-dialog&#x27;;</span><br><span class="line"></span><br><span class="line">export default class Index extends React.Component &#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">        return &lt;View style=&#123;&#123;flex: 1, justifyContent: &#x27;center&#x27;, alignItems: &#x27;center&#x27;&#125;&#125;&gt;</span><br><span class="line">            &lt;Text&gt; CodePushExample &lt;/Text&gt;</span><br><span class="line">            &lt;HotUpdate /&gt;</span><br><span class="line">            &lt;Text onPress=&#123;()=&gt;&#123;</span><br><span class="line">                ImmediateCheckCodePush();</span><br><span class="line">            &#125;&#125;&gt;点击立即检查&lt;/Text&gt;</span><br><span class="line">        &lt;/View&gt;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>更多用法</p>
<table>
<thead>
<tr>
<th align="center">props</th>
<th align="center">PropTypes</th>
<th align="center">use</th>
<th align="center">description</th>
</tr>
</thead>
<tbody><tr>
<td align="center">deploymentKey</td>
<td align="center">PropTypes.string</td>
<td align="center"><code>jaasdasdsa2w12wed2we3e23</code></td>
<td align="center">code-push deploymentKey 非必须参数,没有会读取原生的;</td>
</tr>
<tr>
<td align="center">isActiveCheck</td>
<td align="center">PropTypes.bool</td>
<td align="center"><code>true</code> or <code>false</code></td>
<td align="center">code-push CheckFrequency 检查更新策略,只提供2种, true 每次返回前台就更新(高频率), false 只有 App 启动才检测更新, 默认 true;</td>
</tr>
</tbody></table>
<figure class="highlight plaintext"><figcaption><span>js</span></figcaption><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">import React, &#123;Component&#125; from &#x27;react&#x27;;</span><br><span class="line">import &#123;Platform, StyleSheet, Text, View, Button, Dimensions&#125; from &#x27;react-native&#x27;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">import HotUpdate, &#123; ImmediateCheckCodePush &#125; from &#x27;react-native-code-push-dialog&#x27;;</span><br><span class="line"></span><br><span class="line">export default class Index extends React.Component &#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">        return &lt;View style=&#123;&#123;flex: 1, justifyContent: &#x27;center&#x27;, alignItems: &#x27;center&#x27;&#125;&#125;&gt;</span><br><span class="line">            &lt;Text&gt; CodePushExample &lt;/Text&gt;</span><br><span class="line">            &lt;HotUpdate deploymentKey=&#123;&#x27;askjdkas32232dw32d&#x27;&#125; isActiveCheck=&#123;false&#125;/&gt;</span><br><span class="line">            &lt;Text onPress=&#123;()=&gt;&#123;</span><br><span class="line">                ImmediateCheckCodePush();</span><br><span class="line">            &#125;&#125;&gt;点击立即检查&lt;/Text&gt;</span><br><span class="line">        &lt;/View&gt;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>推热更新代码的时候如果是有多条类型的,尽量在推更新的时候弄成每条后面回车,这样到时候展示的内容才能换行美观;</p>
<p><code>code-push release-react App android --des &quot;1.按照区域展示轮播内容;                              2.分析数据,优化体验;&quot; -t &quot;5.1.2&quot;</code></p>
<p>显示效果</p>
<p><img data-src="http://ww1.sinaimg.cn/large/8bbf0afbly1fwrho7a10fg20aj0l37bb.gif"></p>
<h2 id="地址"><a href="#地址" class="headerlink" title="地址"></a>地址</h2><blockquote>
<p><a href="https://github.com/strawferry/CodePushDialog"><strong>GitHub 仓库地址</strong></a></p>
</blockquote>
]]></content>
  </entry>
  <entry>
    <title>Copixel 工具插件使用指南</title>
    <url>/2022/09/12/Copixel%E5%B7%A5%E5%85%B7%E6%8F%92%E4%BB%B6%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/</url>
    <content><![CDATA[<h2 id="1-Copixel-工具基本介绍和安装"><a href="#1-Copixel-工具基本介绍和安装" class="headerlink" title="1. Copixel 工具基本介绍和安装"></a>1. Copixel 工具基本介绍和安装</h2><p><span class="exturl" data-url="aHR0cHM6Ly9jb3BpeGVsLmJ5dGVkYW5jZS5jb20v">Copixel<i class="fa fa-external-link-alt"></i></span> 是一个 UI 还原走查的工具,目前只支持 Chrome 浏览器使用,需要去 Chrome 商店下载使用 <span class="exturl" data-url="aHR0cHM6Ly9jaHJvbWUuZ29vZ2xlLmNvbS93ZWJzdG9yZS9kZXRhaWwvY29waXhlbC9pbGppZmxpYXBhaW1rb2ZhZmtkZHBna2ZrbW5vY2FqZg==">下载地址<i class="fa fa-external-link-alt"></i></span>;</p>
<h2 id="2-Copixel-工具的使用"><a href="#2-Copixel-工具的使用" class="headerlink" title="2. Copixel 工具的使用"></a>2. Copixel 工具的使用</h2><h3 id="1-点击插件使用"><a href="#1-点击插件使用" class="headerlink" title="1. 点击插件使用"></a>1. 点击插件使用</h3><p><img data-src="https://cdn.jsdelivr.net/gh/strawferry/GSS@master/uPic/2023-08-20/UPvroX-14-22-OwH3tV.png" alt="UPvroX-14-22-OwH3tV"></p>
<h3 id="2-从-Figma-导出设计图-并添加到图片中"><a href="#2-从-Figma-导出设计图-并添加到图片中" class="headerlink" title="2. 从 Figma 导出设计图,并添加到图片中;"></a>2. 从 Figma 导出设计图,并添加到图片中;</h3><p><img data-src="https://cdn.jsdelivr.net/gh/strawferry/GSS@master/uPic/2023-08-20/wps_doc_1-14-24-AUlp6E.png" alt="wps_doc_1-14-24-AUlp6E"></p>
<h3 id="3-打开页面-调整窗口宽度-使用校稿工具比对"><a href="#3-打开页面-调整窗口宽度-使用校稿工具比对" class="headerlink" title="3. 打开页面,调整窗口宽度,使用校稿工具比对"></a>3. 打开页面,调整窗口宽度,使用校稿工具比对</h3><p><img data-src="https://cdn.jsdelivr.net/gh/strawferry/GSS@master/uPic/2023-08-20/wps_doc_2-14-24-UAjIpC.png" alt="wps_doc_2-14-24-UAjIpC"></p>
<h3 id="4-通过截图软件记录问题的地方"><a href="#4-通过截图软件记录问题的地方" class="headerlink" title="4. 通过截图软件记录问题的地方"></a>4. 通过截图软件记录问题的地方</h3><p><img data-src="https://cdn.jsdelivr.net/gh/strawferry/GSS@master/uPic/2023-08-20/wps_doc_3-14-24-zJDraz.png" alt="wps_doc_3-14-24-zJDraz"></p>
<h2 id="3-浏览器屏幕宽度快捷设置"><a href="#3-浏览器屏幕宽度快捷设置" class="headerlink" title="3. 浏览器屏幕宽度快捷设置"></a>3. 浏览器屏幕宽度快捷设置</h2><p><img data-src="https://cdn.jsdelivr.net/gh/strawferry/GSS@master/uPic/2023-08-20/wps_doc_4-14-24-dWN0vY.png" alt="wps_doc_4-14-24-dWN0vY"></p>
<h2 id="4-其他相关"><a href="#4-其他相关" class="headerlink" title="4. 其他相关"></a>4. 其他相关</h2><p>官方的指南: <span class="exturl" data-url="aHR0cHM6Ly9ieXRlZGFuY2UuZmVpc2h1LmNuL2RvY3MvZG9jY25yMFZ1ZWtnVDdpV3BtMmJqMkczZ1Zl">Copixel走查验收插件使用指南-对外版<i class="fa fa-external-link-alt"></i></span></p>
]]></content>
      <tags>
        <tag>工具, chrome插件, chrome调试</tag>
      </tags>
  </entry>
  <entry>
    <title>ComfyUI安装和插件安装使用</title>
    <url>/2025/01/17/ComfyUI%E5%AE%89%E8%A3%85%E5%92%8C%E6%8F%92%E4%BB%B6%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8/</url>
    <content><![CDATA[<h2 id="ComfyUI安装"><a href="#ComfyUI安装" class="headerlink" title="ComfyUI安装"></a>ComfyUI安装</h2><ol>
<li><span class="exturl" data-url="aHR0cHM6Ly9jb21meW9yZy5ub3Rpb24uc2l0ZS9Db21meVVJLURlc2t0b3AtVXNlci1HdWlkZS0xMTQ2ZDczZDM2NTA4MGE0OTA1OGU4ZDYyOTc3MmYwYQ==">ComfyUI Desktop 官方下载<i class="fa fa-external-link-alt"></i></span></li>
</ol>
<p>选择对应的电脑系统版本下载,我这边是 Mac 系统,所以本文是基于 Mac 系统的安装教程</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/strawferry/GSS@master/uPic/20250129/21-49-04-q6sflH.png" alt="选择对应的系统下载"></p>
<ol start="2">
<li><p>下载完成后,双击安装包,按照提示安装即可</p>
<p> 2.1 选择安装目录,直接选择默认目录即可</p>
</li>
</ol>
<p><img data-src="https://cdn.jsdelivr.net/gh/strawferry/GSS@master/uPic/20250129/21-51-40-mTicqo.png" alt="选择安装目录"></p>
<pre><code>2.2 选择合并之前的模型等文件目录,未安装直接选择默认目录即可
</code></pre>
<p><img data-src="https://cdn.jsdelivr.net/gh/strawferry/GSS@master/uPic/20250129/21-55-54-lnalTz.png" alt="模型等存放目录"></p>
<pre><code>2.3 客户端设置,设置完成之后就开始安装软件的依赖
</code></pre>
<ol start="3">
<li>安装过程中可能会出现依赖安装失败的情况</li>
</ol>
<p>3.1 出现依赖安装失败的情况,可以尝试重新安装依赖</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 出现下面的依赖安装错误</span></span><br><span class="line">/Applications/ComfyUI.app/Contents/Resources/uv/macos/uv <span class="string">&quot;pip&quot;</span> <span class="string">&quot;install&quot;</span> <span class="string">&quot;-r&quot;</span> <span class="string">&quot;/Applications/ComfyUI.app/Contents/Resources/ComfyUI/requirements.txt&quot;</span></span><br><span class="line"><span class="comment"># 出现这个问题有可能原因是网络问题,可以尝试使用国内的源去按照</span></span><br><span class="line">/Applications/ComfyUI.app/Contents/Resources/uv/macos/uv pip install --dry-run -r /Applications/ComfyUI.app/Contents/Resources/ComfyUI/requirements.txt <span class="keyword">in</span> /Users/m4/Documents/ComfyUI [200~-i http://mirrors.aliyun.com/pypi/simple/ --trusted-host mirrors.aliyun.com</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>3.2 安装失败后重新打开软件,出现下面的界面<br>这个地方只能通过 continue 来继续安装,或者自己点击 install 来安装依赖<br><img data-src="https://cdn.jsdelivr.net/gh/strawferry/GSS@master/uPic/20250129/22-23-11-2JyMn3.png" alt="安装失败"></p>
<p>实在没有解决只能卸载后,重新安装客户端,保证网络通畅</p>
<ol start="4">
<li>安装完成后,打开软件,会出现下面的界面,点击 Launch ComfyUI 来启动软件</li>
</ol>
<p><img data-src="https://cdn.jsdelivr.net/gh/strawferry/GSS@master/uPic/20250129/22-26-30-UAT4W7.png" alt="启动页面"></p>
<ol start="5">
<li>启动后成功进入 ComfyUI 界面,有个默认的工作流</li>
</ol>
<p><img data-src="https://cdn.jsdelivr.net/gh/strawferry/GSS@master/uPic/20250129/22-29-58-BrvsM3.png" alt="默认工作流"></p>
<ol start="6">
<li>页面设置成中文</li>
</ol>
<p><img data-src="https://cdn.jsdelivr.net/gh/strawferry/GSS@master/uPic/20250129/22-32-02-jVAKqu.png" alt="系统设置中文"></p>
<p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0FJR09ETElLRS9BSUdPRExJS0UtQ09NRllVSS1UUkFOU0xBVElPTg==">AIGODLIKE-COMFYUI-TRANSLATION<i class="fa fa-external-link-alt"></i></span>插件设置成中文</p>
<p>通过搜索下载插件,点击下载安装,安装后需要重启软件才能生效</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/strawferry/GSS@master/uPic/20250129/22-36-42-HpXzSF.png" alt="插件安装"></p>
<p><img data-src="https://cdn.jsdelivr.net/gh/strawferry/GSS@master/uPic/20250129/22-39-53-5jHuvJ.png" alt="插件翻译的比较全"></p>
<ol start="7">
<li>运行默认工作流</li>
</ol>
<p>软件刚刚安装完成,电脑内还没有模型,所以运行默认工作流会报错,需要先下载模型<br><img data-src="https://cdn.jsdelivr.net/gh/strawferry/GSS@master/uPic/20250129/22-44-44-5sbvVp.png" alt="模型缺失下载"></p>
<p><img data-src="https://cdn.jsdelivr.net/gh/strawferry/GSS@master/uPic/20250129/22-44-10-RqbS0T.png" alt="默认工作流执行"></p>
]]></content>
      <tags>
        <tag>ComfyUI, ComfyUI 安装, ComfyUI 插件安装, ComfyUI 插件使用</tag>
      </tags>
  </entry>
  <entry>
    <title>Cursor Translate 翻译应用项目实战教程</title>
    <url>/2025/01/26/CursorTranslate%E7%BF%BB%E8%AF%91%E5%BA%94%E7%94%A8%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%E6%95%99%E7%A8%8B/</url>
    <content><![CDATA[<h1 id="Cursor-Translate-翻译应用项目实战教程"><a href="#Cursor-Translate-翻译应用项目实战教程" class="headerlink" title="Cursor Translate 翻译应用项目实战教程"></a>Cursor Translate 翻译应用项目实战教程</h1><h2 id="0-前言"><a href="#0-前言" class="headerlink" title="0. 前言"></a>0. 前言</h2><p>这是一篇简单的从前端开发人员视角介绍 Cursor 编辑器的教程,主要介绍 Cursor 编辑器的安装和使用,以及如何使用 Cursor 编辑器生成代码,并按照产品需求,完善代码,并优化 UI 界面;</p>
<p>教程配套的 git 代码仓库: <a href="https://github.com/strawferry/cursor-translate"><code>Cursor Translate 翻译应用项目实战</code></a></p>
<p>AI 交互的记录文档: <a href="/.specstory/history/composer-%E4%BA%A4%E4%BA%92.md"><code>Cursor Composer 记录</code></a></p>
<h2 id="1-Cursor-介绍和安装"><a href="#1-Cursor-介绍和安装" class="headerlink" title="1. Cursor 介绍和安装"></a>1. <span class="exturl" data-url="aHR0cHM6Ly93d3cuY3Vyc29yLmNvbS8=">Cursor<i class="fa fa-external-link-alt"></i></span> 介绍和安装</h2><p><span class="exturl" data-url="aHR0cHM6Ly93d3cuY3Vyc29yLmNvbS8=">Cursor<i class="fa fa-external-link-alt"></i></span> 是一个目前比较流程很火的 AI Code Editor，它可以帮助你快速生成代码，提高开发效率。</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/strawferry/GSS@master/uPic/20250123/17-39-52-JXEi6A.png" alt="Cursor 官网介绍图"></p>
<p><span class="exturl" data-url="aHR0cHM6Ly93d3cuY3Vyc29yLmNvbS8=">Cursor 官网<i class="fa fa-external-link-alt"></i></span> 去下载对应的安装包，安装完成后，打开软件，会提示你注册，注册完成后，就可以开始使用了。</p>
<p>cursor 编辑器是基于 VSCode 开发的，所以基本和 VSCode 界面类似,也可以直接使用 VSCode 的插件。</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/strawferry/GSS@master/uPic/20250124/09-35-07-reo9nx.png" alt="09-35-07-reo9nx"></p>
<h2 id="2-Cursor-Translate-翻译应用项目实战"><a href="#2-Cursor-Translate-翻译应用项目实战" class="headerlink" title="2. Cursor Translate 翻译应用项目实战"></a>2. Cursor Translate 翻译应用项目实战</h2><h3 id="2-1-创建项目文件夹-并使用-Cursor-打开"><a href="#2-1-创建项目文件夹-并使用-Cursor-打开" class="headerlink" title="2.1 创建项目文件夹,并使用 Cursor 打开"></a>2.1 创建项目文件夹,并使用 Cursor 打开</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> Translate &amp;&amp; <span class="built_in">cd</span> Translate</span><br><span class="line">cursor .</span><br><span class="line"><span class="comment"># 通过命令行打开,或者使用 cursor 直接打开该文件目录</span></span><br></pre></td></tr></table></figure>

<h3 id="2-2-创建-README-md-文件-并写一些产品需求内容-技术选型等"><a href="#2-2-创建-README-md-文件-并写一些产品需求内容-技术选型等" class="headerlink" title="2.2 创建 README.md 文件,并写一些产品需求内容,技术选型等"></a>2.2 创建 README.md 文件,并写一些产品需求内容,技术选型等</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">touch</span> README.md</span><br><span class="line"><span class="comment"># 创建好 README.md 文件后,建议给项目做一个 git init 初始化,方便后续的版本控制,当然这个不是必须的</span></span><br><span class="line"><span class="built_in">cd</span> Translate</span><br><span class="line">git init</span><br></pre></td></tr></table></figure>

<h3 id="2-3-AI-生成代码使用"><a href="#2-3-AI-生成代码使用" class="headerlink" title="2.3 AI 生成代码使用"></a>2.3 AI 生成代码使用</h3><h4 id="2-3-1-通过-Chat-交互模式-生成代码"><a href="#2-3-1-通过-Chat-交互模式-生成代码" class="headerlink" title="2.3.1 通过 Chat 交互模式,生成代码"></a>2.3.1 通过 Chat 交互模式,生成代码</h4><ol>
<li>打开 Chat 交互模式</li>
<li>输入需求内容,点击发送</li>
<li>等待 AI 生成代码</li>
<li>点击复制代码,复制到 README.md 文件中</li>
<li>点击保存,保存到本地<br><img data-src="https://cdn.jsdelivr.net/gh/strawferry/GSS@master/uPic/20250124/09-57-54-2G1u4V.png" alt="Chat 交互模式"></li>
</ol>
<p><img data-src="https://cdn.jsdelivr.net/gh/strawferry/GSS@master/uPic/20250124/10-00-55-GOa3bk.png" alt="保存应用或者回退应用代码"></p>
<h4 id="2-3-2-通过-Composer-交互模式-生成代码"><a href="#2-3-2-通过-Composer-交互模式-生成代码" class="headerlink" title="2.3.2 通过 Composer 交互模式,生成代码"></a>2.3.2 通过 Composer 交互模式,生成代码</h4><ol>
<li>打开 Composer 交互模式</li>
<li>输入需求内容,点击发送</li>
<li>等待 AI 生成代码</li>
<li>直接生成文件和代码,不需要复制代码</li>
</ol>
<p><img data-src="https://cdn.jsdelivr.net/gh/strawferry/GSS@master/uPic/20250124/10-15-25-zmvtLM.png" alt="Composer 交互模式"></p>
<h4 id="2-3-3-生成-Next-js-项目代码"><a href="#2-3-3-生成-Next-js-项目代码" class="headerlink" title="2.3.3 生成 Next.js 项目代码"></a>2.3.3 生成 Next.js 项目代码</h4><ol>
<li>刚才只是完善了 README.md 文件,现在我们来生成 Next.js 项目代码</li>
<li>打开 Chat 交互模式,问它 如何创建 Nextjs 项目,并跑起来</li>
<li>等待 AI 生成回复,这个地方比较好的方式是生成基本 Next.js 项目代码,然后从根目录复制代码进当前文件夹下面,这样可以避免 AI 生成的代码有问题,导致我们无法运行;</li>
<li>如果确定了技术栈,可以先生成初始代码后,在通过 cursor 打开项目文件,然后再继续下面的交互;</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npx create-next-app@latest translate</span><br><span class="line">✔ Would you like to use TypeScript? … No / Yes</span><br><span class="line">✔ Would you like to use ESLint? … No / Yes</span><br><span class="line">✔ Would you like to use Tailwind CSS? … No / Yes</span><br><span class="line">✔ Would you like your code inside a `src/` directory? … No / Yes</span><br><span class="line">✔ Would you like to use App Router? (recommended) … No / Yes</span><br><span class="line">✔ Would you like to use Turbopack <span class="keyword">for</span> `next dev`? … No / Yes</span><br><span class="line">✔ Would you like to customize the import <span class="built_in">alias</span> (`@/*` by default)? … No / Yes</span><br><span class="line">✔ What import <span class="built_in">alias</span> would you like configured? … @/*</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img data-src="https://cdn.jsdelivr.net/gh/strawferry/GSS@master/uPic/20250124/10-31-13-IjEyvR.png" alt="生成 Next.js 项目代码"></p>
<h4 id="2-3-4-让-AI-按照产品需求-完善代码"><a href="#2-3-4-让-AI-按照产品需求-完善代码" class="headerlink" title="2.3.4 让 AI 按照产品需求,完善代码"></a>2.3.4 让 AI 按照产品需求,完善代码</h4><ol>
<li>通过 Composer 交互模式,让 AI 按照产品需求,完善代码</li>
<li>待代码生成结束后,我们先点击 save all 保存所有代码,然后查看程序运行情况</li>
<li>确定代码可以使用后,选择 accept all 接受所有代码</li>
<li>一次生成的代码量不会太多,他会先生成基础代码,然后会有未完成的功能列表,让你去继续选择执行下面的功能,所以我们可以根据产品需求,选择执行下面的功能;</li>
<li>遇到需要安装依赖的,我们根据提示,安装依赖,然后继续执行下面的功能;</li>
<li>继续添加功能,直到所有功能都执行完毕;</li>
</ol>
<p><img data-src="https://cdn.jsdelivr.net/gh/strawferry/GSS@master/uPic/20250124/11-21-03-6Y2X5S.png" alt="按照产品需求,完善代码"><br><img data-src="https://cdn.jsdelivr.net/gh/strawferry/GSS@master/uPic/20250124/11-25-43-926tLL.png" alt="第一次生成,初始样式"></p>
<p><img data-src="https://cdn.jsdelivr.net/gh/strawferry/GSS@master/uPic/20250124/11-37-10-mAldxV.png" alt="4.选取功能点让继续生成"></p>
<p><img data-src="https://cdn.jsdelivr.net/gh/strawferry/GSS@master/uPic/20250124/11-42-33-15UulQ.png" alt="继续执行功能生成"></p>
<p><img data-src="https://cdn.jsdelivr.net/gh/strawferry/GSS@master/uPic/20250124/11-47-22-qztKIS.png" alt="安装依赖"></p>
<p><img data-src="https://cdn.jsdelivr.net/gh/strawferry/GSS@master/uPic/20250124/14-21-29-nyf2no.png" alt="基本功能实现完毕"></p>
<h4 id="2-3-5-UI-界面优化精细化调整"><a href="#2-3-5-UI-界面优化精细化调整" class="headerlink" title="2.3.5 UI 界面优化精细化调整"></a>2.3.5 UI 界面优化精细化调整</h4><p>方法 1:让其使用某个组件库如: shadcn ,并按照 Apple 的设计风格重新设计一下页面,并添加一些交互功能<br><img data-src="https://cdn.jsdelivr.net/gh/strawferry/GSS@master/uPic/20250124/14-50-18-hj5cGx.png" alt="使用组件"><br>方法 2: 自己手绘草图或者 UI 设计图,让其调整页面,并添加一些交互功能<br><img data-src="https://cdn.jsdelivr.net/gh/strawferry/GSS@master/uPic/20250124/14-53-18-Xlk5ad.png" alt="使用手绘草图,让其修改"></p>
<h4 id="2-3-6-使用的一些技巧"><a href="#2-3-6-使用的一些技巧" class="headerlink" title="2.3.6 使用的一些技巧"></a>2.3.6 使用的一些技巧</h4><ol>
<li><p>报错问题修复,直接在命令行中框选后,直接添加到 Chat 或者 Composer 中,让 AI 帮我们修复报错问题;<br><img data-src="https://cdn.jsdelivr.net/gh/strawferry/GSS@master/uPic/20250124/14-36-38-77k4Dp.png" alt="报错问题修复"></p>
</li>
<li><p>可以使用 Chat 模式处理一些简单的问题,如: 如何安装依赖,如何运行程序,如何打包程序等,使用 Composer 模式处理一些复杂的问题还有需要更改文件的地方; 模型能力上目前还是 claude 模型比较好,生成后需要我们自己去优化;</p>
</li>
<li><p><code>.cursorrules</code> 文件可以配置一些规则,让 AI 生成代码的时候,按照我们的规则生成,如: 生成的代码需要使用 typescript,生成的代码需要使用 tailwind css 等;</p>
</li>
</ol>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="section"># .cursorrules 文件</span></span><br><span class="line">你是一名资深前端开发专家，精通 ReactJS、NextJS、JavaScript、TypeScript、HTML、CSS 以及现代 UI/UX 框架（如 TailwindCSS、Shadcn、Radix）。</span><br><span class="line">你思维缜密，能够提供细致入微的答案，并擅长逻辑推理。你总是谨慎地提供准确、事实性、深思熟虑的答案，并且在推理方面堪称天才。</span><br><span class="line"></span><br><span class="line">严格遵循用户的需求，一丝不苟。</span><br><span class="line">首先逐步思考——用伪代码详细描述你的构建计划。</span><br><span class="line">确认后，再编写代码！</span><br><span class="line">始终编写正确、符合最佳实践、遵循 DRY 原则（不要重复自己）、无错误、功能齐全且可运行的代码，同时确保代码符合以下列出的代码实现指南。</span><br><span class="line">注重代码的简洁性和可读性，而非性能。</span><br><span class="line">完全实现所有请求的功能。</span><br><span class="line">不要留下任何待办事项、占位符或缺失的部分。</span><br><span class="line">确保代码完整！彻底验证最终结果。</span><br><span class="line">包含所有必需的导入，并确保关键组件的命名正确。</span><br><span class="line">保持简洁，尽量减少其他描述。</span><br><span class="line">如果你认为可能没有正确答案，请如实说明。</span><br><span class="line">如果你不知道答案，请如实说明，而不是猜测。</span><br><span class="line"></span><br><span class="line"><span class="section">### 编码环境</span></span><br><span class="line">用户询问以下编程语言相关的问题：</span><br><span class="line"><span class="bullet">-</span> ReactJS</span><br><span class="line"><span class="bullet">-</span> NextJS</span><br><span class="line"><span class="bullet">-</span> JavaScript</span><br><span class="line"><span class="bullet">-</span> TypeScript</span><br><span class="line"><span class="bullet">-</span> TailwindCSS</span><br><span class="line"><span class="bullet">-</span> HTML</span><br><span class="line"><span class="bullet">-</span> CSS</span><br><span class="line"></span><br><span class="line"><span class="section">### 代码实现指南</span></span><br><span class="line">编写代码时请遵循以下规则：</span><br><span class="line"><span class="bullet">-</span> 尽可能使用提前返回来提高代码的可读性。</span><br><span class="line"><span class="bullet">-</span> 始终使用 Tailwind 类来为 HTML 元素设置样式；避免使用 CSS 或标签。</span><br><span class="line"><span class="bullet">-</span> 在类标签中尽可能使用 <span class="code">`class:`</span> 而不是三元运算符。</span><br><span class="line"><span class="bullet">-</span> 使用描述性的变量和函数/常量名称。事件函数应以 <span class="code">`handle`</span> 为前缀命名，例如 <span class="code">`onClick`</span> 的事件函数命名为 <span class="code">`handleClick`</span>，<span class="code">`onKeyDown`</span> 的事件函数命名为 <span class="code">`handleKeyDown`</span>。</span><br><span class="line"><span class="bullet">-</span> 在元素上实现无障碍功能。例如，标签应具有 <span class="code">`tabindex=&quot;0&quot;`</span>、<span class="code">`aria-label`</span>、<span class="code">`on:click`</span>、<span class="code">`on:keydown`</span> 等属性。</span><br><span class="line"><span class="bullet">-</span> 使用 <span class="code">`const`</span> 而不是函数，例如 <span class="code">`const toggle = () =&gt;`</span>。如果可能，定义类型。</span><br><span class="line"><span class="bullet">-</span> 使用 <span class="code">`clsx`</span> 来处理多个条件类。</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="4">
<li><p><code>.cursorignore</code> 该文件是和 .gitignore 一样的语法,可以配置忽略的文件和文件夹,减少 AI 索引文件的时间,提高生成代码的速度;</p>
</li>
<li><p>可以多个 Chat 和 Composer 分功能模块,进行 AI 交互代码生成,推荐一个插件 <span class="exturl" data-url="aHR0cHM6Ly9tYXJrZXRwbGFjZS52aXN1YWxzdHVkaW8uY29tL2l0ZW1zP2l0ZW1OYW1lPVNwZWNTdG9yeS5zcGVjc3RvcnktdnNjb2Rl">SpecStory (Cursor Extension)<i class="fa fa-external-link-alt"></i></span>,该插件可以导出 Chat 和 Composer 的交互记录;</p>
</li>
</ol>
<p><img data-src="https://cdn.jsdelivr.net/gh/strawferry/GSS@master/uPic/20250124/16-42-25-niEHE7.png" alt="Chat 和 Composer 的交互记录"></p>
<h3 id="3-总结"><a href="#3-总结" class="headerlink" title="3. 总结"></a>3. 总结</h3><ol>
<li>通过使用 Cursor 编辑器,发现现在 AI 的能力越来越强,可以为我们提效很多;</li>
<li>目前需要学的是和 AI 沟通技巧,让 AI 按照我们的需求生成代码,如何让 AI 按照我们的需求优化代码;</li>
<li>做新产品和小工具通过 Cursor 是真的非常快,不过还是需要一定的产品和代码基础,不然容易出现 bug 等边界问题;</li>
</ol>
]]></content>
  </entry>
  <entry>
    <title>折腾Hexo</title>
    <url>/2016/04/12/Hexo%20%E5%8D%9A%E5%AE%A2%E7%9A%84%E5%AE%89%E8%A3%85%E6%B5%81%E7%A8%8B/</url>
    <content><![CDATA[<h2 id="Hexo-博客的安装流程"><a href="#Hexo-博客的安装流程" class="headerlink" title="Hexo 博客的安装流程"></a>Hexo 博客的安装流程</h2><h3 id="1-配置环境"><a href="#1-配置环境" class="headerlink" title="1.  配置环境"></a>1.  配置环境</h3><p>因为本人是用 Mac 所以就以主要介绍 Mac 的环境为主;</p>
<h4 id="1-1-安装-Node-环境"><a href="#1-1-安装-Node-环境" class="headerlink" title="1.1 安装 Node 环境"></a>1.1 安装 Node 环境</h4><blockquote>
<p>作用：用来生成静态页面的</p>
</blockquote>
<p>方法1. 直接上 <span class="exturl" data-url="aHR0cHM6Ly9ub2RlanMub3JnLw==">https://nodejs.org/<i class="fa fa-external-link-alt"></i></span> 官网下载安装</p>
<p>方法2. Homebrew 安装<br><span class="exturl" data-url="aHR0cDovL2JyZXcuc2gv">Homebrew<i class="fa fa-external-link-alt"></i></span> 是 Mac 系统的包管理器，用于安装 NodeJS 和一些其他必需的工具软件。</p>
<p>首先, 安装 Homebrew;</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/usr/bin/ruby -e <span class="string">&quot;<span class="subst">$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)</span>&quot;</span></span><br></pre></td></tr></table></figure>

<p>复制上面代码在终端里面运行,等待安装完毕;</p>
<p>接下来在用 Homebrew 安装 Node;</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">brew install node</span><br></pre></td></tr></table></figure>

<p> 复制上面代码在终端里面运行,等待安装完毕;</p>
<h4 id="1-2-Github-或者-Coding-账户都可以"><a href="#1-2-Github-或者-Coding-账户都可以" class="headerlink" title="1.2  Github 或者 Coding 账户都可以"></a>1.2  <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tLw==">Github<i class="fa fa-external-link-alt"></i></span> 或者 <span class="exturl" data-url="aHR0cHM6Ly9jb2RpbmcubmV0Lw==">Coding<i class="fa fa-external-link-alt"></i></span> 账户都可以</h4><blockquote>
<p>作用：是用来做博客的远程创库、域名、服务器之类的，怎么与本地hexo建立连接等下讲。</p>
</blockquote>
<h3 id="2-正式安装-Hexo"><a href="#2-正式安装-Hexo" class="headerlink" title="2. 正式安装 Hexo"></a>2. 正式安装 Hexo</h3><h4 id="2-1-安装-Hexo-的命令行工具"><a href="#2-1-安装-Hexo-的命令行工具" class="headerlink" title="2.1 安装 Hexo 的命令行工具"></a>2.1 安装 Hexo 的命令行工具</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install -g hexo</span><br></pre></td></tr></table></figure>

<p>复制上面代码在终端里面运行,等待安装完毕;</p>
<h4 id="2-2-初始化博客"><a href="#2-2-初始化博客" class="headerlink" title="2.2 初始化博客"></a>2.2 初始化博客</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">hexo init 你的博客名</span><br></pre></td></tr></table></figure>

<p>在终端中前往你要放置博客的文件夹位置, 运行上面代码,等待安装完毕;</p>
<h4 id="2-3-配置-Github-仓库"><a href="#2-3-配置-Github-仓库" class="headerlink" title="2.3 配置 Github 仓库"></a>2.3 配置 Github 仓库</h4><p>登录到你自己的 github 账号, 点击 new repository 开始创建仓库, 按照下面的填写你自己要的参数;<br><img data-src="https://ws4.sinaimg.cn/large/8bbf0afbgw1faodnclhivj20lr0hhwhx.jpg" alt="创建仓库"><br>配置 github pages 页面, 点击 Settings , 在 GitHub Pages 中开启配置为主分支<br><img data-src="https://ws2.sinaimg.cn/large/8bbf0afbgw1faodocx895j20l90gtdje.jpg" alt="配置 github pages"></p>
<h4 id="2-4-配置-Hexo-文件"><a href="#2-4-配置-Hexo-文件" class="headerlink" title="2.4 配置 Hexo 文件"></a>2.4 配置 Hexo 文件</h4><p>打开 Hexo 创建的根目录下的 _config.yml 文件,主要配置如下<br><img data-src="https://ws4.sinaimg.cn/large/8bbf0afbgw1faodmmnzjoj206a0ccgmb.jpg" alt="_config.yml 文件"></p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Site</span></span><br><span class="line"><span class="attr">title:</span> <span class="string">you</span> <span class="string">blog</span>  <span class="string">//</span> <span class="string">你博客的名称标题</span></span><br><span class="line"><span class="attr">subtitle:</span> <span class="string">//</span> <span class="string">你博客的小标题(选填)</span></span><br><span class="line"><span class="attr">description:</span> <span class="string">好好过一生</span> <span class="string">//</span> <span class="string">博客的描述,可以写短小的座右铭</span></span><br><span class="line"><span class="attr">author:</span> <span class="string">FerryVip</span> <span class="string">//</span> <span class="string">作者你的名字</span></span><br><span class="line"><span class="attr">language:</span> <span class="string">zh-Hans</span> <span class="string">//</span> <span class="string">设置博客的语音(选填,默认英文)</span></span><br><span class="line"><span class="attr">timezone:</span> <span class="string">//</span> <span class="string">时区(选填)</span></span><br></pre></td></tr></table></figure>


<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Deployment</span></span><br><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">git</span>  <span class="string">//</span> <span class="string">类型就填</span> <span class="string">git</span></span><br><span class="line">  <span class="attr">repo:</span> <span class="string">git@github.com:strawferry/FerryBlog.git</span> <span class="string">//</span> <span class="string">你的仓库地址,在配置</span> <span class="string">github</span> <span class="string">仓库成功后会有,可以用</span> <span class="string">HTTPS</span> <span class="string">(需要输入密码登录)和</span> <span class="string">SSH(需要配置SSH)</span> </span><br><span class="line">  <span class="attr">branch:</span> <span class="string">master</span> <span class="string">//</span> <span class="string">默认主分支</span></span><br></pre></td></tr></table></figure>


<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure>

<p>复制上面代码在终端的 hexo 目录下里面运行,等待安装完毕;</p>
<h4 id="2-5-node-生成静态文件"><a href="#2-5-node-生成静态文件" class="headerlink" title="2.5 node 生成静态文件"></a>2.5 node 生成静态文件</h4><blockquote>
<p><code>hexo generate</code> 或者 <code>hexo g</code></p>
</blockquote>
<p>复制上面代码在终端的 hexo 目录下里面运行,等待运行完毕;</p>
<h4 id="2-6-本地运行查看"><a href="#2-6-本地运行查看" class="headerlink" title="2.6 本地运行查看"></a>2.6 本地运行查看</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">hexo server</span><br><span class="line">或者 </span><br><span class="line">hexo s</span><br></pre></td></tr></table></figure>

<p>复制上面代码在终端的 hexo 目录下里面运行,等待运行完毕, 显示通过访问 <code>http://localhost:4000/</code> 就可以预览博客;<br><img data-src="https://ws2.sinaimg.cn/large/8bbf0afbgw1faodsdxgi6j20zl0u4wl0.jpg"></p>
<h4 id="2-6-上传博客文件到-github"><a href="#2-6-上传博客文件到-github" class="headerlink" title="2.6 上传博客文件到 github"></a>2.6 上传博客文件到 github</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">hexo deploy</span><br><span class="line">或者 </span><br><span class="line">hexo d</span><br></pre></td></tr></table></figure>


<p>复制上面代码在终端的 hexo 目录下里面运行,等待运行完毕;<br>等待运行完毕基本就能访问刚才在 github 配置 pages 的链接了;</p>
<h4 id="2-7-编写你的博客"><a href="#2-7-编写你的博客" class="headerlink" title="2.7 编写你的博客"></a>2.7 编写你的博客</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">hexo new <span class="string">&quot;new article&quot;</span></span><br></pre></td></tr></table></figure>

<p>之后在source&#x2F;_posts目录下面，多了一个new-article.md的文件。<br>你通过编辑 new-article.md 就可以写你的日记了;</p>
<h4 id="2-8-一些常用的命令"><a href="#2-8-一些常用的命令" class="headerlink" title="2.8 一些常用的命令"></a>2.8 一些常用的命令</h4><blockquote>
<p> <code>hexo clean</code> &#x2F;&#x2F; 清除文件</p>
<p> <code>hexo generate</code> &#x2F;&#x2F; 生成静态文件</p>
<p> <code>hexo deploy</code> &#x2F;&#x2F; 部署代码上去 </p>
<p> <code>hexo new &quot;文章标题&quot;</code> &#x2F;&#x2F; 创建新文章</p>
</blockquote>
<h3 id="3-配置-Hexo-主题"><a href="#3-配置-Hexo-主题" class="headerlink" title="3. 配置 Hexo 主题"></a>3. 配置 Hexo 主题</h3><p>官方默认主题你懂得,不怎么好看,果断自己换个,本人觉得 <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2lpc3NuYW4vaGV4by10aGVtZS1uZXh0">next<i class="fa fa-external-link-alt"></i></span> 的主题还可以,这边就以配置这个主题举个栗子;<br><span class="exturl" data-url="aHR0cDovL3RoZW1lLW5leHQuaWlzc25hbi5jb20v">官方使用文档<i class="fa fa-external-link-alt"></i></span></p>
<p>主题下载</p>
<blockquote>
<p><code>git clone https://github.com/iissnan/hexo-theme-next themes/next</code></p>
</blockquote>
<p>复制上面代码在终端的 hexo 目录下里面运行,等待下载完毕;</p>
<p>主题更改</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># Extensions</span><br><span class="line">## Plugins: https://hexo.io/plugins/</span><br><span class="line">## Themes: https://hexo.io/themes/</span><br><span class="line">theme: landscape // 改为 next</span><br></pre></td></tr></table></figure>

<h2 id="到此基本配置-Hexo-和-主题更换已经都会了-要更好使用-还需要自己看下文档去详细配置"><a href="#到此基本配置-Hexo-和-主题更换已经都会了-要更好使用-还需要自己看下文档去详细配置" class="headerlink" title="到此基本配置 Hexo 和 主题更换已经都会了,要更好使用,还需要自己看下文档去详细配置;"></a>到此基本配置 Hexo 和 主题更换已经都会了,要更好使用,还需要自己看下文档去详细配置;</h2><h1 id="说说之前配置遇到的一个坑-前面我没有说到-就是要等大家都配置完了-大伙也会碰到的问题-在最后给大家说一下"><a href="#说说之前配置遇到的一个坑-前面我没有说到-就是要等大家都配置完了-大伙也会碰到的问题-在最后给大家说一下" class="headerlink" title="说说之前配置遇到的一个坑, 前面我没有说到,就是要等大家都配置完了,大伙也会碰到的问题,在最后给大家说一下"></a>说说之前配置遇到的一个坑, 前面我没有说到,就是要等大家都配置完了,大伙也会碰到的问题,在最后给大家说一下</h1><p><img data-src="https://ws4.sinaimg.cn/large/8bbf0afbgw1faoe9p3zvtj20zk0u0jx2.jpg"></p>
<p>就是在本地跑 <code>hexo server</code> 一切看起来都好好的,样式都没啥问题, 当去看 pages 的时候,发现样式惨不忍睹,这就对了,因为还有一个东西还没有配置;</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># URL</span><br><span class="line">## If your site is put in a subdirectory, set url as &#x27;http://yoursite.com/child&#x27; and root as &#x27;/child/&#x27;</span><br><span class="line">url: http://yoursite.com  // 把你在 pages 配置的那个网址链接复制在这个地方就解决了</span><br><span class="line">root: /</span><br><span class="line">permalink: :year/:month/:day/:title/</span><br><span class="line">permalink_defaults:</span><br></pre></td></tr></table></figure>





]]></content>
      <tags>
        <tag>hexo配置</tag>
      </tags>
  </entry>
  <entry>
    <title>Jenkins 基本食用方法</title>
    <url>/2019/07/22/Jenkins%20%E5%9F%BA%E6%9C%AC%E9%A3%9F%E7%94%A8%E6%96%B9%E6%B3%95/</url>
    <content><![CDATA[<h1 id="Jenkins-基本食用方法"><a href="#Jenkins-基本食用方法" class="headerlink" title="Jenkins 基本食用方法"></a>Jenkins 基本食用方法</h1><h2 id="0-介绍"><a href="#0-介绍" class="headerlink" title="0. 介绍"></a>0. 介绍</h2><p>Jenkins是一个开源软件项目，是基于Java开发的一种持续集成工具，用于监控持续重复的工作，旨在提供一个开放易用的软件平台，使软件的持续集成变成可能。</p>
<p>Jenkins功能包括：</p>
<ol>
<li>持续的软件版本发布&#x2F;测试项目。</li>
<li>监控外部调用执行的工作。</li>
</ol>
<h2 id="1-安装-Mac-OS"><a href="#1-安装-Mac-OS" class="headerlink" title="1. 安装(Mac OS)"></a>1. 安装(Mac OS)</h2><p>通过 brew 安装 Jenkins,其中可能还需要 Java 环境依赖,需要去<span class="exturl" data-url="aHR0cHM6Ly93d3cub3JhY2xlLmNvbS90ZWNobmV0d29yay9qYXZhL2phdmFzZS9kb3dubG9hZHMvaW5kZXguaHRtbA==">官网下载<i class="fa fa-external-link-alt"></i></span> jdk,我这边用的是 <span class="exturl" data-url="aHR0cHM6Ly93d3cub3JhY2xlLmNvbS90ZWNobmV0d29yay9qYXZhL2phdmFzZS9kb3dubG9hZHMvamRrOC1kb3dubG9hZHMtMjEzMzE1MS5odG1s">jdk1.8<i class="fa fa-external-link-alt"></i></span></p>
<p>安装: <code>brew install jenkins</code></p>
<ul>
<li><p>直接启动: <code>jenkins</code> 就可以启动,退出命令行就关闭服务</p>
</li>
<li><p>通过 <code>brew services</code></p>
<p>  启动: <code>brew services start jenkins</code>  </p>
<p>  重启: <code>brew services restart jenkins</code></p>
<p>  关闭: <code>brew services stop jenkins</code></p>
</li>
</ul>
<h2 id="2-初始配置"><a href="#2-初始配置" class="headerlink" title="2. 初始配置"></a>2. 初始配置</h2><p>第一次安装后启动需要做初始配置</p>
<ul>
<li>解锁 Jenkins ,从命令行或者提示的路径找到密码</li>
</ul>
<blockquote>
<p><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1g58i9ovvlej22rs12awsx.jpg"></p>
</blockquote>
<ul>
<li>自定义一些扩展插件,可选择安装推荐的或者自选,选择推荐安装,后续管理插件还能继续安装</li>
</ul>
<blockquote>
<p><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1g58i9ojhlaj21kq0ycae5.jpg"><br><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1g58i9p3i4zj21ku10eqc4.jpg"></p>
</blockquote>
<ul>
<li>创建管理账户</li>
</ul>
<blockquote>
<p><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1g58j1ckpdwj21ke0zygot.jpg"></p>
</blockquote>
<ul>
<li>然后就进入 Jenkins 了</li>
</ul>
<blockquote>
<p><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1g58j1bttb2j21oy0zqn0w.jpg"></p>
</blockquote>
<ul>
<li>插件的查找和安装</li>
</ul>
<blockquote>
<p><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1g58j1c07o1j21p614e11w.jpg"><br><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1g58j1bs7jjj21ro0xcwkg.jpg"></p>
</blockquote>
<ul>
<li>简单的创建任务</li>
</ul>
<blockquote>
<p>创建任务,给任务起一个名<br><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1g58k5cd6z0j21ro1e4qd3.jpg"><br>任务做配置,如 描述,Git,构建等;<br><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1g58k5cdp55j21e628ealp.jpg"><br>任务构建,以及进度条<br><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1g58k5c7y2hj226k0wmn23.jpg"><br>构建日志输出<br><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1g58k5cfwn7j226w140dtn.jpg"></p>
</blockquote>
<h2 id="3-一些好用的插件"><a href="#3-一些好用的插件" class="headerlink" title="3.一些好用的插件"></a>3.一些好用的插件</h2><ul>
<li><span class="exturl" data-url="aHR0cHM6Ly93aWtpLmplbmtpbnMuaW8vZGlzcGxheS9KRU5LSU5TL0R5bmFtaWMrRXh0ZW5kZWQrQ2hvaWNlK1BhcmFtZXRlcitwbHVnaW4=">动态参数构建 Dynamic Extended Choice Parameter<i class="fa fa-external-link-alt"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly93aWtpLmplbmtpbnMuaW8vZGlzcGxheS9KRU5LSU5TL0dpdCtQYXJhbWV0ZXIrUGx1Z2lu">Git 参数 Git Parameter<i class="fa fa-external-link-alt"></i></span></li>
</ul>
<blockquote>
<p><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1g58ljspuc7j233r26nnj2.jpg"></p>
</blockquote>
<ul>
<li><span class="exturl" data-url="aHR0cHM6Ly93aWtpLmplbmtpbnMuaW8vZGlzcGxheS9KRU5LSU5TL0J1aWxkK05hbWUrU2V0dGVyK1BsdWdpbg==">Build Name Setter<i class="fa fa-external-link-alt"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly93aWtpLmplbmtpbnMuaW8vZGlzcGxheS9KRU5LSU5TL1Byb2plY3QrRGVzY3JpcHRpb24rU2V0dGVyK1BsdWdpbg==">设置构建后描述 Project Description Setter<i class="fa fa-external-link-alt"></i></span></li>
</ul>
<blockquote>
<p><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1g58ltjmgxqj231p1y2nkr.jpg"></p>
</blockquote>
<ul>
<li><span class="exturl" data-url="aHR0cHM6Ly93aWtpLmplbmtpbnMuaW8vZGlzcGxheS9KRU5LSU5TL0xvY2FsZStQbHVnaW4=">设置强制语言包 Locale<i class="fa fa-external-link-alt"></i></span></li>
</ul>
<blockquote>
<p><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1g58m3hjdcij23be1fe4gz.jpg"></p>
</blockquote>
<h2 id="4-一些问题解决"><a href="#4-一些问题解决" class="headerlink" title="4. 一些问题解决"></a>4. 一些问题解决</h2><ul>
<li>有些时候 git 内容很大,pull 时会出现超时导致构建失败!</li>
</ul>
<p>解决方式:  Git 配置时添加一个 clone 的配置把超时改为 60 或者更多,把超时改大,一般就第一次的 pull 会请求比较久,后续都是增量的,会比较快了;</p>
<blockquote>
<p><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1g58faae3lij227a1ew47n.jpg"></p>
</blockquote>
<h2 id="5-等等"><a href="#5-等等" class="headerlink" title="5. 等等"></a>5. 等等</h2><p>等待继续研究,估计是和 docker 相关的!</p>
]]></content>
  </entry>
  <entry>
    <title>React Native 特定平台选择-Platform</title>
    <url>/2016/06/26/React%20Native%20%E7%89%B9%E5%AE%9A%E5%B9%B3%E5%8F%B0%E9%80%89%E6%8B%A9-Platform/</url>
    <content><![CDATA[<h3 id="1-特定平台扩展名"><a href="#1-特定平台扩展名" class="headerlink" title="1. 特定平台扩展名"></a>1. 特定平台扩展名</h3><blockquote>
<p>React Native会检测某个文件是否具有.ios.或是.android.的扩展名，然后根据当前运行的平台加载正确对应的文件。<br>假设你的项目中有如下两个文件：<br><code>BigButton.ios.js</code><br><code>BigButton.android.js</code><br>这样命名组件后你就可以在其他组件中直接引用，而无需关心当前运行的平台是哪个。<br><code>import BigButton from &#39;./components/BigButton&#39;;</code></p>
</blockquote>
<h3 id="2-实用的方法是Platform-select"><a href="#2-实用的方法是Platform-select" class="headerlink" title="2. 实用的方法是Platform.select()"></a>2. 实用的方法是Platform.select()</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> &#123; <span class="title class_">Platform</span> &#125; = <span class="title class_">React</span>;</span><br><span class="line"><span class="keyword">var</span> styles = <span class="title class_">StyleSheet</span>.<span class="title function_">create</span>(&#123;</span><br><span class="line">  <span class="attr">container</span>: &#123;</span><br><span class="line">    <span class="attr">flex</span>: <span class="number">1</span>,</span><br><span class="line">    ...<span class="title class_">Platform</span>.<span class="title function_">select</span>(&#123;</span><br><span class="line">      <span class="attr">ios</span>: &#123;</span><br><span class="line">        <span class="attr">backgroundColor</span>: <span class="string">&#x27;red&#x27;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">android</span>: &#123;</span><br><span class="line">        <span class="attr">backgroundColor</span>: <span class="string">&#x27;blue&#x27;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;),</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//上面的代码会根据平台的不同返回不同的container样式——iOS上背景色为红色，而android为蓝色。</span></span><br><span class="line">这一方法可以接受任何合法类型的参数，因此你也可以直接用它针对不同平台返回不同的组件，像下面这样：</span><br><span class="line"><span class="keyword">var</span> <span class="title class_">Component</span> = <span class="title class_">Platform</span>.<span class="title function_">select</span>(&#123;</span><br><span class="line">  <span class="attr">ios</span>: <span class="function">() =&gt;</span> <span class="built_in">require</span>(<span class="string">&#x27;ComponentIOS&#x27;</span>),</span><br><span class="line">  <span class="attr">android</span>: <span class="function">() =&gt;</span> <span class="built_in">require</span>(<span class="string">&#x27;ComponentAndroid&#x27;</span>),</span><br><span class="line">&#125;)();</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">Component</span> /&gt;</span></span>;</span><br></pre></td></tr></table></figure>

<h3 id="3-平台模块"><a href="#3-平台模块" class="headerlink" title="3. 平台模块"></a>3. 平台模块</h3><p>React Native提供了一个检测当前运行平台的模块。如果组件只有一小部分代码需要依据平台定制，那么这个模块就可以派上用场。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import &#123; Platform &#125; from &#x27;react-native&#x27;;</span><br><span class="line">var styles = StyleSheet.create(&#123;</span><br><span class="line">  height: (Platform.OS === &#x27;ios&#x27;) ? 200 : 100,</span><br><span class="line">&#125;);</span><br><span class="line">//Platform.OS在iOS上会返回ios，而在Android设备或模拟器上则会返回android。</span><br></pre></td></tr></table></figure>

<h3 id="4-检测Android版本"><a href="#4-检测Android版本" class="headerlink" title="4. 检测Android版本"></a>4. 检测Android版本</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//在Android上，平台模块还可以用来检测当前所运行的Android平台的版本：</span><br><span class="line">import &#123; Platform &#125; from &#x27;react-native&#x27;;</span><br><span class="line">if(Platform.Version === 21)&#123;</span><br><span class="line">  console.log(&#x27;Running on Lollipop!&#x27;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><span class="exturl" data-url="aHR0cDovL3JlYWN0bmF0aXZlLmNuL2RvY3MvMC4yOC9wbGF0Zm9ybS1zcGVjaWZpYy1jb2RlLmh0bWwjY29udGVudA==">摘自React Native CN<i class="fa fa-external-link-alt"></i></span></p>
]]></content>
  </entry>
  <entry>
    <title>Log4js - Appenders 开发,消息直发钉钉机器人</title>
    <url>/2018/02/26/Log4js%20-%20Appenders%20%E5%BC%80%E5%8F%91,%E6%B6%88%E6%81%AF%E7%9B%B4%E5%8F%91%E9%92%89%E9%92%89%E6%9C%BA%E5%99%A8%E4%BA%BA/</url>
    <content><![CDATA[<h2 id="项目说明"><a href="#项目说明" class="headerlink" title="项目说明"></a>项目说明</h2><p>在一些 Node 的项目中,一直使用 <code>log4js</code> 的做日志插件,然后发现里面有个 <code>appenders </code> 插件,可以发送消息到国外软件 <code>slack</code> 里,这样就可以便捷的做一些扩展,可是本人最近在用钉钉,而且那个接触也少,所以本着东西(接口文档的)都有,就找了时间自己撸了一个出来.</p>
<h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><p>找了一下两家的文档</p>
<blockquote>
<p><a href="https://github.com/log4js-node/log4js-node"><code>log4js</code> 文档</a></p>
</blockquote>
<blockquote>
<p><a href="https://log4js-node.github.io/log4js-node/appenders.html"><code>Log4js - Appenders</code></a></p>
</blockquote>
<blockquote>
<p><a href="https://log4js-node.github.io/log4js-node/slack.html"><code>Slack Appender</code></a></p>
</blockquote>
<blockquote>
<p><span class="exturl" data-url="aHR0cHM6Ly9vcGVuLWRvYy5kaW5ndGFsay5jb20vZG9jcy9kb2MuaHRtP3NwbT1hMjE5YS43NjI5MTQwLjAuMC5WOFdiMk8mdHJlZUlkPTI1NyZhcnRpY2xlSWQ9MTA1NzM1JmRvY1R5cGU9MQ==">钉钉自定义机器人文档<i class="fa fa-external-link-alt"></i></span></p>
</blockquote>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p><code>npm install --save log4jsdd log4js</code></p>
<h2 id="配置-log4js"><a href="#配置-log4js" class="headerlink" title="配置 log4js"></a>配置 log4js</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> log4js = <span class="built_in">require</span>(<span class="string">&#x27;log4js&#x27;</span>);</span><br><span class="line">log4js.<span class="title function_">configure</span>(&#123;</span><br><span class="line">    <span class="attr">appenders</span>: &#123;</span><br><span class="line">        <span class="attr">out</span>: &#123; <span class="attr">type</span>: <span class="string">&#x27;stdout&#x27;</span>&#125;,</span><br><span class="line">        <span class="attr">dingding</span>: &#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;log4jsdd&#x27;</span>,</span><br><span class="line">            <span class="attr">hookUrl</span>: <span class="string">&#x27;填写获取钉钉里面设置的 webhook 地址&#x27;</span>,</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;Node 消息&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">categories</span>: &#123; <span class="attr">default</span>: &#123; <span class="attr">appenders</span>: [<span class="string">&#x27;out&#x27;</span>, <span class="string">&#x27;dingding&#x27;</span>], <span class="attr">level</span>: <span class="string">&#x27;debug&#x27;</span> &#125;&#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> app = log4js.<span class="title function_">getLogger</span>();</span><br><span class="line">app.<span class="title function_">info</span>(<span class="string">&#x27;测试发送到钉钉&#x27;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="钉钉机器人配置"><a href="#钉钉机器人配置" class="headerlink" title="钉钉机器人配置"></a>钉钉机器人配置</h2><p><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1fotncinog2j21hc0xgwjw.jpg"><br><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1fotncimouoj21hc0xggpf.jpg"><br><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1fotncinqkwj21hc0xg0yf.jpg"><br><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1fotncimw5kj21280uumz6.jpg"><br><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1fotncin1ebj212a0uutbn.jpg"><br><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1fotncipj81j21hc0xg7a3.jpg"></p>
<h2 id="地址"><a href="#地址" class="headerlink" title="地址"></a>地址</h2><blockquote>
<p><a href="https://github.com/strawferry/log4jsdd"><strong>GitHub 仓库地址</strong></a></p>
</blockquote>
<blockquote>
<p><a href="https://www.npmjs.com/package/log4jsdd"><strong>npm 地址</strong></a></p>
</blockquote>
<h1 id="个人博客"><a href="#个人博客" class="headerlink" title="个人博客"></a>个人博客</h1><h3 id="博客地址-https-cblog-ferryvip-com"><a href="#博客地址-https-cblog-ferryvip-com" class="headerlink" title="博客地址: https://cblog.ferryvip.com/"></a><strong>博客地址: <a href="https://cblog.ferryvip.com/"><code>https://cblog.ferryvip.com/</code></a></strong></h3>]]></content>
  </entry>
  <entry>
    <title>ReactNative style样式之Flexbox布局样式</title>
    <url>/2016/06/15/ReactNative%20style%E6%A0%B7%E5%BC%8F%E4%B9%8BFlexbox%E5%B8%83%E5%B1%80%E6%A0%B7%E5%BC%8F/</url>
    <content><![CDATA[<h1 id="ReactNative-style样式之Flexbox布局样式"><a href="#ReactNative-style样式之Flexbox布局样式" class="headerlink" title="ReactNative style样式之Flexbox布局样式"></a>ReactNative style样式之Flexbox布局样式</h1><hr>
<h3 id="Flexbox布局样式-ReactNative是参考文档大于0-29的版本"><a href="#Flexbox布局样式-ReactNative是参考文档大于0-29的版本" class="headerlink" title="Flexbox布局样式 ReactNative是参考文档大于0.29的版本"></a>Flexbox布局样式 ReactNative是参考文档大于0.29的版本</h3><hr>
<p><span class="exturl" data-url="aHR0cDovL3d3dy5ydWFueWlmZW5nLmNvbS9ibG9nLzIwMTUvMDcvZmxleC1ncmFtbWFyLmh0bWw=">参考链接2<i class="fa fa-external-link-alt"></i></span></p>
<p><span class="exturl" data-url="aHR0cHM6Ly9jc3MtdHJpY2tzLmNvbS9zbmlwcGV0cy9jc3MvYS1ndWlkZS10by1mbGV4Ym94Lw==">参考链接1<i class="fa fa-external-link-alt"></i></span></p>
<h3 id="1-6个属性设置在容器上"><a href="#1-6个属性设置在容器上" class="headerlink" title="1. 6个属性设置在容器上"></a>1. 6个属性设置在容器上</h3><h4 id="1-1-任何一个容器都可以指定为Flex布局。ReactNative无"><a href="#1-1-任何一个容器都可以指定为Flex布局。ReactNative无" class="headerlink" title="1.1 任何一个容器都可以指定为Flex布局。ReactNative无"></a>1.1 任何一个容器都可以指定为Flex布局。<strong>ReactNative无</strong></h4><blockquote>
<p><strong>display: flex;</strong></p>
</blockquote>
<blockquote>
<p><strong>display: inline-flex; &#x2F;&#x2F;行内元素也可以使用Flex布局。</strong><br><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1fq8jap7mwnj21gc0va0zo.jpg" alt="flex布局元素"></p>
</blockquote>
<h4 id="1-2-flex-direction-属性决定主轴的方向（即项目的排列方向）。"><a href="#1-2-flex-direction-属性决定主轴的方向（即项目的排列方向）。" class="headerlink" title="1.2 flex-direction 属性决定主轴的方向（即项目的排列方向）。"></a>1.2 <code>flex-direction</code> 属性决定主轴的方向（即项目的排列方向）。</h4><blockquote>
<p><code>flex-direction: row(默认值) | row-reverse | column | column-reverse</code>;</p>
</blockquote>
<hr>
<blockquote>
<p>ReactNative 中的 <code>flexDirection</code>: <code>column</code>(默认值) | <code>column-reverse</code> | <code>row</code> | <code>row-reverse</code>;<br><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1fq8jbmm98sj21c20dy3zr.jpg" alt="flex-direction 排列方向"></p>
</blockquote>
<h4 id="1-3-flex-wrap-换行"><a href="#1-3-flex-wrap-换行" class="headerlink" title="1.3 flex-wrap 换行"></a>1.3 <code>flex-wrap</code> 换行</h4><blockquote>
<p><code>flex-wrap: nowrap | wrap | wrap-reverse</code>;</p>
</blockquote>
<hr>
<blockquote>
<p>ReactNative 中的 <code>flexWrap</code>: <code>nowrap</code> | <code>wrap</code> ;<br><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1fq8jc2qtr0j215m1460zt.jpg" alt="flex-wrap 换行"></p>
</blockquote>
<h4 id="1-4-flex-flow-flex-direction-和flex-wrap-的简写-ReactNative无"><a href="#1-4-flex-flow-flex-direction-和flex-wrap-的简写-ReactNative无" class="headerlink" title="1.4 flex-flow flex-direction 和flex-wrap 的简写 ReactNative无"></a>1.4 <code>flex-flow</code> flex-direction 和flex-wrap 的简写 <strong>ReactNative无</strong></h4><blockquote>
<p><code>flex-flow : row || nowrap</code>;<br><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1fq8jcg1tljj21gu0c2762.jpg" alt="flex-flow"></p>
</blockquote>
<h4 id="1-5-justify-content-水平排列方式"><a href="#1-5-justify-content-水平排列方式" class="headerlink" title="1.5 justify-content 水平排列方式"></a>1.5 justify-content 水平排列方式</h4><blockquote>
<p><code>justify-content: flex-start | flex-end | center | space-between | space-around</code>;<br><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1fq8jcr73b1j218m0acgnf.jpg" alt="justify-content 水平排列方式"></p>
</blockquote>
<hr>
<blockquote>
<p>ReactNative中的 <code>justifyContent: flex-start | flex-end | center | space-between | space-around</code>;<br><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1fq8jd9q5gbj20hp0l70sn.jpg" alt="justify-content 水平排列方式"></p>
</blockquote>
<h4 id="1-6-align-items-垂直排列方式"><a href="#1-6-align-items-垂直排列方式" class="headerlink" title="1.6 align-items 垂直排列方式"></a>1.6 align-items 垂直排列方式</h4><blockquote>
<p><code>align-items: flex-start | flex-end | center | baseline | stretch</code>;<br><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1fq8jehu5qqj21bw0a00uq.jpg" alt="align-items 垂直排列方式"></p>
</blockquote>
<hr>
<blockquote>
<p>ReactNative中的 <code>alignItems: flex-start | flex-end | center | stretch</code>;<br><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1fq8jewomp8j20h50lu3yg.jpg" alt="align-items 垂直排列方式"></p>
</blockquote>
<h3 id="2-容器中项目的属性"><a href="#2-容器中项目的属性" class="headerlink" title="2. 容器中项目的属性"></a>2. 容器中项目的属性</h3><h4 id="2-1-order-ReactNative无"><a href="#2-1-order-ReactNative无" class="headerlink" title="2.1 order ReactNative无"></a>2.1 order <strong>ReactNative无</strong></h4><blockquote>
<p><code>order :&lt;number&gt;</code>; &#x2F;* default 0 *&#x2F;属性定义项目的排列顺序。数值越小，排列越靠前，默认为0。<br><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1fq8jf66cjzj20kv0dca9v.jpg" alt="order"></p>
</blockquote>
<h4 id="2-2-flex-grow-ReactNative无"><a href="#2-2-flex-grow-ReactNative无" class="headerlink" title="2.2 flex-grow ReactNative无"></a>2.2 flex-grow <strong>ReactNative无</strong></h4><blockquote>
<p><code>flex-grow:&lt;number&gt;</code>; &#x2F;* default 0 *&#x2F;属性定义项目的放大比例，默认为0，即如果存在剩余空间，也不放大。如果所有项目的flex-grow属性都为1，则它们将等分剩余空间（如果有的话）。如果一个项目的flex-grow属性为2，其他项目都为1，则前者占据的剩余空间将比其他项多一倍。<br><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1fq8jfhit38j20ma05v3yf.jpg" alt="flex-grow"></p>
</blockquote>
<h4 id="2-3-flex-shrink-ReactNative无"><a href="#2-3-flex-shrink-ReactNative无" class="headerlink" title="2.3 flex-shrink ReactNative无"></a>2.3 flex-shrink <strong>ReactNative无</strong></h4><blockquote>
<p>flex-shrink: <number>; &#x2F;* default 1 *&#x2F;属性定义了项目的缩小比例，默认为1，即如果空间不足，该项目将缩小。flex-basis<br><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1fq8jg0qxmyj21gq0gcq6d.jpg" alt="flex-shrink"></p>
</blockquote>
<h4 id="2-4-flex-basis-ReactNative无"><a href="#2-4-flex-basis-ReactNative无" class="headerlink" title="2.4 flex-basis ReactNative无"></a>2.4 flex-basis <strong>ReactNative无</strong></h4><blockquote>
<p><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1fq8jgd926fj21gq0fen0l.jpg" alt="flex-basis"></p>
</blockquote>
<h4 id="2-5-flex-ReactNative无"><a href="#2-5-flex-ReactNative无" class="headerlink" title="2.5 flex ReactNative无"></a>2.5 flex <strong>ReactNative无</strong></h4><blockquote>
<p><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1fq8jgrpxkkj21gi0i2tca.jpg" alt="flex"></p>
</blockquote>
<h4 id="2-6-align-self"><a href="#2-6-align-self" class="headerlink" title="2.6 align-self"></a>2.6 align-self</h4><blockquote>
<p><code>align-self: auto | flex-start | flex-end | center | baseline | stretch</code>;</p>
</blockquote>
<hr>
<blockquote>
<p>ReactNative中的 <code>alignSelf: auto | flex-start | flex-end | center | stretch</code>;<br><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1fq8jh5hubvj21ho13qdlf.jpg"></p>
</blockquote>
<h3 id="3-FlexBox布局目前支持React-Native-的属性"><a href="#3-FlexBox布局目前支持React-Native-的属性" class="headerlink" title="3. FlexBox布局目前支持React Native 的属性"></a>3. FlexBox布局目前支持React Native 的属性</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">FlexBox布局目前支持React Native 的属性有如下6个：</span><br><span class="line">(1) flex :number  大于0的时候才可伸缩，按照大小显示伸缩比例；</span><br><span class="line">(2) flexDirection :column(容器设置的属性:主轴方向默认－垂直方向，从上倒下)| `column-reverse` | row（水平方向，从左到右）| `row-reverse`；</span><br><span class="line">(3) flexWrap :wrap(换行) －－nowrap(不换行)//容器设置的属性</span><br><span class="line">(4) alignItems :flex-start | flex-end | center | stretch (容器设置的属性:伸缩项目在伸缩容器中的交叉轴的对齐方式)；</span><br><span class="line">(5) justifyContent : flex-start | flex-end | center | space-between | space-aronud （容器设置的属性:伸缩项目沿着垂直方向的对齐方式）；</span><br><span class="line">(6) alignSelf : flex-start | flex-end | center | auto | stretch。（伸缩项目在交叉轴的对齐方式）；</span><br><span class="line">(7) position : &#x27;absolute&#x27; | &#x27;relative&#x27; ;</span><br><span class="line">(8) zIndex : number ;</span><br></pre></td></tr></table></figure>
]]></content>
  </entry>
  <entry>
    <title>ReactNative 仿造 ofo 共享单车快速开发的app</title>
    <url>/2017/05/20/ReactNative%E4%BB%BF%E9%80%A0ofo%20%E5%85%B1%E4%BA%AB%E5%8D%95%E8%BD%A6%E5%BF%AB%E9%80%9F%E5%BC%80%E5%8F%91%E7%9A%84app/</url>
    <content><![CDATA[<h1 id="ofo-ReactNative-仿版-主要是做-iOS版本"><a href="#ofo-ReactNative-仿版-主要是做-iOS版本" class="headerlink" title="ofo ReactNative 仿版(主要是做 iOS版本)"></a>ofo ReactNative 仿版(主要是做 iOS版本)</h1><h2 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h2><p>之前一直想做个 ReactNative 关于地图相关的 demo ,然后近两天在群里看见有人发的 RN 做的 ofo 共享单车的仿版(主要是针对安卓的),就想着乘着这几天活不多,也做一个,用下最新的 RN 版本(0.44),本来是想体验一下一些新特性的,目前主要还是在40以下做项目,主要考虑版本兼容,不过目前看也差不多可以升级40以上了,至于这个 ofo 仿版还是有很多没有用到新的特性的东西,好了话不多说,上效果图;</p>
<h2 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h2><table>
<thead>
<tr>
<th align="center">iOS</th>
<th align="center">安卓</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1ffr4h8o0ejg209w0hh7wk.gif"></td>
<td align="center"><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1ffr4h8chjig20820eye81.gif"></td>
</tr>
</tbody></table>
<h2 id="package-json"><a href="#package-json" class="headerlink" title="package.json"></a><code>package.json</code></h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;native-base&quot;</span>: <span class="string">&quot;^2.1.3&quot;</span>,</span><br><span class="line"><span class="string">&quot;react&quot;</span>: <span class="string">&quot;16.0.0-alpha.6&quot;</span>,</span><br><span class="line"><span class="string">&quot;react-native&quot;</span>: <span class="string">&quot;0.44.0&quot;</span>,</span><br><span class="line"><span class="string">&quot;react-native-blur&quot;</span>: <span class="string">&quot;^3.0.0-alpha&quot;</span>,</span><br><span class="line"><span class="string">&quot;react-native-camera&quot;</span>: <span class="string">&quot;^0.8.0&quot;</span>,</span><br><span class="line"><span class="string">&quot;react-native-maps&quot;</span>: <span class="string">&quot;^0.15.0&quot;</span>,</span><br><span class="line"><span class="string">&quot;react-native-scrollable-tab-view&quot;</span>: <span class="string">&quot;^0.6.6&quot;</span>,</span><br><span class="line"><span class="string">&quot;react-native-share&quot;</span>: <span class="string">&quot;^1.0.20&quot;</span>,</span><br><span class="line"><span class="string">&quot;react-native-simple-toast&quot;</span>: <span class="string">&quot;^0.0.6&quot;</span>,</span><br><span class="line"><span class="string">&quot;react-navigation&quot;</span>: <span class="string">&quot;^1.0.0-beta.9&quot;</span></span><br></pre></td></tr></table></figure>

<p>主要用到的一些依赖,时间比较匆忙,有些没有兼容两个平台,特别是安卓,地图的没有做到很详细;</p>
<h2 id="项目怎么跑起来"><a href="#项目怎么跑起来" class="headerlink" title="项目怎么跑起来"></a>项目怎么跑起来</h2><ol>
<li>把本仓库下载或者克隆下来; <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3N0cmF3ZmVycnkvcmVhY3RuYXRpdmVvZm8=">Github 地址: <i class="fa fa-external-link-alt"></i></span> <code>https://github.com/strawferry/reactnativeofo</code></li>
<li>前往仓库目录,终端执行 <code>npm install</code> 或者 <code>yarn</code>;</li>
<li>终端执行 <code>react-native link</code>,链接相关的依赖;</li>
<li>然后运行项目;</li>
</ol>
<h2 id="感谢"><a href="#感谢" class="headerlink" title="感谢"></a>感谢</h2><p>当时在群里看到这个仓库,发现做的还不错,但是主要是针对安卓的,当时 iOS 适配比较差,就想着搞一个出来;<br><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL01hcm5vRGV2L3JlYWN0LW5hdGl2ZS1vZm8=">React Native 仿 ofo 共享单车 App http://www.marno.cn<i class="fa fa-external-link-alt"></i></span></p>
]]></content>
  </entry>
  <entry>
    <title>React/React Native 的ES5 ES6写法对照表</title>
    <url>/2016/07/04/React%E5%92%8CReactNative%E7%9A%84ES5-ES6%E8%AF%AD%E6%B3%95%E5%86%99%E6%B3%95%E5%AF%B9%E7%85%A7/</url>
    <content><![CDATA[<h2 id="React-React-Native-的ES5-ES6写法对照表"><a href="#React-React-Native-的ES5-ES6写法对照表" class="headerlink" title="React&#x2F;React Native 的ES5 ES6写法对照表"></a>React&#x2F;React Native 的ES5 ES6写法对照表</h2><p>###1. 模块引用</p>
<blockquote>
<p>ES5 <code>使用CommonJS标准，引入React包基本通过require进行</code></p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="title class_">React</span> = <span class="built_in">require</span>(<span class="string">&quot;react&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> &#123;</span><br><span class="line">    <span class="title class_">Component</span>,</span><br><span class="line">    <span class="title class_">PropTypes</span></span><br><span class="line">&#125; = <span class="title class_">React</span>;  <span class="comment">//引用React抽象组件</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">ReactNative</span> = <span class="built_in">require</span>(<span class="string">&quot;react-native&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> &#123;</span><br><span class="line">    <span class="title class_">Image</span>,</span><br><span class="line">    <span class="title class_">Text</span>,</span><br><span class="line">&#125; = <span class="title class_">ReactNative</span>;  <span class="comment">//引用具体的React Native组件</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>ES6 <code>import写法更为标准</code></p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; </span><br><span class="line">    <span class="title class_">Component</span>,</span><br><span class="line">    <span class="title class_">PropTypes</span>,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">    <span class="title class_">Image</span>,</span><br><span class="line">    <span class="title class_">Text</span></span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;react-native&#x27;</span>;</span><br><span class="line"><span class="comment">//注意在React Native里，import直到0.12+才能正常运作。</span></span><br></pre></td></tr></table></figure>
<p>###2. 导出单个类</p>
<blockquote>
<p>ES5 <code>一般通过 module.exports 来导出</code></p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="title class_">MyComponent</span> = <span class="title class_">React</span>.<span class="title function_">createClass</span>(&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title class_">MyComponent</span>;</span><br><span class="line"><span class="comment">//引用的时候也类似：</span></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">MyComponent</span> = <span class="built_in">require</span>(<span class="string">&#x27;./MyComponent&#x27;</span>);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ES6 <code>通常用export default来实现相同的功能</code></p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">MyComponent</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//引用的时候也类似：</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">MyComponent</span> <span class="keyword">from</span> <span class="string">&#x27;./MyComponent&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>###3. 定义组件</p>
<blockquote>
<p>ES5 <code>通过React.createClass来定义一个组件类</code></p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="title class_">Photo</span> = <span class="title class_">React</span>.<span class="title function_">createClass</span>(&#123;</span><br><span class="line">    <span class="attr">render</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">Image</span> <span class="attr">source</span>=<span class="string">&#123;this.props.source&#125;</span> /&gt;</span></span></span><br><span class="line">        );</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ES6 <code>通过定义一个继承自React.Component的class来定义一个组件类</code></p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Photo</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">Image</span> <span class="attr">source</span>=<span class="string">&#123;this.props.source&#125;</span> /&gt;</span></span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>###4. 给组件定义方法</p>
<blockquote>
<p>ES5  <code>名字: function()</code></p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="title class_">Photo</span> = <span class="title class_">React</span>.<span class="title function_">createClass</span>(&#123;</span><br><span class="line">    <span class="attr">componentWillMount</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line"></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">render</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">Image</span> <span class="attr">source</span>=<span class="string">&#123;this.props.source&#125;</span> /&gt;</span></span></span><br><span class="line">        );</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ES6 <code>名字()</code></p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Photo</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">    <span class="title function_">componentWillMount</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">Image</span> <span class="attr">source</span>=<span class="string">&#123;this.props.source&#125;</span> /&gt;</span></span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>###5. 定义组件的属性类型和默认属性</p>
<blockquote>
<p>ES5 <code>属性类型和默认属性分别通过 propTypes 成员和 getDefaultProps 方法来实现</code></p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="title class_">Video</span> = <span class="title class_">React</span>.<span class="title function_">createClass</span>(&#123;</span><br><span class="line">    <span class="attr">getDefaultProps</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">autoPlay</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">maxLoops</span>: <span class="number">10</span>,</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">propTypes</span>: &#123;</span><br><span class="line">        <span class="attr">autoPlay</span>: <span class="title class_">React</span>.<span class="property">PropTypes</span>.<span class="property">bool</span>.<span class="property">isRequired</span>,</span><br><span class="line">        <span class="attr">maxLoops</span>: <span class="title class_">React</span>.<span class="property">PropTypes</span>.<span class="property">number</span>.<span class="property">isRequired</span>,</span><br><span class="line">        <span class="attr">posterFrameSrc</span>: <span class="title class_">React</span>.<span class="property">PropTypes</span>.<span class="property">string</span>.<span class="property">isRequired</span>,</span><br><span class="line">        <span class="attr">videoSrc</span>: <span class="title class_">React</span>.<span class="property">PropTypes</span>.<span class="property">string</span>.<span class="property">isRequired</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">render</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">View</span> /&gt;</span></span></span><br><span class="line">        );</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ES6 <code>可以统一使用static成员来实现</code></p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Video</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> defaultProps = &#123;</span><br><span class="line">        <span class="attr">autoPlay</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">maxLoops</span>: <span class="number">10</span>,</span><br><span class="line">    &#125;;  <span class="comment">// 注意这里有分号</span></span><br><span class="line">    <span class="keyword">static</span> propTypes = &#123;</span><br><span class="line">        <span class="attr">autoPlay</span>: <span class="title class_">React</span>.<span class="property">PropTypes</span>.<span class="property">bool</span>.<span class="property">isRequired</span>,</span><br><span class="line">        <span class="attr">maxLoops</span>: <span class="title class_">React</span>.<span class="property">PropTypes</span>.<span class="property">number</span>.<span class="property">isRequired</span>,</span><br><span class="line">        <span class="attr">posterFrameSrc</span>: <span class="title class_">React</span>.<span class="property">PropTypes</span>.<span class="property">string</span>.<span class="property">isRequired</span>,</span><br><span class="line">        <span class="attr">videoSrc</span>: <span class="title class_">React</span>.<span class="property">PropTypes</span>.<span class="property">string</span>.<span class="property">isRequired</span>,</span><br><span class="line">    &#125;;  <span class="comment">// 注意这里有分号</span></span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">View</span> /&gt;</span></span></span><br><span class="line">        );</span><br><span class="line">    &#125; <span class="comment">// 注意这里既没有分号也没有逗号</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>###6. 初始化STATE</p>
<blockquote>
<p>ES5 <code>getInitialState: function() &#123; return &#123;key: value&#125;; &#125;,</code></p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="title class_">Video</span> = <span class="title class_">React</span>.<span class="title function_">createClass</span>(&#123;</span><br><span class="line">    <span class="attr">getInitialState</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">loopsRemaining</span>: <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">maxLoops</span>,</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ES6 <code>两种写法</code></p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//写法1</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Video</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">    state = &#123;</span><br><span class="line">        <span class="attr">loopsRemaining</span>: <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">maxLoops</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//写法2 我们推荐更易理解的在构造函数中初始化（这样你还可以根据需要做一些计算)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Video</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">props</span>)&#123;</span><br><span class="line">        <span class="variable language_">super</span>(props);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">state</span> = &#123;</span><br><span class="line">            <span class="attr">loopsRemaining</span>: <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">maxLoops</span>,</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>###7. 把方法作为回调提供</p>
<blockquote>
<p>ES5 在ES5下，React.createClass会把所有的方法都bind一遍，这样可以提交到任意的地方作为回调函数，而this不会变化。但官方现在逐步认为这反而是不标准、不易理解的。</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="title class_">PostInfo</span> = <span class="title class_">React</span>.<span class="title function_">createClass</span>(&#123;</span><br><span class="line">    <span class="attr">handleOptionsButtonClick</span>: <span class="keyword">function</span>(<span class="params">e</span>) &#123;</span><br><span class="line">        <span class="comment">// Here, &#x27;this&#x27; refers to the component instance.</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;<span class="attr">showOptionsModal</span>: <span class="literal">true</span>&#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">render</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">TouchableHighlight</span> <span class="attr">onPress</span>=<span class="string">&#123;this.handleOptionsButtonClick&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">Text</span>&gt;</span>&#123;this.props.label&#125;<span class="tag">&lt;/<span class="name">Text</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">TouchableHighlight</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ES6 在ES6下，你需要通过bind来绑定this引用，或者使用箭头函数（它会绑定当前scope的this引用）来调用</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">PostInfo</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="title function_">handleOptionsButtonClick</span>(<span class="params">e</span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;<span class="attr">showOptionsModal</span>: <span class="literal">true</span>&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">TouchableHighlight</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                <span class="attr">onPress</span>=<span class="string">&#123;this.handleOptionsButtonClick.bind(this)&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                <span class="attr">onPress</span>=<span class="string">&#123;e</span>=&gt;</span>this.handleOptionsButtonClick(e)&#125;</span></span><br><span class="line"><span class="language-xml">                &gt;</span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">Text</span>&gt;</span>&#123;this.props.label&#125;<span class="tag">&lt;/<span class="name">Text</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">TouchableHighlight</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>箭头函数实际上是在这里定义了一个临时的函数，箭头函数的箭头&#x3D;&gt;之前是一个空括号、单个的参数名、或用括号括起的多个参数名，而箭头之后可以是一个表达式（作为函数的返回值），或者是用花括号括起的函数体（需要自行通过return来返回值，否则返回的是undefined）。</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// 箭头函数的例子</span><br><span class="line">()=&gt;1</span><br><span class="line">v=&gt;v+1</span><br><span class="line">(a,b)=&gt;a+b</span><br><span class="line">()=&gt;&#123;</span><br><span class="line">    alert(&quot;foo&quot;);</span><br><span class="line">&#125;</span><br><span class="line">e=&gt;&#123;</span><br><span class="line">    if (e == 0)&#123;</span><br><span class="line">        return 0;</span><br><span class="line">    &#125;</span><br><span class="line">    return 1000/e;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>需要注意的是，不论是bind还是箭头函数，每次被执行都返回的是一个新的函数引用，因此如果你还需要函数的引用去做一些别的事情（譬如卸载监听器），那么你必须自己保存这个引用</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// 错误的做法</span><br><span class="line">class PauseMenu extends React.Component&#123;</span><br><span class="line">    componentWillMount()&#123;</span><br><span class="line">        AppStateIOS.addEventListener(&#x27;change&#x27;, this.onAppPaused.bind(this));</span><br><span class="line">    &#125;</span><br><span class="line">    componentDidUnmount()&#123;</span><br><span class="line">        AppStateIOS.removeEventListener(&#x27;change&#x27;, this.onAppPaused.bind(this));</span><br><span class="line">    &#125;</span><br><span class="line">    onAppPaused(event)&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">// 正确的做法</span><br><span class="line">class PauseMenu extends React.Component&#123;</span><br><span class="line">    constructor(props)&#123;</span><br><span class="line">        super(props);</span><br><span class="line">        this._onAppPaused = this.onAppPaused.bind(this);</span><br><span class="line">    &#125;</span><br><span class="line">    componentWillMount()&#123;</span><br><span class="line">        AppStateIOS.addEventListener(&#x27;change&#x27;, this._onAppPaused);</span><br><span class="line">    &#125;</span><br><span class="line">    componentDidUnmount()&#123;</span><br><span class="line">        AppStateIOS.removeEventListener(&#x27;change&#x27;, this._onAppPaused);</span><br><span class="line">    &#125;</span><br><span class="line">    onAppPaused(event)&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">从这个帖子中我们还学习到一种新的做法：</span><br><span class="line">// 正确的做法</span><br><span class="line">class PauseMenu extends React.Component&#123;</span><br><span class="line">    componentWillMount()&#123;</span><br><span class="line">        AppStateIOS.addEventListener(&#x27;change&#x27;, this.onAppPaused);</span><br><span class="line">    &#125;</span><br><span class="line">    componentDidUnmount()&#123;</span><br><span class="line">        AppStateIOS.removeEventListener(&#x27;change&#x27;, this.onAppPaused);</span><br><span class="line">    &#125;</span><br><span class="line">    onAppPaused = (event) =&gt; &#123;</span><br><span class="line">        //把方法直接作为一个arrow function的属性来定义，初始化的时候就绑定好了this指针</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>###8. ES6+带来的其它好处</p>
<blockquote>
<p>解构&amp;属性延展</p>
</blockquote>
<p>结合使用ES6+的解构和属性延展，我们给孩子传递一批属性更为方便了。这个例子把className以外的所有属性传递给div标签：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">AutoloadingPostsGrid</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> &#123;</span><br><span class="line">            className,</span><br><span class="line">            ...others,  <span class="comment">// contains all properties of this.props except for className</span></span><br><span class="line">        &#125; = <span class="variable language_">this</span>.<span class="property">props</span>;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;className&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">PostsGrid</span> &#123;<span class="attr">...others</span>&#125; /&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.handleLoadMoreClick&#125;</span>&gt;</span>Load more<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//下面这种写法，则是传递所有属性的同时，用覆盖新的className值：</span></span><br><span class="line">&lt;div &#123;...<span class="variable language_">this</span>.<span class="property">props</span>&#125; className=<span class="string">&quot;override&quot;</span>&gt;</span><br><span class="line">    …</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"><span class="comment">//这个例子则相反，如果属性中没有包含className，则提供默认的值，而如果属性中已经包含了，则使用属性中的值</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;base&quot;</span> &#123;<span class="attr">...this.props</span>&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">    …</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure>







]]></content>
  </entry>
  <entry>
    <title>React 组件的生命周期</title>
    <url>/2016/06/10/React%E7%BB%84%E4%BB%B6%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/</url>
    <content><![CDATA[<h2 id="组件的详细说明和生命周期（Component-Specs-and-Lifecycle）"><a href="#组件的详细说明和生命周期（Component-Specs-and-Lifecycle）" class="headerlink" title="组件的详细说明和生命周期（Component Specs and Lifecycle）"></a><span class="exturl" data-url="aHR0cDovL3JlYWN0anMuY24vcmVhY3QvZG9jcy9jb21wb25lbnQtc3BlY3MuaHRtbA==">组件的详细说明和生命周期（Component Specs and Lifecycle）<i class="fa fa-external-link-alt"></i></span></h2><hr>
<h3 id="Mounting-Cycle-挂载循环周期"><a href="#Mounting-Cycle-挂载循环周期" class="headerlink" title="Mounting Cycle 挂载循环周期"></a>Mounting Cycle 挂载循环周期</h3><blockquote>
<ol>
<li>constructor(object props)</li>
</ol>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. object getIniitialState() //它的返回值会成为this.state的初始值</span><br><span class="line">2. object getDefaultProps() //它的返回值会成为this.props的初始值</span><br></pre></td></tr></table></figure>
<blockquote>
<ol start="2">
<li>componentWillMount()&#x2F;&#x2F;本地读取数据用于显示,进行读取的好时机</li>
<li>render() -&gt; React Element</li>
<li>componentDidMount()&#x2F;&#x2F;获取网络数据比较好的选择</li>
</ol>
</blockquote>
<h3 id="Updating-Cycle-组件更新循环周期"><a href="#Updating-Cycle-组件更新循环周期" class="headerlink" title="Updating Cycle 组件更新循环周期"></a>Updating Cycle 组件更新循环周期</h3><blockquote>
<ol>
<li>componentWillReceiveProps(object nextProps)</li>
<li>shouldComponentUpdate(object nextProps, object nextState) -&gt; boolean</li>
<li>componentWillUpdate(object nextProps, object nextState)</li>
<li>render() -&gt; React Element</li>
<li>componentDidUpdate(object prevProps, object prevState)</li>
</ol>
</blockquote>
<h4 id="1-挂载：-componentWillMount"><a href="#1-挂载：-componentWillMount" class="headerlink" title="1.挂载： componentWillMount"></a>1.挂载： componentWillMount</h4><h4 id="2-挂载：-componentDidMount"><a href="#2-挂载：-componentDidMount" class="headerlink" title="2.挂载： componentDidMount"></a>2.挂载： componentDidMount</h4><h4 id="3-更新：-componentWillReceiveProps"><a href="#3-更新：-componentWillReceiveProps" class="headerlink" title="3.更新： componentWillReceiveProps"></a>3.更新： componentWillReceiveProps</h4><blockquote>
<p>componentWillReceiveProps(object nextProps)</p>
</blockquote>
<h4 id="4-更新：-shouldComponentUpdate"><a href="#4-更新：-shouldComponentUpdate" class="headerlink" title="4.更新： shouldComponentUpdate"></a>4.更新： shouldComponentUpdate</h4><blockquote>
<p>boolean shouldComponentUpdate(object nextProps, object nextState)</p>
</blockquote>
<h4 id="5-更新：-componentWillUpdate"><a href="#5-更新：-componentWillUpdate" class="headerlink" title="5.更新： componentWillUpdate"></a>5.更新： componentWillUpdate</h4><blockquote>
<p>componentWillUpdate(object nextProps, object nextState)</p>
</blockquote>
<h4 id="6-移除：-componentWillUnmount"><a href="#6-移除：-componentWillUnmount" class="headerlink" title="6.移除： componentWillUnmount"></a>6.移除： componentWillUnmount</h4><hr>
<h3 id="1-挂载：-componentWillMount-1"><a href="#1-挂载：-componentWillMount-1" class="headerlink" title="1.挂载： componentWillMount"></a>1.挂载： componentWillMount</h3><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="title function_">componentWillMount</span>()</span><br></pre></td></tr></table></figure>

<p>服务器端和客户端都只调用一次，在初始化渲染执行之前立刻调用。如果在这个方法内调用 setState，render() 将会感知到更新后的 state，将会执行仅一次，尽管 state 改变了。</p>
<h3 id="2-挂载：-componentDidMount-1"><a href="#2-挂载：-componentDidMount-1" class="headerlink" title="2.挂载： componentDidMount"></a>2.挂载： componentDidMount</h3><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="title function_">componentDidMount</span>()</span><br></pre></td></tr></table></figure>

<p>在初始化渲染执行之后立刻调用一次，仅客户端有效（服务器端不会调用）。在生命周期中的这个时间点，组件拥有一个 DOM 展现，你可以通过 this.getDOMNode() 来获取相应 DOM 节点。<br>如果想和其它 JavaScript 框架集成，使用 setTimeout 或者 setInterval 来设置定时器，或者发送 AJAX 请求，可以在该方法中执行这些操作。</p>
<h3 id="3-更新：-componentWillReceiveProps-1"><a href="#3-更新：-componentWillReceiveProps-1" class="headerlink" title="3.更新： componentWillReceiveProps"></a>3.更新： componentWillReceiveProps</h3><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="title function_">componentWillReceiveProps</span>(object nextProps)</span><br></pre></td></tr></table></figure>

<p>在组件接收到新的 props 的时候调用。在初始化渲染的时候，该方法不会调用。<br>用此函数可以作为 react 在 prop 传入之后， render() 渲染之前更新 state 的机会。老的 props 可以通过 this.props 获取到。在该函数中调用 this.setState() 将不会引起第二次渲染。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">componentWillReceiveProps</span>: <span class="keyword">function</span>(<span class="params">nextProps</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">          <span class="attr">likesIncreasing</span>: nextProps.<span class="property">likeCount</span> &gt; <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">likeCount</span></span><br><span class="line">     &#125;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-更新：-shouldComponentUpdate-1"><a href="#4-更新：-shouldComponentUpdate-1" class="headerlink" title="4.更新： shouldComponentUpdate"></a>4.更新： shouldComponentUpdate</h3><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">boolean <span class="title function_">shouldComponentUpdate</span>(object nextProps, object nextState)</span><br></pre></td></tr></table></figure>

<p>在接收到新的 props 或者 state，将要渲染之前调用。该方法在初始化渲染的时候不会调用，在使用 forceUpdate 方法的时候也不会。<br>如果确定新的 props 和 state 不会导致组件更新，则此处应该 返回 false。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">shouldComponentUpdate</span>: <span class="keyword">function</span>(<span class="params">nextProps, nextState</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> nextProps.<span class="property">id</span> !== <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">id</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果 shouldComponentUpdate 返回 false，则 render() 将不会执行，直到下一次 state 改变。（另外，componentWillUpdate 和 componentDidUpdate 也不会被调用。）<br>默认情况下，shouldComponentUpdate 总会返回 true，在 state 改变的时候避免细微的 bug，但是如果总是小心地把 state 当做不可变的，在 render() 中只从 props 和 state 读取值，此时你可以覆盖 shouldComponentUpdate 方法，实现新老 props 和 state 的比对逻辑。<br>如果性能是个瓶颈，尤其是有几十个甚至上百个组件的时候，使用 shouldComponentUpdate 可以提升应用的性能。</p>
<h3 id="5-更新：-componentWillUpdate-1"><a href="#5-更新：-componentWillUpdate-1" class="headerlink" title="5.更新： componentWillUpdate"></a>5.更新： componentWillUpdate</h3><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="title function_">componentWillUpdate</span>(object nextProps, object nextState)</span><br></pre></td></tr></table></figure>
<p>在接收到新的 props 或者 state 之前立刻调用。在初始化渲染的时候该方法不会被调用。<br>使用该方法做一些更新之前的准备工作。</p>
<h3 id="6-移除：-componentWillUnmount-1"><a href="#6-移除：-componentWillUnmount-1" class="headerlink" title="6.移除： componentWillUnmount"></a>6.移除： componentWillUnmount</h3><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="title function_">componentWillUnmount</span>()</span><br></pre></td></tr></table></figure>
<p>在组件从 DOM 中移除的时候立刻被调用。<br>在该方法中执行任何必要的清理，比如无效的定时器，或者清除在 componentDidMount 中创建的 DOM 元素。</p>
]]></content>
  </entry>
  <entry>
    <title>Requestly网络请求修改工具使用</title>
    <url>/2022/09/24/Requestly%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E4%BF%AE%E6%94%B9%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/</url>
    <content><![CDATA[<p><span class="exturl" data-url="aHR0cHM6Ly9jaHJvbWUuZ29vZ2xlLmNvbS93ZWJzdG9yZS9kZXRhaWwvcmVkaXJlY3QtdXJsLW1vZGlmeS1oZWFkZS9tZG5sZWxkY21pbGpibG9sbmpocG5ibGtjZWtwZGtwYQ==">Requestly<i class="fa fa-external-link-alt"></i></span> 是一个 Chrome 插件，用于修改网络请求，例如重定向 URL、修改请求&#x2F;响应头等。</p>
<h3 id="1-实际应用场景"><a href="#1-实际应用场景" class="headerlink" title="1. 实际应用场景"></a>1. 实际应用场景</h3><h4 id="1-使用这个插件-我们可以在UI样式走查中-把返回的数据改成和-UI-设计图上一样的数据-这样就可以快速做走查"><a href="#1-使用这个插件-我们可以在UI样式走查中-把返回的数据改成和-UI-设计图上一样的数据-这样就可以快速做走查" class="headerlink" title="1. 使用这个插件,我们可以在UI样式走查中,把返回的数据改成和 UI 设计图上一样的数据,这样就可以快速做走查"></a>1. 使用这个插件,我们可以在UI样式走查中,把返回的数据改成和 UI 设计图上一样的数据,这样就可以快速做走查</h4><h4 id="2-对请求的返回数据做修改-以快速验证前端展示等功能"><a href="#2-对请求的返回数据做修改-以快速验证前端展示等功能" class="headerlink" title="2. 对请求的返回数据做修改,以快速验证前端展示等功能"></a>2. 对请求的返回数据做修改,以快速验证前端展示等功能</h4><h4 id="3-接口文件的-mock"><a href="#3-接口文件的-mock" class="headerlink" title="3. 接口文件的 mock"></a>3. 接口文件的 mock</h4><h4 id="4-等更多使用场景自己去发现"><a href="#4-等更多使用场景自己去发现" class="headerlink" title="4. 等更多使用场景自己去发现"></a>4. 等更多使用场景自己去发现</h4><h3 id="2-插件安装"><a href="#2-插件安装" class="headerlink" title="2. 插件安装"></a>2. 插件安装</h3><p>通过 Chrome 插件地址下载安装,并固定到菜单栏上,点击打开 Requestly 设置页面;</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/strawferry/GSS@master/uPic/2023-08-20/i0GNos-14-04-d0hI8a.png" alt="i0GNos-14-04-d0hI8a"></p>
<h3 id="3-简单使用介绍"><a href="#3-简单使用介绍" class="headerlink" title="3. 简单使用介绍"></a>3. 简单使用介绍</h3><p>我们主要说下请求返回数据的修改,比较常用的就是这个;</p>
<h4 id="1-打开-app-新建规则-选择-Modify-API-Response"><a href="#1-打开-app-新建规则-选择-Modify-API-Response" class="headerlink" title="1. 打开 app,新建规则,选择 Modify API Response"></a>1. 打开 app,新建规则,选择 Modify API Response</h4><p><img data-src="https://cdn.jsdelivr.net/gh/strawferry/GSS@master/uPic/2023-08-20/wps_doc_7-14-08-mvTUFE.png" alt="wps_doc_7-14-08-mvTUFE"><br><img data-src="https://cdn.jsdelivr.net/gh/strawferry/GSS@master/uPic/2023-08-20/wps_doc_1-14-08-hOgEPq.png" alt="wps_doc_1-14-08-hOgEPq"></p>
<h4 id="2-设置名称-填入重写的-URL-填入修改的返回-最后保存"><a href="#2-设置名称-填入重写的-URL-填入修改的返回-最后保存" class="headerlink" title="2. 设置名称,填入重写的 URL,填入修改的返回,最后保存"></a>2. 设置名称,填入重写的 URL,填入修改的返回,最后保存</h4><p><img data-src="https://cdn.jsdelivr.net/gh/strawferry/GSS@master/uPic/2023-08-20/wps_doc_2-14-08-sHwIE6.png" alt="wps_doc_2-14-08-sHwIE6"></p>
<h4 id="3-打开使用开关-在需要修改的页面打开调试面板-请求网络-这时就能按规则重写返回"><a href="#3-打开使用开关-在需要修改的页面打开调试面板-请求网络-这时就能按规则重写返回" class="headerlink" title="3. 打开使用开关,在需要修改的页面打开调试面板,请求网络,这时就能按规则重写返回"></a>3. 打开使用开关,在需要修改的页面打开调试面板,请求网络,这时就能按规则重写返回</h4><p><img data-src="https://cdn.jsdelivr.net/gh/strawferry/GSS@master/uPic/2023-08-20/wps_doc_3-14-09-gGMCfO.png" alt="wps_doc_3-14-09-gGMCfO"><br><img data-src="https://cdn.jsdelivr.net/gh/strawferry/GSS@master/uPic/2023-08-20/wps_doc_4-14-09-RxBcEw.png" alt="wps_doc_4-14-09-RxBcEw"></p>
<h4 id="4-有时我们需要动态修改数据-设置-Dynamic-通过-JavaScript-脚本去修改返回值"><a href="#4-有时我们需要动态修改数据-设置-Dynamic-通过-JavaScript-脚本去修改返回值" class="headerlink" title="4. 有时我们需要动态修改数据,设置 Dynamic 通过 JavaScript 脚本去修改返回值"></a>4. 有时我们需要动态修改数据,设置 Dynamic 通过 JavaScript 脚本去修改返回值</h4><p><img data-src="https://cdn.jsdelivr.net/gh/strawferry/GSS@master/uPic/2023-08-20/wps_doc_5-14-09-yPgr4D.png" alt="wps_doc_5-14-09-yPgr4D"><br><img data-src="https://cdn.jsdelivr.net/gh/strawferry/GSS@master/uPic/2023-08-20/wps_doc_6-14-09-tCmhsH.png" alt="wps_doc_6-14-09-tCmhsH"></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">modifyResponse</span>(<span class="params">args</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;</span><br><span class="line">    method,</span><br><span class="line">    url,</span><br><span class="line">    response,</span><br><span class="line">    responseType,</span><br><span class="line">    requestHeaders,</span><br><span class="line">    requestData,</span><br><span class="line">    responseJSON,</span><br><span class="line">  &#125; = args;</span><br><span class="line">  <span class="comment">// Change response below depending upon request attributes received in args</span></span><br><span class="line">  <span class="keyword">const</span> res = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(response);</span><br><span class="line">  <span class="keyword">let</span> &#123; mobileLayout &#125; = res?.<span class="property">value</span>;</span><br><span class="line">  <span class="keyword">if</span> (mobileLayout !== <span class="string">&quot;GUIDEPAGE&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> ress = &#123; <span class="attr">value</span>: &#123; ...res.<span class="property">value</span>, <span class="attr">mobileLayout</span>: <span class="string">&quot;GUIDEPAGE&quot;</span> &#125; &#125;;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(</span><br><span class="line">      <span class="string">`%cRequestly Modify Response %c`</span>,</span><br><span class="line">      <span class="string">&quot;color: #3c89e8; padding: 1px 5px; border-radius: 4px; border: 1px solid #91caff;&quot;</span>,</span><br><span class="line">      <span class="literal">null</span>,</span><br><span class="line">      ress, <span class="string">&#x27;origin&#x27;</span>, res</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(ress);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> response;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>工具, chrome插件, chrome调试</tag>
      </tags>
  </entry>
  <entry>
    <title>.gitlab.yml通过仓库统一配置</title>
    <url>/2023/04/13/gitlab.yml%20%E9%80%9A%E8%BF%87%E4%BB%93%E5%BA%93%E7%BB%9F%E4%B8%80%E9%85%8D%E7%BD%AE/</url>
    <content><![CDATA[<h2 id="1-遇到的问题"><a href="#1-遇到的问题" class="headerlink" title="1. 遇到的问题"></a>1. 遇到的问题</h2><p>在我们的微前端开发中,子服务的 cicd 基本是一样的,如果需要改动其中的某一步,就会涉及把所有子服务中的 <code>.gitlab.yml</code> 文件都改一遍,这样就会发现很繁琐,所以有没有办法统一做配置的吗?</p>
<h2 id="2-示例"><a href="#2-示例" class="headerlink" title="2. 示例"></a>2. 示例</h2><p>原本子服务中 <code>.gitlab.yml</code> 配置</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">variables:</span></span><br><span class="line">  <span class="attr">GIT_SUBMODULE_STRATEGY:</span> <span class="string">recursive</span></span><br><span class="line"></span><br><span class="line"><span class="attr">before_script:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">git</span> <span class="string">config</span> <span class="string">--global</span> <span class="string">user.name</span> <span class="string">&quot;$&#123;GITLAB_USER_NAME&#125;&quot;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">git</span> <span class="string">config</span> <span class="string">--global</span> <span class="string">user.email</span> <span class="string">&quot;$&#123;GITLAB_USER_EMAIL&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">stages:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">build</span></span><br><span class="line"><span class="attr">build:</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">build</span></span><br><span class="line">  <span class="attr">image:</span> <span class="string">hub.docker.com/ci/ci-nodejs:14.5.0</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">npm</span> <span class="string">install</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">npm</span> <span class="string">run</span> <span class="string">build</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">npm</span> <span class="string">run</span> <span class="string">cdn</span></span><br><span class="line">  <span class="attr">only:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/^v?\d+(\.\d+)+[\.\-_\w]*/</span></span><br><span class="line">  <span class="attr">tags:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">i7</span></span><br></pre></td></tr></table></figure>

<p>目前build阶段有 3 步骤,如果我们需要加一个发现通知 <code>npm run notification</code></p>
<p>解决方法</p>
<ol>
<li>在每个子服务中都添加该步骤-缺点比较麻烦,还有如果下次再改,还有重复修改;</li>
<li>通过仓库配置,统一管理 <code>.gitlab.yml</code> 的配置-优点只需要配置一次,后面都只要改仓库中模板的配置就行</li>
</ol>
<h2 id="3-配置"><a href="#3-配置" class="headerlink" title="3. 配置"></a>3. 配置</h2><h3 id="1-创建一个配置的仓库和文件"><a href="#1-创建一个配置的仓库和文件" class="headerlink" title="1. 创建一个配置的仓库和文件"></a>1. 创建一个配置的仓库和文件</h3><p>配置仓库比如: <code>ci_template</code>,在仓库中新建模板文件如: <code>web-childServise-ci-base.yml</code> 文件内容基本和子服务的一致</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># web-childServise-ci-base.yml</span></span><br><span class="line"><span class="attr">variables:</span></span><br><span class="line">  <span class="attr">GIT_SUBMODULE_STRATEGY:</span> <span class="string">recursive</span></span><br><span class="line"></span><br><span class="line"><span class="attr">before_script:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">git</span> <span class="string">config</span> <span class="string">--global</span> <span class="string">user.name</span> <span class="string">&quot;$&#123;GITLAB_USER_NAME&#125;&quot;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">git</span> <span class="string">config</span> <span class="string">--global</span> <span class="string">user.email</span> <span class="string">&quot;$&#123;GITLAB_USER_EMAIL&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">stages:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">build</span></span><br><span class="line"><span class="attr">build:</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">build</span></span><br><span class="line">  <span class="attr">image:</span> <span class="string">hub.docker.com/ci/ci-nodejs:14.5.0</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">npm</span> <span class="string">install</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">npm</span> <span class="string">run</span> <span class="string">build</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">npm</span> <span class="string">run</span> <span class="string">cdn</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">npm</span> <span class="string">run</span> <span class="string">notification</span> <span class="comment"># 新加的通知</span></span><br><span class="line">  <span class="attr">only:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/^v?\d+(\.\d+)+[\.\-_\w]*/</span></span><br><span class="line">  <span class="attr">tags:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">i7</span></span><br></pre></td></tr></table></figure>

<h3 id="2-修改子服务中-gitlab-yml-文件"><a href="#2-修改子服务中-gitlab-yml-文件" class="headerlink" title="2. 修改子服务中 .gitlab.yml 文件"></a>2. 修改子服务中 <code>.gitlab.yml</code> 文件</h3><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># .gitlab.yml</span></span><br><span class="line"><span class="attr">variables:</span></span><br><span class="line">  <span class="attr">GIT_SUBMODULE_STRATEGY:</span> <span class="string">recursive</span></span><br><span class="line"></span><br><span class="line"><span class="attr">include:</span></span><br><span class="line">    <span class="comment"># base 仓库的路径</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">project:</span> <span class="string">&#x27;devops/ci_template&#x27;</span></span><br><span class="line">    <span class="attr">file:</span> <span class="string">&#x27;/web/web-childServise-ci-base.yml&#x27;</span></span><br><span class="line">    <span class="comment"># ref 可以不配置,默认是 master 分支</span></span><br><span class="line">    <span class="attr">ref:</span> <span class="string">&#x27;feature/addNotification&#x27;</span> </span><br><span class="line">    <span class="comment"># 指定仓库的具体分支,一般测试 ci 脚本时候用</span></span><br></pre></td></tr></table></figure>

<h2 id="4-总结"><a href="#4-总结" class="headerlink" title="4. 总结"></a>4. 总结</h2><p>通过仓库统一配置,这样如果下次需要更改 <code>runner</code> 机器或者添加新脚本,通过直接修改统一的配置,在子服务触发新的构建的时候就会使用最新的配置去跑服务</p>
]]></content>
      <tags>
        <tag>cicd, gitlab, 持续集成</tag>
      </tags>
  </entry>
  <entry>
    <title>curl命令使用</title>
    <url>/2017/08/15/curl%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8/</url>
    <content><![CDATA[<h1 id="curl-基本使用"><a href="#curl-基本使用" class="headerlink" title="curl 基本使用"></a>curl 基本使用</h1><ol>
<li>最简单的直接请求页面 <code>curl &quot;https://www.baidu.com&quot;</code></li>
<li>请求保存页面 <code> curl &quot;https://www.baidu.com&quot; &gt; /path/name.html</code> </li>
<li><code>-o</code> 保存页面 <code>curl -o /path/name.html &quot;https://www.baidu.com&quot;</code> <code>--progress </code> 显示进度条</li>
<li><code>-s</code> 加入这个就不会出现进度条,安静模式</li>
<li><code>-A</code> 参数用来指定 USER-AGENGT <code>curl -A &quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_8_2) AppleWebKit/537.17 (KHTML, like Gecko) Chrome/24.0.1312.52 Safari/537.17&quot; http://localhost/learing-curl/show-server-info.php</code></li>
<li><code>-e</code> 指定 referer 来源网址 <code>curl -e &quot;https://www.google.com/&quot;  http://localhost/learing-curl/show-server-info.php</code></li>
<li><code>-d</code> post 请求 <code>curl -d &quot;name=1&quot; &quot;http://localhost:6666/post&quot;</code></li>
<li><code>-G</code> 轻质指定表单以 GET 方法提交</li>
<li><code>-I</code> 只展示 Header <code>curl -I  http://www.baidu.com</code></li>
<li><code>-D</code> 保存 Header 到文件里 <code>curl -D header.txt http://www.alibaba.com</code></li>
<li><code>-L</code> 跟随重定向过去 <code>curl -L http:localhost:6666/red</code></li>
<li><code>-F</code> 提交文件 <code> curl -F upload_file=@test.data url</code></li>
<li><code>-c</code> 保存 cookie <code>curl -c cookie.txt https://www.baidu.com</code></li>
<li><code>-b</code> 带 coolie 访问 <code>curl -b &quot;name=data&quot; url</code> <code>curl -b cookie.txt url</code></li>
<li><code>-H</code> 设置请求头</li>
<li><code>-m</code> 设置最大传输时间 seconds </li>
<li><code>-u</code> 设置服务器用户名和密码 <code>curl -u name:password url</code></li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">curl <span class="string">&#x27;https://oapi.dingtalk.com/robot/send?access_token=6fb5741248b308d1eb616f993fddf0fb3459f42cb6b4eb86078e33042b5bc4e0&#x27;</span> \</span><br><span class="line">   -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">   -d \</span><br><span class="line">  <span class="string">&#x27;&#123;&quot;msgtype&quot;: &quot;text&quot;, </span></span><br><span class="line"><span class="string">    &quot;text&quot;: &#123;</span></span><br><span class="line"><span class="string">        &quot;content&quot;: &quot;我就是我, 是不一样的烟火&quot;</span></span><br><span class="line"><span class="string">     &#125;</span></span><br><span class="line"><span class="string">  &#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">curl <span class="string">&#x27;http://www.ferryvip.com/v1/me/webhook&#x27;</span> \</span><br><span class="line">   -H <span class="string">&#x27;Content-Type: application/json &#x27;</span> \</span><br><span class="line">   -H <span class="string">&#x27;x-coding-event: push &#x27;</span> \</span><br><span class="line">   -d \</span><br><span class="line">  <span class="string">&#x27;&#123;&quot;ref&quot;:&quot;refs/heads/master&quot;,&quot;before&quot;:&quot;fbec0e3aa41f1364587c5d62df9032bcc5406afd&quot;,&quot;commits&quot;:[&#123;&quot;committer&quot;:&#123;&quot;name&quot;:&quot;chencangshan&quot;,&quot;email&quot;:&quot;chencangshan@huaxiweiying.com&quot;&#125;,&quot;web_url&quot;:&quot;https://coding.net/u/ferryVip/p/lostwebserver/git/commit/90360e33395e3bb1e1b844b4b85de08d2a559152&quot;,&quot;short_message&quot;:&quot;测试 hook\n&quot;,&quot;sha&quot;:&quot;90360e33395e3bb1e1b844b4b85de08d2a559152&quot;&#125;],&quot;after&quot;:&quot;90360e33395e3bb1e1b844b4b85ded2a559152&quot;,&quot;event&quot;:&quot;push&quot;,&quot;repository&quot;:&#123;&quot;owner&quot;:&#123;&quot;path&quot;:&quot;/u/ferryVip&quot;,&quot;web_url&quot;:&quot;https://coding.net/u/ferryVip&quot;,&quot;global_key&quot;:&quot;ferryVip&quot;,&quot;name&quot;:&quot;ferryVip&quot;,&quot;avatar&quot;:&quot;https://dn-coding-net-production-static.qbox.me/82b7ce57-96ef-4faf-a480-bb0645ab2a1a.jpg?imageMogr2/auto-orient/format/jpeg/crop/!200x200a0a0&quot;&#125;,&quot;https_url&quot;:&quot;https://git.coding.net/ferryVip/lostwebserver.git&quot;,&quot;web_url&quot;:&quot;https://coding.net/u/ferryVip/p/lostwebserver&quot;,&quot;project_id&quot;:&quot;1219048&quot;,&quot;ssh_url&quot;:&quot;git@git.coding.net:ferryVip/lostwebserver.git&quot;,&quot;name&quot;:&quot;lostwebserver&quot;,&quot;description&quot;:&quot;react webpack node mongodb express\n\n失物招领b server&quot;&#125;,&quot;user&quot;:&#123;&quot;path&quot;:&quot;/u/ferryVip&quot;,&quot;web_url&quot;:&quot;https://coding.net/u/ferryVip&quot;,&quot;global_key&quot;:&quot;ferryVip&quot;,&quot;name&quot;:&quot;ferryVip&quot;,&quot;avatar&quot;:&quot;https://dn-coding-net-production-static.qbox.me/82b7ce57-96ef-4faf-a480-bb0645ab2a1a.jpg?imageMogr2/auto-orient/format/jpeg/crop/!200x200a0a0&quot;&#125;,&quot;token&quot;:&quot;https://oapi.dingtalk.com/robot/send?access_token=6fb5741248b308d1eb616f993fddf0fb3459f42cb6b4eb86078e33042b5bc4e0&quot;&#125;&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>混合app集成热更新</title>
    <url>/2017/02/22/hybrid-app-codepush/</url>
    <content><![CDATA[<h1 id="混合app集成热更新"><a href="#混合app集成热更新" class="headerlink" title="混合app集成热更新"></a>混合app集成热更新</h1><p>原因是因为之前做的都是纯 rn 项目,偶尔接入原生,所以 codepush 比较好集成.</p>
<p>有一次在想如果原本是原生的项目,后面只是引入 rn 作为一些基础模块,这样的更新要如何做,也就有了这篇文章(技术很早实现了,博客因为懒后面盆友需要,拖了现在才写,也是尴尬);</p>
<h2 id="1-前提工作"><a href="#1-前提工作" class="headerlink" title="1. 前提工作"></a>1. 前提工作</h2><p>你目前的 iOS 项目已经是 ReactNative 混合 App;<br>这边我用我之前的来做,具体代码可以看<span class="exturl" data-url="aHR0cHM6Ly9mZXJyeXZpcC5jb2RpbmcubWUvRmVycnlWaXBCbG9nLzIwMTYvMTIvMjgvaU9TLXdpdGgtUmVhY3ROYXRpdmUv">这个链接(国内Coding)<i class="fa fa-external-link-alt"></i></span>或者<a href="https://strawferry.github.io/FerryVipBlog/2016/12/28/iOS-with-ReactNative/">这个链接(国外github)</a>;</p>
<h2 id="2-了解一些-codepush-的原理"><a href="#2-了解一些-codepush-的原理" class="headerlink" title="2. 了解一些 codepush 的原理"></a>2. 了解一些 codepush 的原理</h2><p>之前在 CSDN 写的 codepush 相关的博客</p>
<p><span class="exturl" data-url="aHR0cDovL2Jsb2cuY3Nkbi5uZXQvc3RyYXdmZXJyeS9hcnRpY2xlL2RldGFpbHMvNTIxMjQzNjI=">CodePush 热更新ReactNative之CodePush CLI操作<i class="fa fa-external-link-alt"></i></span></p>
<p><span class="exturl" data-url="aHR0cDovL2Jsb2cuY3Nkbi5uZXQvc3RyYXdmZXJyeS9hcnRpY2xlL2RldGFpbHMvNTIxMzA4NzA=">CodePush 热更新ReactNative之React Native Client SDK<i class="fa fa-external-link-alt"></i></span></p>
<p>可以看下了解,当然最好去<span class="exturl" data-url="aHR0cHM6Ly9taWNyb3NvZnQuZ2l0aHViLmlvL2NvZGUtcHVzaC9pbmRleC5odG1s">官方 gayhub 去看文档<i class="fa fa-external-link-alt"></i></span>比较好;</p>
<p>按照文档吧 codepush 的环境安装好👌;</p>
<h2 id="3-集成进入-App-项目里"><a href="#3-集成进入-App-项目里" class="headerlink" title="3. 集成进入 App 项目里"></a>3. 集成进入 App 项目里</h2><ol>
<li>安装 codepush 模块 <code>npm install --save react-native-code-push@latest</code>;</li>
<li>在安装完成后,可以执行命令自动导包进去 <code>react-native link react-native-code-push</code>, 当然也可以手动导包,自己<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL01pY3Jvc29mdC9yZWFjdC1uYXRpdmUtY29kZS1wdXNoL2Jsb2IvbWFzdGVyL2RvY3Mvc2V0dXAtaW9zLm1k">看下官方文档<i class="fa fa-external-link-alt"></i></span>;<br>在自动导包时,会要求你添加 codepush 的 key, 可以跳过下面会说到怎么添加;</li>
<li>到此就可以看到 package.json 里面多了一个模块;<br>目录变化<br><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1fczbmb0flej20hp0aftbz" alt="目录变化"></li>
</ol>
<p>原生项目文件变化,添加了 CodePush 工程,还有一些静态库,至于 AppDelegate.m 里面的好像是会有,有点忘记了;<br><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1fczbxpo37qj20qs0lqk2g" alt="原生项目文件变化"></p>
<h2 id="4-配置-codepush-的-key"><a href="#4-配置-codepush-的-key" class="headerlink" title="4. 配置 codepush 的 key"></a>4. 配置 codepush 的 key</h2><ol>
<li>codepush 创建 app <code>code-push app add MyApp-iOS</code> 会从中得到一个 key ,复制这个 key ,下一步在 iOS 原生中会用到;<br><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1fczc7np6mwj20pp0ezakd" alt="key"></li>
<li>iOS中原生配置 key ,在 Info.plist 文件中,如下图;<br><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1fczcaop98uj20qs0lq7dn"></li>
</ol>
<h2 id="5-原生代码配置"><a href="#5-原生代码配置" class="headerlink" title="5. 原生代码配置"></a>5. 原生代码配置</h2><ol>
<li>AppDelegate.m 文件中配置,为了一进入 App 就加载好了, codepush 环境,我个人认为的,没有去测试;<br><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1fczcl67242j20vn0v4wvj"></li>
<li>在每处用到混合的地方加入代码,这边我用到了两处,所以两个的 .m 文件中,我都加入类似的代码;<br><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1fczclg4mmqj20vn0v4n94"></li>
</ol>
<h2 id="6-js-代码的配置"><a href="#6-js-代码的配置" class="headerlink" title="6. js 代码的配置"></a>6. js 代码的配置</h2><p>js 基本的配置就是这些,具体的有些配置,可以<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL01pY3Jvc29mdC9yZWFjdC1uYXRpdmUtY29kZS1wdXNoL2Jsb2IvbWFzdGVyL2RvY3MvYXBpLWpzLm1k">官方文档看下<i class="fa fa-external-link-alt"></i></span>;<br><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1fczcq1yucej20wz0cl7a8"></p>
<h2 id="7-iOS-打-release-包"><a href="#7-iOS-打-release-包" class="headerlink" title="7. iOS 打 release 包"></a>7. iOS 打 release 包</h2><ol>
<li>在 js 主目录下,执行命令 <code>curl http://localhost:8081/index.ios.bundle -o main.jsbundle</code> 会在目录下有个 main.jsbundle 的文件,这个需要拖到 iOS 原生目录下,每次打包重新生成,都需要替换进去;<br><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1fczd173ncnj20rd0ign3j"></li>
<li>iOS 打包 ipa 包,只要把刚才的 main.jsbundle 拖进去,剩下的步骤和正常打包一样;</li>
</ol>
<h2 id="8-打-codepush-更新包"><a href="#8-打-codepush-更新包" class="headerlink" title="8. 打 codepush 更新包"></a>8. 打 codepush 更新包</h2><p>在 js 的目录下,执行命令 <code>code-push release-react youAppName ios</code>, 最简单命令,直接推到Staging;</p>
<h2 id="9-到此基本结束-根据你设置的更新条件-App-就会自动更新了"><a href="#9-到此基本结束-根据你设置的更新条件-App-就会自动更新了" class="headerlink" title="9. 到此基本结束,根据你设置的更新条件, App 就会自动更新了;"></a>9. 到此基本结束,根据你设置的更新条件, App 就会自动更新了;</h2>]]></content>
  </entry>
  <entry>
    <title>idea 使用一些配置</title>
    <url>/2019/07/18/idea%20%E4%BD%BF%E7%94%A8%E4%B8%80%E4%BA%9B%E9%85%8D%E7%BD%AE/</url>
    <content><![CDATA[<h1 id="idea-使用一些配置"><a href="#idea-使用一些配置" class="headerlink" title="idea 使用一些配置"></a>idea 使用一些配置</h1><h2 id="1-创建文件自动添加注释"><a href="#1-创建文件自动添加注释" class="headerlink" title="1. 创建文件自动添加注释"></a>1. 创建文件自动添加注释</h2><p><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1g53sbilvtmj21k812sdr4.jpg"></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@Author</span>: ferryvip</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@Description</span>: </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@Date</span>: Create in $&#123;TIME&#125; $&#123;DATE&#125; </span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<h2 id="2"><a href="#2" class="headerlink" title="2."></a>2.</h2>]]></content>
  </entry>
  <entry>
    <title>iOS-with-ReactNative</title>
    <url>/2016/12/28/iOS-with-ReactNative/</url>
    <content><![CDATA[<h1 id="如何在现有的iOS项目中添加ReactNative混合开发"><a href="#如何在现有的iOS项目中添加ReactNative混合开发" class="headerlink" title="如何在现有的iOS项目中添加ReactNative混合开发"></a>如何在现有的iOS项目中添加ReactNative混合开发</h1><p>如果公司的项目之前是用原生, 现在想做混合开发并且选择ReactNative, 这篇会是一个基础的环境配置;</p>
<h2 id="1-开发环境准备"><a href="#1-开发环境准备" class="headerlink" title="1. 开发环境准备"></a>1. 开发环境准备</h2><p>首先, 至少你已经搭建了 <code>React Native</code> 的<span class="exturl" data-url="aHR0cDovL3JlYWN0bmF0aXZlLmNuL2RvY3MvMC4zOS9nZXR0aW5nLXN0YXJ0ZWQuaHRtbA==">开发环境<i class="fa fa-external-link-alt"></i></span>在iOS平台上所需的一切依赖软件（比如npm）。</p>
<p>其次, <span class="exturl" data-url="aHR0cDovL2NvY29hcG9kcy5vcmcv">CocoaPods<i class="fa fa-external-link-alt"></i></span> 包管理工具, 基本做iOS开发都有装, 如果没有, 那就百度一下😂;</p>
<h2 id="2-安装依赖包"><a href="#2-安装依赖包" class="headerlink" title="2. 安装依赖包"></a>2. 安装依赖包</h2><p>React Native的植入过程同时需要React和React Native两个node依赖包。<br><img data-src="https://ws2.sinaimg.cn/large/8bbf0afbjw1fb4ay3fky6j20hk0c70vj.jpg"><br>在你的原有的iOS目录的上一级目录创建一个包管理package.json文件;</p>
<blockquote>
<p>对于一个典型的React Native项目来说，一般package.json和index.ios.js等文件会放在项目的根目录下。而iOS相关的原生代码会放在一个名为ios&#x2F;的子目录中,这里也同时放着你的Xcode项目文件（.xcodeproj）。</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// package.json 文件内容</span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;NumberTileGame&quot;,</span><br><span class="line">  &quot;version&quot;: &quot;0.0.1&quot;,</span><br><span class="line">  &quot;private&quot;: true,</span><br><span class="line">  &quot;scripts&quot;: &#123;</span><br><span class="line">    &quot;start&quot;: &quot;node node_modules/react-native/local-cli/cli.js start&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;dependencies&quot;: &#123;</span><br><span class="line">    &quot;react&quot;: &quot;15.4.1&quot;,</span><br><span class="line">    &quot;react-native&quot;: &quot;0.39.2&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 通过npm info react和npm info react-native 来查看当前的最新版本</span><br></pre></td></tr></table></figure>
<blockquote>
<p>npm install   &#x2F;&#x2F; 在 package.json 的当前目录下开启终端执行这段代码, 这些模块就会安装到 <code>node_modules/</code> 下;</p>
</blockquote>
<h2 id="3-React-Native框架嵌入iOS"><a href="#3-React-Native框架嵌入iOS" class="headerlink" title="3. React Native框架嵌入iOS"></a>3. React Native框架嵌入iOS</h2><h3 id="Subspecs"><a href="#Subspecs" class="headerlink" title="Subspecs"></a>Subspecs</h3><p>在你开始把React Native植入到你的应用中之前，首先要决定具体整合的是React Native框架中的哪些部分。而这就是subspec要做的工作。在创建Podfile文件的时候，需要指定具体安装哪些React Native的依赖库。所指定的每一个库就称为一个subspec。</p>
<p>可用的subspec都列在<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2ZhY2Vib29rL3JlYWN0LW5hdGl2ZS9ibG9iL21hc3Rlci9SZWFjdC5wb2RzcGVj">node_modules&#x2F;react-native&#x2F;React.podspec<i class="fa fa-external-link-alt"></i></span>中，基本都是按其功能命名的。一般来说你首先需要添加Core，这一subspec包含了必须的AppRegistry、StyleSheet、View以及其他的一些React Native核心库。如果你想使用React Native的Text库（即<Text>组件），那就需要添加RCTText的subspec。同理，Image需要加入RCTImage，等等。</p>
<h3 id="Podfile"><a href="#Podfile" class="headerlink" title="Podfile"></a>Podfile</h3><p>在 CocoaPods 的 Podfile 中指定我们所需要使用的组件。如果原生没有用过 CocoaPods 管理;</p>
<blockquote>
<p>&#x2F;&#x2F;在iOS原生代码所在的目录中（也就是<code>.xcodeproj</code>文件所在的目录）执行：<br> <code>pod init</code></p>
</blockquote>
<p>Podfile 会创建在执行命令的目录中。你需要调整其内容以满足你的植入需求。调整后的Podfile的内容看起来类似下面这样：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># target的名字一般与你的项目名字相同</span><br><span class="line">target &#x27;NumberTileGame&#x27; do</span><br><span class="line"></span><br><span class="line">  # &#x27;node_modules&#x27;目录一般位于根目录中</span><br><span class="line">  # 但是如果你的结构不同，那你就要根据实际路径修改下面的`:path`</span><br><span class="line">  pod &#x27;React&#x27;, :path =&gt; &#x27;../node_modules/react-native&#x27;, :subspecs =&gt; [</span><br><span class="line">    &#x27;Core&#x27;,</span><br><span class="line">    &#x27;RCTText&#x27;,</span><br><span class="line">    &#x27;RCTNetwork&#x27;,</span><br><span class="line">    &#x27;RCTWebSocket&#x27;, # 这个模块是用于调试功能的</span><br><span class="line">    # 在这里继续添加你所需要的模块</span><br><span class="line">  ]</span><br><span class="line"></span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<h3 id="Pod安装"><a href="#Pod安装" class="headerlink" title="Pod安装"></a>Pod安装</h3><p>创建好了Podfile后，就可以开始安装React Native的pod包了。</p>
<blockquote>
<p><code>pod install</code></p>
</blockquote>
<h2 id="4-代码集成"><a href="#4-代码集成" class="headerlink" title="4. 代码集成"></a>4. 代码集成</h2><h3 id="原生代码集成"><a href="#原生代码集成" class="headerlink" title="原生代码集成"></a>原生代码集成</h3><p>在要混合开发的页面, 加入如下代码</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">// RNViewController 页面</span></span><br><span class="line">- (<span class="type">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="variable language_">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSURL</span> *jsCodeLocation = [<span class="built_in">NSURL</span> URLWithString:<span class="string">@&quot;http://localhost:8081/index.ios.bundle?platform=ios&quot;</span>];</span><br><span class="line">    RCTRootView *rootView = [[RCTRootView alloc] initWithBundleURL : jsCodeLocation</span><br><span class="line">                         moduleName        : <span class="string">@&quot;HybridApp&quot;</span></span><br><span class="line">                         initialProperties : @&#123;<span class="string">@&quot;page&quot;</span> : <span class="string">@&quot;RN1&quot;</span>&#125;  <span class="comment">// 传入参数,用于定义那个页面或者一些数据传输</span></span><br><span class="line">                          launchOptions    : <span class="literal">nil</span>];</span><br><span class="line">    <span class="keyword">self</span>.view = rootView;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="ReactNative代码集成"><a href="#ReactNative代码集成" class="headerlink" title="ReactNative代码集成"></a>ReactNative代码集成</h3><p><code>index.ios.js</code> js 代码的入口</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;<span class="title class_">AppRegistry</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;react-native&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./app&#x27;</span>;</span><br><span class="line"><span class="title class_">AppRegistry</span>.<span class="title function_">registerComponent</span>(<span class="string">&#x27;HybridApp&#x27;</span>, <span class="function">() =&gt;</span> <span class="title class_">App</span>);</span><br><span class="line"><span class="comment">// 注册模块</span></span><br></pre></td></tr></table></figure>
<p><code>app.js</code> 在这边做页面判断,当然你也可以根据自己的需求去做调整</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">RN1</span> <span class="keyword">from</span> <span class="string">&#x27;./ReactNative1&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">RN2</span> <span class="keyword">from</span> <span class="string">&#x27;./ReactNative2&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">App</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">props</span>[<span class="string">&#x27;page&#x27;</span>] == <span class="string">&#x27;RN1&#x27;</span> ? <span class="language-xml"><span class="tag">&lt;<span class="name">RN1</span> /&gt;</span></span>:<span class="language-xml"><span class="tag">&lt;<span class="name">RN2</span> /&gt;</span></span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>ReactNative1.js</code> 页面1</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">    <span class="title class_">StyleSheet</span>,</span><br><span class="line">    <span class="title class_">Text</span>,</span><br><span class="line">    <span class="title class_">View</span></span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;react-native&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">ReactNative1</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">View</span> <span class="attr">style</span>=<span class="string">&#123;styles.container&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">Text</span> <span class="attr">style</span>=<span class="string">&#123;styles.highScoresTitle&#125;</span>&gt;</span>ReactNative1<span class="tag">&lt;/<span class="name">Text</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">View</span> <span class="attr">style</span>=<span class="string">&#123;&#123;height:</span> <span class="attr">100</span>, <span class="attr">width:</span> <span class="attr">100</span>, <span class="attr">backgroundColor:</span> &#x27;<span class="attr">blue</span>&#x27;&#125;&#125; /&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">View</span>&gt;</span></span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> styles = <span class="title class_">StyleSheet</span>.<span class="title function_">create</span>(&#123;</span><br><span class="line">    <span class="attr">container</span>: &#123;</span><br><span class="line">        <span class="attr">flex</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">justifyContent</span>: <span class="string">&#x27;center&#x27;</span>,</span><br><span class="line">        <span class="attr">alignItems</span>: <span class="string">&#x27;center&#x27;</span>,</span><br><span class="line">        <span class="attr">backgroundColor</span>: <span class="string">&#x27;#FFFFFF&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">highScoresTitle</span>: &#123;</span><br><span class="line">        <span class="attr">fontSize</span>: <span class="number">20</span>,</span><br><span class="line">        <span class="attr">textAlign</span>: <span class="string">&#x27;center&#x27;</span>,</span><br><span class="line">        <span class="attr">margin</span>: <span class="number">10</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><code>ReactNative2.js</code> 页面2</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">    <span class="title class_">StyleSheet</span>,</span><br><span class="line">    <span class="title class_">Text</span>,</span><br><span class="line">    <span class="title class_">View</span></span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;react-native&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">ReactNative1</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">View</span> <span class="attr">style</span>=<span class="string">&#123;styles.container&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">Text</span> <span class="attr">style</span>=<span class="string">&#123;styles.highScoresTitle&#125;</span>&gt;</span>ReactNative2<span class="tag">&lt;/<span class="name">Text</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">View</span> <span class="attr">style</span>=<span class="string">&#123;&#123;height:</span> <span class="attr">100</span>, <span class="attr">width:</span> <span class="attr">100</span>, <span class="attr">backgroundColor:</span> &#x27;<span class="attr">red</span>&#x27;&#125;&#125; /&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">View</span>&gt;</span></span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> styles = <span class="title class_">StyleSheet</span>.<span class="title function_">create</span>(&#123;</span><br><span class="line">    <span class="attr">container</span>: &#123;</span><br><span class="line">        <span class="attr">flex</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">justifyContent</span>: <span class="string">&#x27;center&#x27;</span>,</span><br><span class="line">        <span class="attr">alignItems</span>: <span class="string">&#x27;center&#x27;</span>,</span><br><span class="line">        <span class="attr">backgroundColor</span>: <span class="string">&#x27;#FFFFFF&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">highScoresTitle</span>: &#123;</span><br><span class="line">        <span class="attr">fontSize</span>: <span class="number">20</span>,</span><br><span class="line">        <span class="attr">textAlign</span>: <span class="string">&#x27;center&#x27;</span>,</span><br><span class="line">        <span class="attr">margin</span>: <span class="number">10</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3N0cmF3ZmVycnkvSHlicmlkQXBw">&gt;&gt;项目gayhub地址&lt;&lt;<i class="fa fa-external-link-alt"></i></span><br>效果展示</p>
<p><img data-src="https://ws3.sinaimg.cn/large/8bbf0afbjw1fb4aykwmpyg20970gjgok.gif"></p>
]]></content>
  </entry>
  <entry>
    <title>uPic图片上传到图床</title>
    <url>/2020/09/24/uPic%E5%9B%BE%E7%89%87%E4%B8%8A%E4%BC%A0%E5%88%B0%E5%9B%BE%E5%BA%8A/</url>
    <content><![CDATA[<p>之前写文章用的图床是在微博,后面发现微博把这个给封了,这就让人很尴尬,最主要问题就是图片没了,之前的文章图片也没有备份,只能找寻新的图床,后面找到了 <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2dlZTFrL3VQaWM=">uPic<i class="fa fa-external-link-alt"></i></span> 软件,开源的用着也还不错,主要是可以上传图片到 git 仓库,还有外链,图片还能备份,满足了我基本使用,今天的文章就是 <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2dlZTFrL3VQaWM=">uPic<i class="fa fa-external-link-alt"></i></span> 和 <span class="exturl" data-url="aHR0cHM6Ly9naXRlZS5jb20v">gitee<i class="fa fa-external-link-alt"></i></span> 配合的基本配置;</p>
<h2 id="1-uPic-软件下载"><a href="#1-uPic-软件下载" class="headerlink" title="1. uPic 软件下载"></a>1. uPic 软件下载</h2><p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2dlZTFrL3VQaWMvcmVsZWFzZXM=">https://github.com/gee1k/uPic/releases<i class="fa fa-external-link-alt"></i></span> GitHub 去下载最新版本的文件,解压缩托进应用程序文件夹,双击打开就可使用</p>
<h2 id="2-gitee-配置"><a href="#2-gitee-配置" class="headerlink" title="2. gitee 配置"></a>2. gitee 配置</h2><ol>
<li>新建仓库</li>
</ol>
<blockquote>
<p><img data-src="https://cdn.jsdelivr.net/gh/strawferry/GSS@master/uPic/2020-09-24/16-19-zNF3dd-gitee%20%E4%BB%93%E5%BA%93%E5%88%9B%E5%BB%BA.jpg" alt="16-19-zNF3dd-gitee仓库创建"></p>
</blockquote>
<ol start="2">
<li>Token 创建<ul>
<li><ol>
<li>进入<span class="exturl" data-url="aHR0cHM6Ly9naXRlZS5jb20vcHJvZmlsZS9wZXJzb25hbF9hY2Nlc3NfdG9rZW5zL25ldw==">码云 Token 创建页面<i class="fa fa-external-link-alt"></i></span></li>
</ol>
</li>
<li><ol start="2">
<li>勾选 repo 访问权限。然后滚动页面到底部，点击Generate token按钮来生成 token<blockquote>
<p><img data-src="https://cdn.jsdelivr.net/gh/strawferry/GSS@master/uPic/2020-09-24/16-19-J68X4y-Token%E7%94%9F%E6%88%901.jpg" alt="16-19-J68X4y-Token生成1"></p>
</blockquote>
</li>
</ol>
</li>
<li><ol start="3">
<li>复制生成好的 Token 值到 uPic token 输入框<br> <img data-src="https://cdn.jsdelivr.net/gh/strawferry/GSS@master/uPic/2020-09-24/16-19-hkrtd9-Token%E7%94%9F%E6%88%902.jpg" alt="16-19-hkrtd9-Token生成2"><br> <strong>注意：</strong>此 Token 只会显示一次！请务必保存好，否则之后丢失了，就得重新创建</li>
</ol>
</li>
</ul>
</li>
</ol>
<h2 id="3-uPic-软件配置"><a href="#3-uPic-软件配置" class="headerlink" title="3. uPic 软件配置"></a>3. uPic 软件配置</h2><p>打开 <code>uPic</code> 的偏好设置,选择图床,添加 <code>Gitee</code> 图床,输入我们刚才创建的仓库资料和 <code>Token</code>,配置完成可以点击验证,看是否能够成功;</p>
<h2 id="保存路径我是设置为-uPic-year-month-day-filename-hour-minute-random-suffix"><a href="#保存路径我是设置为-uPic-year-month-day-filename-hour-minute-random-suffix" class="headerlink" title="保存路径我是设置为 uPic/{year}-{month}-{day}/{filename}-{hour}-{minute}-{random}{.suffix}"></a>保存路径我是设置为 <code>uPic/&#123;year&#125;-&#123;month&#125;-&#123;day&#125;/&#123;filename&#125;-&#123;hour&#125;-&#123;minute&#125;-&#123;random&#125;&#123;.suffix&#125;</code></h2><blockquote>
<p><img data-src="https://cdn.jsdelivr.net/gh/strawferry/GSS@master/uPic/2020-09-24/16-19-z3yzaa-uPic%E8%AE%BE%E7%BD%AE.jpg" alt="16-19-z3yzaa-uPic设置"></p>
</blockquote>
<hr>
<blockquote>
<p><img data-src="https://cdn.jsdelivr.net/gh/strawferry/GSS@master/uPic/2020-09-24/16-19-4fmCAf-uPic%E4%B8%8A%E4%BC%A0%E8%AE%BE%E7%BD%AE.jpg" alt="16-19-4fmCAf-uPic上传设置"></p>
</blockquote>
<hr>
<h2 id="4-uPic-软件使用"><a href="#4-uPic-软件使用" class="headerlink" title="4. uPic 软件使用"></a>4. uPic 软件使用</h2><h2 id="一般使用的话我是选择文件上传"><a href="#一般使用的话我是选择文件上传" class="headerlink" title="一般使用的话我是选择文件上传"></a>一般使用的话我是选择文件上传</h2><blockquote>
<p><img data-src="https://cdn.jsdelivr.net/gh/strawferry/GSS@master/uPic/2020-09-24/16-19-q8z5tJ-uPic%E9%80%89%E5%8F%96%E6%96%87%E4%BB%B6.jpg" alt="16-19-q8z5tJ-uPic选取文件"></p>
</blockquote>
<hr>
<p>还有一个是拖拽文件直接上传</p>
<blockquote>
<p><img data-src="https://cdn.jsdelivr.net/gh/strawferry/GSS@master/uPic/2020-09-24/16-19-8WcCLu-uPic%E6%8B%96%E6%8B%BD%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0.gif" alt="16-19-8WcCLu-uPic拖拽文件上传"> </p>
</blockquote>
]]></content>
  </entry>
  <entry>
    <title>pm2 node 服务器部署</title>
    <url>/2017/03/12/pm2%20node%20%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%83%A8%E7%BD%B2/</url>
    <content><![CDATA[<h1 id="pm2-node-服务器部署"><a href="#pm2-node-服务器部署" class="headerlink" title="pm2 node 服务器部署"></a>pm2 node 服务器部署</h1><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p><code>npm i -g pm2</code></p>
<h2 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h2><p>基本的 <code>pm2 start app.js</code></p>
<p>带参数 <code>pm2 ENV=production start app.js</code></p>
<h2 id="从-config-js-文件启动-pm2-start-app-config-js"><a href="#从-config-js-文件启动-pm2-start-app-config-js" class="headerlink" title="从 .config.js 文件启动 pm2 start app.config.js"></a>从 .config.js 文件启动 <code>pm2 start app.config.js</code></h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  apps : [&#123;</span><br><span class="line">    name        : <span class="string">&quot;worker&quot;</span>,</span><br><span class="line">    script      : <span class="string">&quot;./worker.js&quot;</span>,</span><br><span class="line">    watch       : <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">env</span>: &#123;</span><br><span class="line">      <span class="string">&quot;NODE_ENV&quot;</span>: <span class="string">&quot;development&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    env_production : &#123;</span><br><span class="line">       <span class="string">&quot;NODE_ENV&quot;</span>: <span class="string">&quot;production&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,&#123;</span><br><span class="line">    name       : <span class="string">&quot;api-app&quot;</span>,</span><br><span class="line">    script     : <span class="string">&quot;./api.js&quot;</span>,</span><br><span class="line">    instances  : <span class="number">4</span>,</span><br><span class="line">    exec_mode  : <span class="string">&quot;cluster&quot;</span></span><br><span class="line">  &#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="从-json-文件启动-pm2-start-app-json"><a href="#从-json-文件启动-pm2-start-app-json" class="headerlink" title="从 json 文件启动 pm2 start app.json"></a>从 json 文件启动 <code>pm2 start app.json</code></h2><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;apps&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;lost100-dev&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;script&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./scripts/server.js&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;watch&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;ignore_watch&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span> <span class="string">&quot;node_modules&quot;</span><span class="punctuation">,</span> <span class="string">&quot;files&quot;</span><span class="punctuation">,</span> <span class="string">&quot;public&quot;</span><span class="punctuation">,</span> <span class="string">&quot;logs&quot;</span><span class="punctuation">,</span> <span class="string">&quot;mongodb&quot;</span><span class="punctuation">,</span> <span class="string">&quot;build&quot;</span><span class="punctuation">,</span> <span class="string">&quot;.idea/&quot;</span><span class="punctuation">,</span> <span class="string">&quot;.git&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;max_memory_restart&quot;</span><span class="punctuation">:</span> <span class="string">&quot;150M&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;instances&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;exec_mode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cluster&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;env&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;NODE_ENV&quot;</span><span class="punctuation">:</span> <span class="string">&quot;dev&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;PORT&quot;</span><span class="punctuation">:</span> <span class="number">5566</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="可用的参数详情"><a href="#可用的参数详情" class="headerlink" title="可用的参数详情"></a>可用的参数详情</h2><p>General</p>
<table>
<thead>
<tr>
<th align="center">Field</th>
<th align="center">Type</th>
<th align="center">Example</th>
<th align="center">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="center">name</td>
<td align="center">(string)</td>
<td align="center">“my-api”</td>
<td align="center">application name (default to script filename without extension)</td>
</tr>
<tr>
<td align="center">script</td>
<td align="center">(string)</td>
<td align="center">”.&#x2F;api&#x2F;app.js”</td>
<td align="center">script path relative to pm2 start</td>
</tr>
<tr>
<td align="center">cwd</td>
<td align="center">(string)</td>
<td align="center">“&#x2F;var&#x2F;www&#x2F;”</td>
<td align="center">the directory from which your app will be launched</td>
</tr>
<tr>
<td align="center">args</td>
<td align="center">(string)</td>
<td align="center">“-a 13 -b 12”</td>
<td align="center">string containing all arguments passed via CLI to script</td>
</tr>
<tr>
<td align="center">interpreter</td>
<td align="center">(string)</td>
<td align="center">“&#x2F;usr&#x2F;bin&#x2F;python”</td>
<td align="center">interpreter absolute path (default to node)</td>
</tr>
<tr>
<td align="center">interpreter_args</td>
<td align="center">(string)</td>
<td align="center">”–harmony”</td>
<td align="center">option to pass to the interpreter</td>
</tr>
<tr>
<td align="center">node_args</td>
<td align="center">(string)</td>
<td align="center"></td>
<td align="center">alias to interpreter_args</td>
</tr>
</tbody></table>
<p>Advanced features</p>
<table>
<thead>
<tr>
<th align="center">Field</th>
<th align="center">Type</th>
<th align="center">Example</th>
<th align="center">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="center">instances</td>
<td align="center">number</td>
<td align="center">-1</td>
<td align="center">number of app instance to be launched</td>
</tr>
<tr>
<td align="center">exec_mode</td>
<td align="center">string</td>
<td align="center">“cluster”</td>
<td align="center">mode to start your app, can be “cluster” or “fork”, default fork</td>
</tr>
<tr>
<td align="center">watch</td>
<td align="center">boolean or []</td>
<td align="center">true</td>
<td align="center">enable watch &amp; restart feature, if a file change in the folder or subfolder, your app will get reloaded</td>
</tr>
<tr>
<td align="center">ignore_watch</td>
<td align="center">list</td>
<td align="center">[”[/\].&#x2F;”, “node_modules”]</td>
<td align="center">list of regex to ignore some file or folder names by the watch feature</td>
</tr>
<tr>
<td align="center">max_memory_restart</td>
<td align="center">string</td>
<td align="center">“150M”</td>
<td align="center">your app will be restarted if it exceeds the amount of memory specified. human-friendly format : it can be “10M”, “100K”, “2G” and so on…</td>
</tr>
<tr>
<td align="center">env</td>
<td align="center">object</td>
<td align="center">{“NODE_ENV”: “development”, “ID”: “42”}</td>
<td align="center">env variables which will appear in your app</td>
</tr>
<tr>
<td align="center">env_</td>
<td align="center">object</td>
<td align="center">{“NODE_ENV”: “production”, “ID”: “89”}</td>
<td align="center">inject when doing pm2 restart app.yml –env</td>
</tr>
<tr>
<td align="center">source_map_support</td>
<td align="center">boolean</td>
<td align="center">true</td>
<td align="center">default to true, [enable&#x2F;disable source map file]</td>
</tr>
<tr>
<td align="center">instance_var</td>
<td align="center">string</td>
<td align="center">“NODE_APP_INSTANCE”</td>
<td align="center">see documentation</td>
</tr>
</tbody></table>
<p>Log files</p>
<table>
<thead>
<tr>
<th align="center">Field</th>
<th align="center">Type</th>
<th align="center">Example</th>
<th align="center">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="center">log_date_format</td>
<td align="center">(string)</td>
<td align="center">“YYYY-MM-DD HH:mm Z”</td>
<td align="center">log date format (see log section)</td>
</tr>
<tr>
<td align="center">error_file</td>
<td align="center">(string)</td>
<td align="center">error file path</td>
<td align="center">(default to $HOME&#x2F;.pm2&#x2F;logs&#x2F;XXXerr.log)</td>
</tr>
<tr>
<td align="center">out_file</td>
<td align="center">(string)</td>
<td align="center">output file path</td>
<td align="center">(default to $HOME&#x2F;.pm2&#x2F;logs&#x2F;XXXout.log)</td>
</tr>
<tr>
<td align="center">combine_logs</td>
<td align="center">boolean</td>
<td align="center">true</td>
<td align="center">if set to true, avoid to suffix</td>
</tr>
<tr>
<td align="center">merge_logs</td>
<td align="center">boolean</td>
<td align="center">true</td>
<td align="center">alias to combine_logs</td>
</tr>
<tr>
<td align="center">pid_file</td>
<td align="center">(string)</td>
<td align="center">pid file path</td>
<td align="center">(default to $HOME&#x2F;.pm2&#x2F;pid&#x2F;app-pm_id.pid)</td>
</tr>
</tbody></table>
<p>Control flow</p>
<table>
<thead>
<tr>
<th align="center">Field</th>
<th align="center">Type</th>
<th align="center">Example</th>
<th align="center">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="center">min_uptime</td>
<td align="center">(string)</td>
<td align="center"></td>
<td align="center">min uptime of the app to be considered started</td>
</tr>
<tr>
<td align="center">listen_timeout</td>
<td align="center">number</td>
<td align="center">8000</td>
<td align="center">time in ms before forcing a reload if app not listening</td>
</tr>
<tr>
<td align="center">kill_timeout</td>
<td align="center">number</td>
<td align="center">1600</td>
<td align="center">time in milliseconds before sending a final SIGKILL</td>
</tr>
<tr>
<td align="center">wait_ready</td>
<td align="center">boolean</td>
<td align="center">false</td>
<td align="center">Instead of reload waiting for listen event, wait for process.send(‘ready’)</td>
</tr>
<tr>
<td align="center">max_restarts</td>
<td align="center">number</td>
<td align="center">10</td>
<td align="center">number of consecutive unstable restarts (less than 1sec interval or custom time via min_uptime) before your app is considered errored and stop being restarted</td>
</tr>
<tr>
<td align="center">restart_delay</td>
<td align="center">number</td>
<td align="center">4000</td>
<td align="center">time to wait before restarting a crashed app (in milliseconds). defaults to 0.</td>
</tr>
<tr>
<td align="center">autorestart</td>
<td align="center">boolean</td>
<td align="center">false</td>
<td align="center">true by default. if false, PM2 will not restart your app if it crashes or ends peacefully</td>
</tr>
<tr>
<td align="center">cron_restart</td>
<td align="center">string</td>
<td align="center">“1 0 * * *”</td>
<td align="center">a cron pattern to restart your app. Application must be running for cron feature to work</td>
</tr>
<tr>
<td align="center">vizion</td>
<td align="center">boolean</td>
<td align="center">false</td>
<td align="center">true by default. if false, PM2 will start without vizion features (versioning control metadatas)</td>
</tr>
<tr>
<td align="center">post_update</td>
<td align="center">list</td>
<td align="center">[“npm install”, “echo launching the app”]</td>
<td align="center">a list of commands which will be executed after you perform a Pull&#x2F;Upgrade operation from Keymetrics dashboard</td>
</tr>
<tr>
<td align="center">force</td>
<td align="center">boolean</td>
<td align="center">true</td>
<td align="center">defaults to false. if true, you can start the same script several times which is usually not allowed by PM2</td>
</tr>
</tbody></table>
]]></content>
  </entry>
  <entry>
    <title>使用 GitLab-CI 和 GitLab Runner 打包 iOS 应用</title>
    <url>/2019/08/08/%E4%BD%BF%E7%94%A8%20GitLab-CI%20%E5%92%8C%20GitLab%20Runner%20%E6%89%93%E5%8C%85%20iOS%20%E5%BA%94%E7%94%A8/</url>
    <content><![CDATA[<h1 id="使用-GitLab-CI-和-GitLab-Runner-打包-iOS-应用"><a href="#使用-GitLab-CI-和-GitLab-Runner-打包-iOS-应用" class="headerlink" title="使用 GitLab-CI 和 GitLab Runner 打包 iOS 应用"></a>使用 GitLab-CI 和 GitLab Runner 打包 iOS 应用</h1><h2 id="折腾由来"><a href="#折腾由来" class="headerlink" title="折腾由来"></a>折腾由来</h2><p>来源于一篇国外的<span class="exturl" data-url="aHR0cHM6Ly9tZWRpdW0uY29tL2ZsYXdsZXNzLWFwcC1zdG9yaWVzL2lvcy1jb250aW51b3VzLWludGVncmF0aW9uLXdpdGgtZ2l0bGFiLWNpLWZhc3RsYW5lLWFuZC1vdGEtaW5zdGFsbGF0aW9uLWZyb20tZ2l0bGFiLXBhZ2VzLWYzMTJlMDdhYjA2ZQ==">博客 iOS Continuous Integration with GitLab CI, Fastlane &amp; OTA Installation<i class="fa fa-external-link-alt"></i></span>,看到其使用 GitLab-CI 和 GitLab Runner 来打包 iOS 应用做持续集成,看着还不错,自己之前也做了一些持续集成的例子;</p>
<h2 id="1-安装-runner"><a href="#1-安装-runner" class="headerlink" title="1. 安装 runner"></a>1. <span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmdpdGxhYi5jb20vcnVubmVyL2luc3RhbGwv">安装 runner<i class="fa fa-external-link-alt"></i></span></h2><ul>
<li>手动安装(推荐)<ol>
<li>下载 binary <code>sudo curl --output /usr/local/bin/gitlab-runner https://gitlab-runner-downloads.s3.amazonaws.com/latest/binaries/gitlab-runner-darwin-amd64</code></li>
<li>设置权限 <code>sudo chmod +x /usr/local/bin/gitlab-runner</code></li>
</ol>
</li>
<li>brew 安装(发现会有权限问题)<ol>
<li>安装 <code>brew install gitlab-runner</code></li>
<li>启动 <code>brew services start gitlab-runner</code></li>
</ol>
</li>
</ul>
<h2 id="2-注册-Runners"><a href="#2-注册-Runners" class="headerlink" title="2. 注册 Runners"></a>2. <span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmdpdGxhYi5jb20vcnVubmVyL3JlZ2lzdGVyL2luZGV4Lmh0bWw=">注册 Runners<i class="fa fa-external-link-alt"></i></span></h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. 注册 runner</span><br><span class="line">sudo gitlab-runner register</span><br><span class="line">2. 填写 gitlab-ci 地址,这边以官方的为主</span><br><span class="line">Please enter the gitlab-ci coordinator URL (e.g. https://gitlab.com )</span><br><span class="line">https://gitlab.com</span><br><span class="line">3. 输入获取的 token ,下面会介绍如何获取</span><br><span class="line">Please enter the gitlab-ci token for this runner</span><br><span class="line">xxx</span><br><span class="line">4. 输入描述,后面可以修改</span><br><span class="line">Please enter the gitlab-ci description for this runner</span><br><span class="line">mac description</span><br><span class="line">5. 输入机器的 tag,后面可以修改</span><br><span class="line">Please enter the gitlab-ci tags for this runner (comma separated):</span><br><span class="line">mymac</span><br><span class="line">6. 输入执行类型,这边填入 shell</span><br><span class="line">Please enter the executor: ssh, docker+machine, docker-ssh+machine, kubernetes, docker, parallels, virtualbox, docker-ssh, shell:</span><br><span class="line">docker</span><br><span class="line">shell</span><br></pre></td></tr></table></figure>

<p><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1g5s3nzlhr8j221a28gay4.jpg" alt="获取 token"></p>
<h2 id="3-配置-gitlab-ci-yml-文件"><a href="#3-配置-gitlab-ci-yml-文件" class="headerlink" title="3. 配置 .gitlab-ci.yml 文件"></a>3. <span class="exturl" data-url="aHR0cHM6Ly9naXRsYWIuY29tL2hlbHAvdXNlci9wcm9qZWN0L3BpcGVsaW5lcy9zZXR0aW5ncyNjdXN0b20tY2ktY29uZmlnLXBhdGg=">配置 .gitlab-ci.yml 文件<i class="fa fa-external-link-alt"></i></span></h2><p>在 git 的根目录创建 <code>.gitlab-ci.yml </code> 文件,内容示例如下</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="attr">before_script:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">echo</span> <span class="string">&quot;----------global---before_script--------------&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">stages:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">build</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">publish</span></span><br><span class="line"><span class="comment"># 构建 pipeline</span></span><br><span class="line"></span><br><span class="line"><span class="attr">build_job:</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">build</span></span><br><span class="line">  <span class="attr">tags:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">testmac</span></span><br><span class="line">  <span class="attr">before_script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">echo</span> <span class="string">&quot;------build-------before_script--------------&quot;</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">sh</span> <span class="string">ios.sh</span></span><br><span class="line"><span class="comment"># 打包 App 脚本</span></span><br><span class="line">  <span class="attr">artifacts:</span></span><br><span class="line">    <span class="attr">expire_in:</span> <span class="number">90</span> <span class="string">days</span></span><br><span class="line">    <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">build</span></span><br><span class="line"><span class="comment"># 构建产物打包保存服务器</span></span><br><span class="line">  <span class="attr">only:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">master</span></span><br><span class="line"></span><br><span class="line"><span class="attr">pages:</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">publish</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ls</span> <span class="string">build</span></span><br><span class="line"><span class="string">index.html</span></span><br><span class="line">  <span class="attr">artifacts:</span></span><br><span class="line">    <span class="attr">expire_in:</span> <span class="number">90</span> <span class="string">days</span></span><br><span class="line">    <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">build</span></span><br><span class="line"><span class="comment"># 把 build 文件设置成 pages 静态托管</span></span><br><span class="line">  <span class="attr">only:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">master</span></span><br></pre></td></tr></table></figure>
<p><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmdpdGxhYi5jb20vZWUvY2kveWFtbC9SRUFETUUuaHRtbA==">一些 gitlab-ci 配置文档, GitLab CI&#x2F;CD Pipeline Configuration Reference<i class="fa fa-external-link-alt"></i></span></p>
<h2 id="4-自动构建"><a href="#4-自动构建" class="headerlink" title="4. 自动构建"></a>4. 自动构建</h2><p>当代码推上去后, gitlab-ci 会触发构建,向 GitLab Runner(自己设置的机器) 发布任务,并执行构建</p>
<ul>
<li>push 取消自动构建</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git push --push-option=ci.skip    # using git 2.10+</span><br><span class="line">git push -o ci.skip               # using git 2.18+</span><br></pre></td></tr></table></figure>
<p><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1g5s3nxzvb3j22741n4arj.jpg" alt="构建面板"></p>
<h2 id="5-定时自动构建"><a href="#5-定时自动构建" class="headerlink" title="5. 定时自动构建"></a>5. 定时自动构建</h2><p>根据自己需要自己添加定时构建<br><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1g5s41sx3bpj22721muai3.jpg"></p>
]]></content>
  </entry>
  <entry>
    <title>使用 Storybook 开发管理组件(ReactNative 版本)</title>
    <url>/2019/07/25/%E4%BD%BF%E7%94%A8%20Storybook%20%E5%BC%80%E5%8F%91%E7%AE%A1%E7%90%86%E7%BB%84%E4%BB%B6(ReactNative%20%E7%89%88%E6%9C%AC)/</url>
    <content><![CDATA[<h1 id="使用-Storybook-开发管理组件-ReactNative-版本"><a href="#使用-Storybook-开发管理组件-ReactNative-版本" class="headerlink" title="使用 Storybook 开发管理组件(ReactNative 版本)"></a>使用 Storybook 开发管理组件(ReactNative 版本)</h1><h2 id="0-介绍"><a href="#0-介绍" class="headerlink" title="0. 介绍"></a>0. 介绍</h2><p><span class="exturl" data-url="aHR0cHM6Ly9zdG9yeWJvb2suanMub3JnLw==">Storybook<i class="fa fa-external-link-alt"></i></span> 是 UI 组件的开发环境。它允许您浏览组件库，查看每个组件的不同状态，以及交互式开发和测试组件。</p>
<p>根据官网的介绍可以支持 <code>React,React Native,Vue,Angular,Ember,HTML,Svelte,Mithril,Riot</code>.</p>
<p>做了不少 ReactNative 的项目,每个项目的组件不少,开发到最后都不知道有多少个,如何使用,所以才会想着用啥管理起来,我这次讲的就是关于 React Native 的一些简单使用方法;</p>
<h2 id="1-安装-ReactNative-版本"><a href="#1-安装-ReactNative-版本" class="headerlink" title="1. 安装(ReactNative 版本)"></a>1. <span class="exturl" data-url="aHR0cHM6Ly9zdG9yeWJvb2suanMub3JnL2RvY3MvZ3VpZGVzL2d1aWRlLXJlYWN0LW5hdGl2ZS8=">安装(ReactNative 版本)<i class="fa fa-external-link-alt"></i></span></h2><ul>
<li><p>Automatic setup 自动安装,通过官方的 <code>@storybook/cli</code> 命令行创建 </p>
<p>  <code>npx -p @storybook/cli sb init --type react_native</code></p>
<ul>
<li><p>是否安装 web server 选取</p>
<blockquote>
<p><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1g5byy5hvrmj21no0vq7a7.jpg"></p>
</blockquote>
</li>
</ul>
</li>
</ul>
<p><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1g5byy5lhepj21no0vqtda.jpg"><br><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1g5byy5fi6pj21jy144na8.jpg"><br>安装完成,一些依赖,以及文件目录</p>
<pre><code>* 启动项目

    &gt; ![](https://ws1.sinaimg.cn/large/8bbf0afbly1g5byy5yakej20q81g0wq9.jpg)
发现会有依赖缺失,缺失的依赖安装(估计是当前版本缺失吧)
`yarn add -D emotion-theming @emotion/core`
![](https://ws1.sinaimg.cn/large/8bbf0afbly1g5byy5kfm6g208e0gkgu5.gif)运行成功

* `yarn storybook` 启动 web server 管理
    &gt; ![](https://ws1.sinaimg.cn/large/8bbf0afbly1g5byy5k5paj22081d018u.jpg)
</code></pre>
<ul>
<li><p>Manual setup 手动安装,自己添加依赖,以及配置文件位置(稍微麻烦点)</p>
<p>  <code>yarn add -D @storybook/react-native @storybook/addons @storybook/addon-links @storybook/addon-actions emotion-theming @emotion/core babel-loader @storybook/react-native-server</code></p>
<p>  文件目录的就可以参照自动创建的,或者跟着<span class="exturl" data-url="aHR0cHM6Ly9zdG9yeWJvb2suanMub3JnL2RvY3MvZ3VpZGVzL2d1aWRlLXJlYWN0LW5hdGl2ZS8=">官方教程<i class="fa fa-external-link-alt"></i></span></p>
</li>
</ul>
<p>做,这边就不在展开,基本后面展示和上面一样</p>
<h2 id="2-插件-addon"><a href="#2-插件-addon" class="headerlink" title="2. 插件 addon"></a>2. <span class="exturl" data-url="aHR0cHM6Ly9zdG9yeWJvb2suanMub3JnL2FkZG9ucy8=">插件 addon<i class="fa fa-external-link-alt"></i></span></h2><p>刚才跑起来的项目点击到 ADDONS 里面显示没有配置加载,这里就说下插件已经配置<br>首先是一张官方 addon 插件支持表,可以看出 React 支持的最多, rn 的支持偏少而且支持配置比较复杂,接下来继续看</p>
<blockquote>
<p><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1g5bzxfrlx0j21dy1f4wm1.jpg"></p>
</blockquote>
<h3 id="2-1-storybook-addon-actions-storybook-addon-ondevice-actions"><a href="#2-1-storybook-addon-actions-storybook-addon-ondevice-actions" class="headerlink" title="2.1 @storybook&#x2F;addon-actions | @storybook&#x2F;addon-ondevice-actions"></a>2.1 <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3N0b3J5Ym9va2pzL3N0b3J5Ym9vay90cmVlL21hc3Rlci9hZGRvbnMvYWN0aW9ucw==">@storybook&#x2F;addon-actions | @storybook&#x2F;addon-ondevice-actions<i class="fa fa-external-link-alt"></i></span></h3><p>Storybook Addon Actions可用于显示Storybook中事件处理程序接收的数据。</p>
<blockquote>
<p><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1g5c1fkd964j20r01g4q4p.jpg"></p>
</blockquote>
<h3 id="2-2-storybook-addon-notes-storybook-addon-ondevice-notes"><a href="#2-2-storybook-addon-notes-storybook-addon-ondevice-notes" class="headerlink" title="2.2 @storybook&#x2F;addon-notes | @storybook&#x2F;addon-ondevice-notes"></a>2.2 <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3N0b3J5Ym9va2pzL3N0b3J5Ym9vay90cmVlL25leHQvYWRkb25zL25vdGVz">@storybook&#x2F;addon-notes | @storybook&#x2F;addon-ondevice-notes<i class="fa fa-external-link-alt"></i></span></h3><p>Storybook Addon Notes允许您在Storybook中为故事编写注释（文本或HTML）。</p>
<blockquote>
<p><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1g5c2avs030j20r01g4tah.jpg"></p>
</blockquote>
<h3 id="2-3-storybook-addon-links"><a href="#2-3-storybook-addon-links" class="headerlink" title="2.3 @storybook&#x2F;addon-links"></a>2.3 <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3N0b3J5Ym9va2pzL3N0b3J5Ym9vay90cmVlL25leHQvYWRkb25zL2xpbmtz">@storybook&#x2F;addon-links<i class="fa fa-external-link-alt"></i></span></h3><p>Storybook Links addon 可用于创建在故事书中的故事之间导航的链接。在 ReactNative 中链接跳转这个版本好像有点问题,待跟进看下</p>
<blockquote>
<p><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1g5c2msbup2g207w0fi79q.gif"></p>
</blockquote>
<h3 id="2-4-storybook-addon-backgrounds-storybook-addon-ondevice-backgrounds"><a href="#2-4-storybook-addon-backgrounds-storybook-addon-ondevice-backgrounds" class="headerlink" title="2.4 @storybook&#x2F;addon-backgrounds | @storybook&#x2F;addon-ondevice-backgrounds"></a>2.4 <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3N0b3J5Ym9va2pzL3N0b3J5Ym9vay90cmVlL25leHQvYWRkb25zL2JhY2tncm91bmRz">@storybook&#x2F;addon-backgrounds | @storybook&#x2F;addon-ondevice-backgrounds<i class="fa fa-external-link-alt"></i></span></h3><p>Storybook Background Addon 可用于更改故事书中预览中的背景颜色。</p>
<blockquote>
<p><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1g5c2y0e85yg207w0fi0wd.gif"></p>
</blockquote>
<h3 id="2-5-storybook-addon-knobs-storybook-addon-ondevice-knobs"><a href="#2-5-storybook-addon-knobs-storybook-addon-ondevice-knobs" class="headerlink" title="2.5 @storybook&#x2F;addon-knobs | @storybook&#x2F;addon-ondevice-knobs"></a>2.5 <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3N0b3J5Ym9va2pzL3N0b3J5Ym9vay90cmVlL25leHQvYWRkb25zL2tub2Jz">@storybook&#x2F;addon-knobs | @storybook&#x2F;addon-ondevice-knobs<i class="fa fa-external-link-alt"></i></span></h3><p>Storybook Addon Knobs 允许您使用Storybook UI动态编辑React道具。您还可以使用旋钮作为Storybook中故事的动态变量。</p>
<blockquote>
<p><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1g5c35lg0pbg207w0fiada.gif"></p>
</blockquote>
<h3 id="2-6-storybook-addon-options"><a href="#2-6-storybook-addon-options" class="headerlink" title="2.6 @storybook&#x2F;addon-options"></a>2.6 <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3N0b3J5Ym9va2pzL3N0b3J5Ym9vay90cmVlL25leHQvYWRkb25zL29wdGlvbnM=">@storybook&#x2F;addon-options<i class="fa fa-external-link-alt"></i></span></h3><ul>
<li>NOTE: Options Addon is deprecated as of Storybook 5.0,直接内嵌<ul>
<li>Global options: addParameters({ options: { … }}) and no addon is needed.</li>
<li>Story options: storiesOf(…).add(‘name’, storyFn, { options: { … }})</li>
</ul>
</li>
</ul>
<h2 id="3-总结"><a href="#3-总结" class="headerlink" title="3.总结"></a>3.总结</h2><ul>
<li><p>Storybook 可以通过给每个组件写 story ,然后显示一些使用案例,同时可以根据一些 addon 插件,做到直接调试 UI,同时这样也能很好的管理组件;</p>
</li>
<li><p>可以通过官方给的 <span class="exturl" data-url="aHR0cHM6Ly9zdG9yeWJvb2suanMub3JnL2RvY3MvYWRkb25zL2FwaS8=">addon API<i class="fa fa-external-link-alt"></i></span> 自己写一些好用的插件,可以参考 <span class="exturl" data-url="aHR0cHM6Ly9zdG9yeWJvb2suanMub3JnL2RvY3MvYWRkb25zL3dyaXRpbmctYWRkb25zLw==">官方教程<i class="fa fa-external-link-alt"></i></span></p>
</li>
</ul>
<h2 id="相关链接"><a href="#相关链接" class="headerlink" title="相关链接"></a>相关链接</h2><ul>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3N0cmF3ZmVycnkvc3Rvcnlib29rcm4uZ2l0">GitHub 示例代码地址<i class="fa fa-external-link-alt"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3N0b3J5Ym9va2pzL3N0b3J5Ym9vaw==">Storybook GitHub<i class="fa fa-external-link-alt"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9zdG9yeWJvb2suanMub3JnLw==">Storybook 官网<i class="fa fa-external-link-alt"></i></span></li>
</ul>
]]></content>
  </entry>
  <entry>
    <title>利用 App Center 来打包你的应用</title>
    <url>/2019/05/07/%E5%88%A9%E7%94%A8%20App%20Center%20%E6%9D%A5%E6%89%93%E5%8C%85%E4%BD%A0%E7%9A%84%E5%BA%94%E7%94%A8/</url>
    <content><![CDATA[<h1 id="利用-App-Center-来打包你的应用"><a href="#利用-App-Center-来打包你的应用" class="headerlink" title="利用 App Center 来打包你的应用"></a>利用 App Center 来打包你的应用</h1><p>App Center 是巨硬(微软)家的一个应用开发管理平台服务,之前主要使用的是他的 CodePush 服务,后续平台升级了,把开发的崩溃收集,数据统计,推送服务,应用构建及测试,CodePush 等多个服务融合在一起,做出的 App Center 平台,基本功能也都是免费的,今天这篇文章主要是讲 iOS (原生和 ReactNative)应用通过 App Center 来打包;</p>
<h2 id="0-前期准备"><a href="#0-前期准备" class="headerlink" title="0. 前期准备"></a>0. 前期准备</h2><ol>
<li>App Center 账号(可通过 GitHub 账号授权登录) <span class="exturl" data-url="aHR0cHM6Ly9hcHBjZW50ZXIubXMv">https://appcenter.ms<i class="fa fa-external-link-alt"></i></span>;</li>
<li>GitHub 账号 <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tLw==">https://github.com/<i class="fa fa-external-link-alt"></i></span>;</li>
</ol>
<h2 id="1-设置-Build-配置"><a href="#1-设置-Build-配置" class="headerlink" title="1. 设置 Build 配置"></a>1. 设置 Build 配置</h2><h3 id="1-1-仪表盘点击创建应用"><a href="#1-1-仪表盘点击创建应用" class="headerlink" title="1.1 仪表盘点击创建应用"></a>1.1 仪表盘点击创建应用</h3><p><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1g2sptw03wnj220k0y00xn.jpg"></p>
<h3 id="1-2-填写应用信息"><a href="#1-2-填写应用信息" class="headerlink" title="1.2 填写应用信息"></a>1.2 填写应用信息</h3><blockquote>
<ol>
<li>填写应用基础信息  –&gt; 应用名称 –&gt; Release type</li>
<li>App Center 可以用来构建多种系统平台的应用,以及不同平台写的应用</li>
<li>这边我们 OS 选取 iOS , Platform 选 Objective-C &#x2F; Swift</li>
</ol>
</blockquote>
<p><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1g2spvcr5lgj221e11eq9v.jpg"></p>
<h3 id="1-3-添加构建仓库"><a href="#1-3-添加构建仓库" class="headerlink" title="1.3 添加构建仓库"></a>1.3 添加构建仓库</h3><blockquote>
<p>点击构建配置,连接仓库,选取 GitHub 仓库</p>
</blockquote>
<p><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1g2sq5x2f1vj222a116dmg.jpg"></p>
<blockquote>
<p>通过关联的 GitHub 账号,选取相应的 iOS 仓库</p>
</blockquote>
<p><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1g2sq7ty51vj2226114wlv.jpg"></p>
<h3 id="1-4-分支构建配置"><a href="#1-4-分支构建配置" class="headerlink" title="1.4 分支构建配置"></a>1.4 分支构建配置</h3><blockquote>
<p>根据 GitHub 仓库获取仓库分支,点击分支对应的构建配置</p>
</blockquote>
<p><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1g2sq9bl4vpj223u0ys43f.jpg"></p>
<h3 id="1-5-构建配置"><a href="#1-5-构建配置" class="headerlink" title="1.5 构建配置"></a>1.5 构建配置</h3><blockquote>
<ol>
<li>App Center 会读取仓库的文件,让你选取你要构建的 Project&#x2F;Workspace 和相应 Shared Scheme;</li>
<li>Xcode 版本;</li>
<li>Build scripts 自定义构建脚本,脚本是包含在 git 仓库文件里,具体配置<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLm1pY3Jvc29mdC5jb20vZW4tdXMvYXBwY2VudGVyL2J1aWxkL2N1c3RvbS9zY3JpcHRzLw==">见文档<i class="fa fa-external-link-alt"></i></span>;(可选配置)</li>
<li>构建触发规则, push 触发构建&#x2F;手动触发;</li>
<li>自动增加构建号,自动测试配置;(可选配置)</li>
<li>环境变量设置,<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLm1pY3Jvc29mdC5jb20vZW4tdXMvYXBwY2VudGVyL2J1aWxkL2N1c3RvbS92YXJpYWJsZXMv">见文档<i class="fa fa-external-link-alt"></i></span></li>
<li>签名证书设置,证书导出这边不做过多介绍,可参考<span class="exturl" data-url="aHR0cHM6Ly93d3cuamlhbnNodS5jb20vcC85NmNlMTIwMWIzMmU=">链接<i class="fa fa-external-link-alt"></i></span>;</li>
<li>真机测试,分发构建,构建状态图标;(可选配置)</li>
</ol>
</blockquote>
<p><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1g2sqc4f8bbj223g2b4kaa.jpg"></p>
<h3 id="1-6-分支构建历史"><a href="#1-6-分支构建历史" class="headerlink" title="1.6 分支构建历史"></a>1.6 分支构建历史</h3><p><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1g2sr1apnj3j221019ggsk.jpg"></p>
<h3 id="1-7-构建产物"><a href="#1-7-构建产物" class="headerlink" title="1.7 构建产物"></a>1.7 构建产物</h3><blockquote>
<p>构建完成后有 ipa 包等,可以通过 App Center 分发</p>
</blockquote>
<p><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1g2sraxze93j221s1a2k4v.jpg"></p>
<blockquote>
<p>但是个人发现访问和下载速度上不是很快,所以通过 Post-build 脚本自己上传到蒲公英托管平台;</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env bash</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$AGENT_JOBSTATUS</span>&quot;</span> == <span class="string">&quot;Succeeded&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line"></span><br><span class="line">ukey=蒲公英ukey</span><br><span class="line">apikey=蒲公英apikey</span><br><span class="line">desc=蒲公英上传描述</span><br><span class="line"></span><br><span class="line">curl -F <span class="string">&quot;file=@<span class="variable">$APPCENTER_OUTPUT_DIRECTORY</span>/<span class="variable">$APPCENTER_XCODE_SCHEME</span>.ipa&quot;</span> \</span><br><span class="line"> -F <span class="string">&quot;uKey=<span class="variable">$ukey</span>&quot;</span> -F <span class="string">&quot;_api_key=<span class="variable">$apikey</span>&quot;</span> \</span><br><span class="line">  -F <span class="string">&quot;updateDescription=<span class="variable">$desc</span>&quot;</span> https://qiniu-storage.pgyer.com/apiv1/app/upload</span><br><span class="line"></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<p><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1g2st0ejwiqj216s0o8adx.jpg"></p>
<h2 id="2-总结"><a href="#2-总结" class="headerlink" title="2. 总结"></a>2. 总结</h2><p>App Center 里面提供了一系列的关于应用开发的 SDK 和服务,产品做得很全面,还提供了一些云的概念操作(线上打包);</p>
<p>有时间可以多研究 App Center 的这一套东西,如果一个公司规模够大,产品丰富,也可以自己搭建一个自己像这样的一套系统;</p>
]]></content>
  </entry>
  <entry>
    <title>利用 Travis CI 自动部署 hexo 博客到 GitHub Pages 上</title>
    <url>/2017/04/16/%E5%88%A9%E7%94%A8%20Travis%20CL%20%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2%20hexo%20%E5%8D%9A%E5%AE%A2%E5%88%B0%20GitHub%20Pages%20%E4%B8%8A/</url>
    <content><![CDATA[<p>最近一直在看一些关于持续集成的东西,持续集成会对整个项目的敏捷开发有很大的帮助;</p>
<p>了解过 jenkins, 功能非常强大,但是在做 iOS 持续集成必须在一台 Mac 系统下,后面通过了解和别人介绍,认识到了今天的主角 Travis CI;</p>
<p>hexo虽然可以方便地部署github静态博客，但是仅仅是把最终生成的html保存在repository中，像原始的Markdown文件，hexo配置文件，主题配置文件，修改文件都仅仅是保存在本地。这样不利于保存，也无法查看每篇博客的修改历史。更重要的是无法做到跨平台，也不易于多人写作。</p>
<p>想法是每次写博客，只需要push md文件及博客所需的资源文件即可。Travis CI持续集成tool可以满足此需求。</p>
<p>Travis CI 目前主要是和 GitHub 一起使用,所以今天的例子就以 hexo 博客的每次 push 触发 Travis CI 自动部署到 GitHub 的 Pages 上;</p>
<h2 id="1-思路"><a href="#1-思路" class="headerlink" title="1. 思路"></a>1. 思路</h2><blockquote>
<p><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1feoojwv4fej20r20cpwje.jpg"></p>
</blockquote>
<h2 id="2-具体实现"><a href="#2-具体实现" class="headerlink" title="2. 具体实现"></a>2. 具体实现</h2><h3 id="2-1-首先需要在-GitHub-上面创建一个仓库-或者已有"><a href="#2-1-首先需要在-GitHub-上面创建一个仓库-或者已有" class="headerlink" title="2.1 首先需要在 GitHub 上面创建一个仓库(或者已有)"></a>2.1 首先需要在 GitHub 上面创建一个仓库(或者已有)</h3><blockquote>
<p>以新建仓库为例</p>
</blockquote>
<blockquote>
<p><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1feoow4xyehj20ke0esad6.jpg"></p>
</blockquote>
<h3 id="2-2-生成-Personal-Access-tokens"><a href="#2-2-生成-Personal-Access-tokens" class="headerlink" title="2.2 生成 Personal Access tokens"></a>2.2 生成 Personal Access tokens</h3><blockquote>
<p>为后续的功能生成的 token</p>
</blockquote>
<p>登录github, settings -&gt; Personal access tokens -&gt; Generate new token</p>
<blockquote>
<p><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1feoow57epmj21nk1a4n60.jpg"></p>
</blockquote>
<p>填写token description，比如叫 travis.并勾选上授予的权限，比如我勾选的是repo和gist，然后create.</p>
<blockquote>
<p><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1feoow4xvs2j20l60e0tci.jpg"></p>
</blockquote>
<p>将产生的token串复制保留下来，后面会使用到,如果丢失，只能重新产生。</p>
<blockquote>
<p><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1feoow4xzrej20l50aujvg.jpg"></p>
</blockquote>
<h3 id="2-3-travis-ci-设置"><a href="#2-3-travis-ci-设置" class="headerlink" title="2.3 travis-ci 设置"></a>2.3 <span class="exturl" data-url="aHR0cHM6Ly90cmF2aXMtY2kub3JnLw==">travis-ci 设置<i class="fa fa-external-link-alt"></i></span></h3><p>登录 travis-ci 网站,利用 GitHub 账号登录;</p>
<p>同步 GitHub 仓库</p>
<blockquote>
<p><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1feopcj6xuqj20ug0ctjv3.jpg"></p>
</blockquote>
<p>选取刚才创建的仓库并打开</p>
<blockquote>
<p><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1feopcj4vwfj20d808fgmt.jpg"></p>
</blockquote>
<p>添加刚才的 token 作为全局变量</p>
<blockquote>
<p><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1feopcj8aw7j20v60ql7b3.jpg"></p>
</blockquote>
<h3 id="2-4-hexo-博客设置"><a href="#2-4-hexo-博客设置" class="headerlink" title="2.4 hexo 博客设置"></a>2.4 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlvLw==">hexo 博客设置<i class="fa fa-external-link-alt"></i></span></h3><p>基本的 hexo 命令</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install hexo-cli -g</span><br><span class="line">hexo init blog</span><br><span class="line"><span class="built_in">cd</span> blog</span><br><span class="line">npm install</span><br><span class="line">hexo server</span><br></pre></td></tr></table></figure>
<p>进入 blog 所在的文件夹下，新建 <code>.travis.yml</code> 文件，并添加以下内容</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"># 使用语言</span><br><span class="line"><span class="attr">language</span>: node_js</span><br><span class="line"># node版本</span><br><span class="line"><span class="attr">node_js</span>: stable</span><br><span class="line"># 设置只监听哪个分支</span><br><span class="line"><span class="attr">branches</span>:</span><br><span class="line">  <span class="attr">only</span>:</span><br><span class="line">  - source</span><br><span class="line"># 缓存，可以节省集成的时间，这里我用了yarn，如果不用可以删除</span><br><span class="line"><span class="attr">cache</span>:</span><br><span class="line">  <span class="attr">apt</span>: <span class="literal">true</span></span><br><span class="line">  <span class="attr">yarn</span>: <span class="literal">true</span></span><br><span class="line">  <span class="attr">directories</span>:</span><br><span class="line">    - node_modules</span><br><span class="line"># tarvis生命周期执行顺序详见官网文档</span><br><span class="line"><span class="attr">before_install</span>:</span><br><span class="line">- git config --<span class="variable language_">global</span> user.<span class="property">name</span> <span class="string">&quot;name&quot;</span></span><br><span class="line">- git config --<span class="variable language_">global</span> user.<span class="property">email</span> <span class="string">&quot;mmail@mail.com&quot;</span></span><br><span class="line"># 由于使用了yarn，所以需要下载，如不用yarn这两行可以删除</span><br><span class="line">- curl -o- -L <span class="attr">https</span>:<span class="comment">//yarnpkg.com/install.sh | bash</span></span><br><span class="line">- <span class="keyword">export</span> <span class="variable constant_">PATH</span>=$HOME/.<span class="property">yarn</span>/<span class="attr">bin</span>:$PATH</span><br><span class="line">- npm install -g hexo-cli</span><br><span class="line"><span class="attr">install</span>:</span><br><span class="line"># 不用yarn的话这里改成 npm i 即可</span><br><span class="line">- yarn</span><br><span class="line"><span class="attr">script</span>:</span><br><span class="line">- hexo clean</span><br><span class="line">- hexo generate</span><br><span class="line"><span class="attr">after_success</span>:</span><br><span class="line">- cd ./public</span><br><span class="line">- git init</span><br><span class="line">- git add --all .</span><br><span class="line">- git commit -m <span class="string">&quot;Travis CI Auto Builder&quot;</span></span><br><span class="line"># 这里的 <span class="variable constant_">REPO_TOKEN</span> 即之前在 travis 项目的环境变量里添加的</span><br><span class="line">- git push --quiet --force <span class="attr">https</span>:<span class="comment">//$REPO_TOKEN@git@github.com/strawferry/FerryVipBlog.git master</span></span><br></pre></td></tr></table></figure>
<p>然后，准备 push 该项目到 github ，如果是新项目可参照下面的git指令</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git init</span><br><span class="line"><span class="comment"># 添加自己的项目</span></span><br><span class="line">git remote add origin git@github.com:strawferry/travis.git</span><br><span class="line"><span class="comment"># 新建并切换分支</span></span><br><span class="line">git checkout --orphan <span class="built_in">source</span></span><br><span class="line">git add -A</span><br><span class="line">git commit -m <span class="string">&quot;init repo&quot;</span></span><br><span class="line">git push</span><br></pre></td></tr></table></figure>
<h3 id="2-5-发布博客文章"><a href="#2-5-发布博客文章" class="headerlink" title="2.5 发布博客文章"></a>2.5 发布博客文章</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">前往 <span class="built_in">source</span> 分支下:</span><br><span class="line">hexo new title   // 1. 新建文章;</span><br><span class="line">2. 使用 markdown 软件或者 vim 直接编写文章内容,并保存文件;</span><br><span class="line">3. 把目前分支的内容变化提交到 git 线上仓库;</span><br><span class="line">4. 接着就等待 travis-ci 自动部署到 pages 上;</span><br></pre></td></tr></table></figure>
<p><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1feouarcga0j20uy0sqn63.jpg"><br><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1feouaresa4j20mx0s0k4r.jpg"></p>
<p>这样你的博客就已经成功部署到 pages 上面了</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>这个是一个简单的对 travis-ci 的入门,这样能够给我们提供不少的事,持续集成能够给开发带来极大的便利,让程序员不做一些重复的事情,提高效率;</p>
]]></content>
  </entry>
  <entry>
    <title>前端防御性开发</title>
    <url>/2022/11/12/%E5%89%8D%E7%AB%AF%E9%98%B2%E5%BE%A1%E6%80%A7%E5%BC%80%E5%8F%91/</url>
    <content><![CDATA[<h2 id="1-前端防御性问题"><a href="#1-前端防御性问题" class="headerlink" title="1. 前端防御性问题"></a>1. 前端防御性问题</h2><p>在实现某种css效果时，往往我们能很快的完成css的编写，如文档溢出、垂直居中、各种布局等效果。但是当一个或一组元素具有动态，或者面对无法预测内容形式的时候，可能会出现样式不兼容，不适配导致塌陷，甚至异常。</p>
<h2 id="2-前端防御性实际情况"><a href="#2-前端防御性实际情况" class="headerlink" title="2. 前端防御性实际情况"></a>2. 前端防御性实际情况</h2><p>实际情况远比想象的复杂。以下列举了一些用户在使用链路上可能存在的“危机点”，这也是防御性开发中着重要考虑的“防御点”。归纳为两大类问题：</p>
<h3 id="1-UI的防御性"><a href="#1-UI的防御性" class="headerlink" title="1.UI的防御性"></a>1.UI的防御性</h3><ul>
<li>防白屏 – 白屏时间小于1秒（小于200ms最佳）</li>
<li>防布局错乱 – 布局被动态内容撑垮</li>
<li>防极端内容 – 缺失 &#x2F; 超长 &#x2F; 连续字符 &#x2F; 未转义</li>
<li>防慢 – 网络慢 &#x2F; 响应慢 &#x2F; 渲染慢 &#x2F; 执行慢</li>
<li>防卡 – 卡顿 &#x2F; 假死</li>
<li>防一致性问题 – 不一致的交互方式、图标、 标准组件等</li>
<li>防UI状态不全 – 五层UI状态栈（加载状态&#x2F;空状态&#x2F;部分缺失状态&#x2F;出错状态&#x2F;理想状态）</li>
<li>防样式污染 – 样式冲突，局部模块的样式影响全局</li>
<li>防Chartjunk – 可读性差的图表用法</li>
<li>防误操作 &#x2F; 危险操作 – 对不可逆的操作二次确认+强提示</li>
</ul>
<h3 id="2-代码的防御性"><a href="#2-代码的防御性" class="headerlink" title="2.代码的防御性"></a>2.代码的防御性</h3><ul>
<li>防报错 – 语法错误 &#x2F; 逻辑错误</li>
<li>防兼容性问题</li>
<li>防安全性问题</li>
<li>防意外输入和交互</li>
<li>防数据 – 防极端数据 &#x2F; 无效数据 &#x2F; 接囗变更</li>
<li>防代码坏味道 &#x2F; 防工程腐化 – 代码复杂度 &#x2F; 重复率 &#x2F; 反模式 &#x2F; 死代码等</li>
<li>防语法风格不一致</li>
<li>防代码冲突</li>
<li>防代码冗余</li>
</ul>
<h2 id="3-如果做防御性开发"><a href="#3-如果做防御性开发" class="headerlink" title="3. 如果做防御性开发"></a>3. 如果做防御性开发</h2><p>人是代码的创作者，提高代码防御性，写出高质量的代码，最终靠人。团队中的CR是从外部反馈来优化开发，而作为开发者，则更需要自己对自身的约束。<br>那应该从哪些方面去做防御性考虑呢？</p>
<h3 id="1-需求"><a href="#1-需求" class="headerlink" title="1. 需求"></a>1. 需求</h3><ul>
<li>功能实现问题</li>
<li>UI和交互问题</li>
</ul>
<h3 id="2-开发"><a href="#2-开发" class="headerlink" title="2. 开发"></a>2. 开发</h3><ul>
<li>JS防御性原则</li>
</ul>
<table>
<thead>
<tr>
<th>防御点</th>
<th>原则</th>
</tr>
</thead>
<tbody><tr>
<td>逻辑问题</td>
<td>1. 判断条件有误 &#x2F; 忽略了必要条件 <br> 2. 循环 &#x2F; 递归的退出条件<br> 3. 显隐逻辑和跳转逻辑控制<br> 4. 缺少校验或错判参数类型 &#x2F; 空值 &#x2F; 边界条件<br> 5. 缺少对默认值 &#x2F; 缺省状态的校验 &#x2F; 判断 &#x2F; 处理<br> 6. 接囗调用逻辑和组合关系<br> 7. 忽略一些组件之间的联动关系</td>
</tr>
<tr>
<td>全局副作用</td>
<td>1. 变更公共代码，对其他部分产生影响<br> 2. 变更配置文件 &#x2F; 全局变量<br> 3. 代码的冲突和污染<br> 4. 基础库版本升级</td>
</tr>
<tr>
<td>容错问题</td>
<td>1. 错误输入 &#x2F; 特殊字符 &#x2F; 数据类型的容错<br> 2. 接囗返回值的不确定性<br> 3. 接囗请求失败的容错<br> 4. 缺少error boundary，避免导致白屏<br> 5. 错误要上报</td>
</tr>
<tr>
<td>表单校验问题</td>
<td>前端校验条件不全</td>
</tr>
<tr>
<td>编译 &amp; 依赖问题</td>
<td>1. JS编译漏掉对一些语法的处理<br> 2. 本地和发布构建有差异<br> 3. 本地和线上依赖版本有差异</td>
</tr>
<tr>
<td>兼容性问题</td>
<td>1. Polyfill不全<br> 2. CSS兼容性问题</td>
</tr>
<tr>
<td>文案问题</td>
<td>1. 文案错误 &#x2F; 不准确 &#x2F; 折行<br> 2. 国际化不完整</td>
</tr>
</tbody></table>
<ul>
<li>CSS防御性原则</li>
</ul>
<table>
<thead>
<tr>
<th>防御点</th>
<th>原则</th>
</tr>
</thead>
<tbody><tr>
<td>避免用JavaScript控制布局</td>
<td>JavaScript实现的布局组件不要用。它会多出很多层没用的嵌套，同时把布局定义的很死，难以再用CSS控制。<br> 永远没有原生的流畅，同时增加代码的复杂，容易用问题。除非解决一些必要的兼容性问题。l</td>
</tr>
<tr>
<td>避免用float &#x2F; position: absolute &#x2F; display: table等过时的布局技术</td>
<td>优先用Flexbox&#x2F;Grids布局。你会说绝对定位还是有用的。你要强迫自己不用，经过反复尝试过发现绝对定位是最优的选择那就用。重要的是有这个“强迫自己”的过程。</td>
</tr>
<tr>
<td>避免定高&#x2F;定宽</td>
<td>固定宽&#x2F;高最容易出现的问题是内容溢出。没必要通过定宽高对齐，可以利用Flexbox的位伸&#x2F;收缩特性。一般情况下用最小宽&#x2F;高、calc()、相对单位替代。同上要“强迫自己”不用。</td>
</tr>
<tr>
<td>避免侵入性的写法</td>
<td>避免影响全局样式，如：* { … }、:root {…} 、div { ….}等。避免影响通用组件样式，如：.next-card {…}，如果要定制单加一个class名。不要直接修改全局CSS变量，把自己的CSS变量定义在模块的范围内。不要写z-index:999。一般1～9，防止被遮挡10～99，绝对够用了。不要在标签上定义style属性。不要在JS代码中做样式微调，这样今后无法统一升级CSS样式。只有完全不可修改的样式才能用!important，利用选择器优先级调整样式。</td>
</tr>
<tr>
<td>避免CSS代码的误改 &#x2F; 漏改</td>
<td>将选择器拆开写，如.card-a, .card-b { … }，写时方便，改时难，修改时容易影响其它元素，不如分开写（除非像css reset这种特别确定的情况）。将样式集中在一起，容易改错。保持CSS代码和文件在相应的层级上，同一模块的放一起。避免混入通用样式中，为了避免改错，允许适当冗余。用@media时，会集中覆写一批元素的样式，更新样式时非常容易遗漏。所以必须拆开写，和对应模块的样式放在一起。不要集中放在文件底部，或是集中放在某一个文件里。及时清除“死代码”。定义样式要写全，微调样式要写具体，如：.mod {<br> margin: 0;<br> }<br> &#x2F;* 其它地方需要微调时 *&#x2F;<br> .biz-card .mod {<br> margin-bottom: 16px;<br> }</td>
</tr>
<tr>
<td>避免CSS样式冲突</td>
<td>限定作用范围。如，.my-module .xxx { … }。业务代码中的样式要加前缀，或借鉴BEM命名方式。如：.overview-card-title { … }。用CSS Module也可以。注意选择器的精确性。级层过长过于复杂的CSS选择器会影响性能，但要注意：有时需要精确选择某些元素，如仅选择一级子元素，.overview-card-content &gt; .item { … }。</td>
</tr>
<tr>
<td>防止内容不对齐</td>
<td>应该说Flexbox侧重“对齐”，Grids是专为布局设计的。受字体、行高等因素影响（如图），用Flexbox实现对齐最可靠：<br> 1、height &#x2F; line-height 不可靠。<br> 2、display:inline-block &#x2F; vertical-align:middle不可靠。</td>
</tr>
<tr>
<td>防止内容溢出</td>
<td>包括文字 &#x2F; 图表等内容在宽度变化时或是英文版下容易出现溢出。<br> 1、图表要支持自动 resize。<br> 2、图片要限制大小范围，如：max-width、max-height min(100px, 100%)、max(100px, 100%)（注意：min() &#x2F; max() 兼容性：chrome 79+ &#x2F; safari 11 &#x2F; firefox 75）<br> 3、不要固定宽&#x2F;高。（见规则3）<br> 4、不要在容器元素定义overflow:hidden防止内容不可见。宁可难看关键信息也要显示全。<br> 5、用min-width:0防止Flexbox项被内容撑开。例如：html如下，.canvas的style是JS写死的，不可避免的溢出了（如图）。<br><code>&lt;div class=&quot;wrapper&quot;&gt;&lt;div class=&quot;item&quot;&gt; &lt;div class=&quot;canvas&quot; style=&quot;width:300px;height:200px;&quot;&gt;canvas&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;</code><br> 这种情况下.item可以定义为：<br>  display: flex;<br>  min-width: 0;</td>
</tr>
<tr>
<td>防止内容被遮挡</td>
<td>定义负值时（负margin &#x2F; top &#x2F; left），小心内容被遮挡，避免这么定义。定义margin统一朝一个方向，向下和向右定义，再重置一下:last-child。position: relative 平时很常用，发生遮挡时会造成链接无法点击。</td>
</tr>
<tr>
<td>防止可点击区域过小</td>
<td>小于32x32像素的可点击元素，通过下面的方式扩大可点击区域：<br> .btn-text {<br> position: relative;<br> }<br> &#x2F;&#x2F; 比 padding 副作用小 <br> .btn-text::before {<br> content: ‘’;<br> position: absolute;<br> top: -6px;<br> left: -8px;<br> right: -8px;<br> bottom: -6px;<br> }</td>
</tr>
<tr>
<td>防止内容显示不全 &#x2F; 被截断</td>
<td>在定义overflow:hidden时，就要考虑内容是否有被截断的可能。一般不要加在容器元素上。防止长文字被生生截断，加省略号。UI实现过程中要对内容做出判断，哪些是不应该折行的，哪些是不应该省略的，如：<br> white-space: nowrap;<br> overflow: hidden;<br> text-overflow: ellipsis;</td>
</tr>
<tr>
<td>防止图片变形</td>
<td>图片被置于特定比例的容器中时，固定宽&#x2F;高和约束最大宽&#x2F;高，都可能会导致图片变形。<br> .head img {<br> width: 100%;<br> height: 100%;<br> object-fit: cover;<br> }<br> 在Flexbox容器内，图片高度会被自动拉伸。因为不要定义align-items，默认是stretch。</td>
</tr>
<tr>
<td>防止图片加载失败</td>
<td>需要考虑图片加载慢或加载失败的情景。在图片的容器上加边或加底色。</td>
</tr>
<tr>
<td>Flexbox常见防御性写法</td>
<td>Flexbox的默认表现比较多，不能简单的定义display:flex，或是flex:1。<br> 1. Flexbox容器元素通常要做如下定义：要支持多行（默认是单行），交叉轴上垂直居中（默认是stretch），主轴上采用space-between，将自由空间分配到相邻元素之间。一般都要写上：<br> display: flex;<br> flex-wrap: wrap;<br> justify-content: space-between;<br> align-items: center;<br> 2. Flexbox的盒子元素要定义间距。</td>
</tr>
</tbody></table>
<h3 id="3-数据"><a href="#3-数据" class="headerlink" title="3. 数据"></a>3. 数据</h3><ul>
<li>请求失败问题</li>
<li>字段问题问题</li>
<li>状态不全问题</li>
</ul>
<h3 id="4-性能"><a href="#4-性能" class="headerlink" title="4. 性能"></a>4. 性能</h3><ul>
<li>显示性能</li>
<li>运行性能</li>
<li>交互性能</li>
</ul>
<h3 id="5-安全"><a href="#5-安全" class="headerlink" title="5. 安全"></a>5. 安全</h3>]]></content>
      <tags>
        <tag>安全, 防御, 前端</tag>
      </tags>
  </entry>
  <entry>
    <title>基础业务组件封装方法</title>
    <url>/2023/10/12/%E5%9F%BA%E7%A1%80%E4%B8%9A%E5%8A%A1%E7%BB%84%E4%BB%B6%E5%B0%81%E8%A3%85%E6%96%B9%E6%B3%95/</url>
    <content><![CDATA[<h2 id="0-起因"><a href="#0-起因" class="headerlink" title="0. 起因"></a>0. 起因</h2><p>最近工作中要对系统做整体重构,需要封装一些基础的组件,封装基础组件参照如下准则:</p>
<ol>
<li>组件基本样式统一,留有可修改空间;</li>
<li>把默认要的一些基本功能配置,直接写到基础组件配置中,避免重复配置;</li>
<li>具备和原本组件一致的接口定义;</li>
</ol>
<p>下面就通过封装 <code>ProTable</code> 表格基础组件的例子.</p>
<h2 id="1-分析业务的默认需求配置"><a href="#1-分析业务的默认需求配置" class="headerlink" title="1. 分析业务的默认需求配置"></a>1. 分析业务的默认需求配置</h2><ol>
<li>在业务中有很多默认的设置,比如单行文本过长折叠,页脚设置统一等;</li>
<li>通过封装使功能简单就可以调用,比如 设置表头的排序展示本地存储;</li>
<li>搜索展示多行的功能;</li>
</ol>
<p><img data-src="https://cdn.jsdelivr.net/gh/strawferry/GSS@master/uPic/%202024-02/27-10-18-0oNfH4-xpDHz0.png" alt="27-10-18-0oNfH4-xpDHz0"></p>
<h2 id="2-代码实现"><a href="#2-代码实现" class="headerlink" title="2. 代码实现"></a>2. 代码实现</h2><h3 id="2-1-单行文本过长折叠默认配置"><a href="#2-1-单行文本过长折叠默认配置" class="headerlink" title="2.1 单行文本过长折叠默认配置"></a>2.1 单行文本过长折叠默认配置</h3><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 1. 默认全部折叠,新增一个 excludeEllipsis 排除折叠的数组配置</span></span><br><span class="line"><span class="comment">/** ProTable 的类型定义 继承自 antd 的 Table */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">declare</span> <span class="keyword">type</span> <span class="title class_">CSProTableProps</span>&lt;<span class="title class_">DataSource</span>, U, <span class="title class_">ValueType</span> = <span class="string">&#x27;text&#x27;</span>&gt; = &#123;</span><br><span class="line">  excludeEllipsis?: <span class="built_in">string</span>[]; <span class="comment">// 不需要折叠的数组,默认所有的都折叠 option 不折叠</span></span><br><span class="line">&#125; &amp; <span class="title class_">ProTableProps</span>&lt;<span class="title class_">DataSource</span>, U, <span class="title class_">ValueType</span>&gt;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">/****** 2. 设置默认配置    *******/</span></span><br><span class="line">  <span class="keyword">const</span> newColumns = <span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> <span class="attr">nc</span>: <span class="built_in">any</span> = columns?.<span class="property">map</span>?.(<span class="function"><span class="params">it</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; dataIndex = <span class="string">&#x27;&#x27;</span>, valueType = <span class="string">&#x27;&#x27;</span> &#125;: <span class="built_in">any</span> = it</span><br><span class="line">        <span class="keyword">const</span> tempIt = &#123; ...it, <span class="attr">ellipsis</span>: <span class="literal">true</span> &#125;</span><br><span class="line">        <span class="keyword">if</span> (excludeEllipsis?.<span class="property">includes</span>?.(dataIndex)) &#123;</span><br><span class="line">          tempIt.<span class="property">ellipsis</span> = <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (it?.<span class="title function_">hasOwnProperty</span>(<span class="string">&#x27;ellipsis&#x27;</span>)) &#123;</span><br><span class="line">          tempIt.<span class="property">ellipsis</span> = it?.<span class="property">ellipsis</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> tempIt</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">return</span> nc</span><br><span class="line">    &#125;, [columns, excludeEllipsis])</span><br><span class="line"></span><br><span class="line">  <span class="comment">/****** 3. 传入到原有里面    *******/</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">getTableProps</span> = (<span class="params"></span>) =&gt; (&#123;</span><br><span class="line">    ...rest,</span><br><span class="line">    <span class="attr">columns</span>: newColumns,</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;<span class="title class_">ProTable</span>&lt;<span class="title class_">DataType</span>, <span class="title class_">Params</span>, <span class="title class_">ValueType</span>&gt;</span><br><span class="line">      &#123;...<span class="title function_">getTableProps</span>()&#125;</span><br><span class="line">    &gt;&#123;props?.<span class="property">children</span>&#125;&lt;/<span class="title class_">ProTable</span>&gt;</span><br><span class="line">  );</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="2-2-简单配置设置表头的排序展示本地存储"><a href="#2-2-简单配置设置表头的排序展示本地存储" class="headerlink" title="2.2 简单配置设置表头的排序展示本地存储"></a>2.2 简单配置设置表头的排序展示本地存储</h3><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1. 添加一个新传参字段 persistenceKey</span></span><br><span class="line"><span class="comment">/** ProTable 的类型定义 继承自 antd 的 Table */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">declare</span> <span class="keyword">type</span> <span class="title class_">CSProTableProps</span>&lt;<span class="title class_">DataSource</span>, U, <span class="title class_">ValueType</span> = <span class="string">&#x27;text&#x27;</span>&gt; = &#123;</span><br><span class="line">  persistenceKey?: <span class="built_in">string</span>; <span class="comment">// 表头的排序持久化 key,提出来传参,实现简单调用</span></span><br><span class="line">&#125; &amp; <span class="title class_">ProTableProps</span>&lt;<span class="title class_">DataSource</span>, U, <span class="title class_">ValueType</span>&gt;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/******** 2. 设置默认传参  *********/</span></span><br><span class="line">    <span class="keyword">const</span> newColumnsState = <span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="attr">ncs</span>: <span class="built_in">any</span> = &#123;</span><br><span class="line">          <span class="attr">persistenceType</span>: <span class="string">&#x27;localStorage&#x27;</span>,</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (persistenceKey &amp;&amp; !columnsState) &#123;</span><br><span class="line">          ncs.<span class="property">persistenceKey</span> = persistenceKey</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (columnsState) &#123;</span><br><span class="line">          ncs = &#123; ...ncs, columnsState &#125;</span><br><span class="line">          <span class="keyword">if</span> (!ncs?.<span class="property">persistenceKey</span> &amp;&amp; persistenceKey) &#123;</span><br><span class="line">            ncs.<span class="property">persistenceKey</span> = persistenceKey</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ncs</span><br><span class="line">      &#125;, [persistenceKey, columnsState])</span><br><span class="line"></span><br><span class="line">      <span class="comment">/****** 3. 传入到原有里面  *******/</span></span><br><span class="line">      <span class="keyword">const</span> <span class="title function_">getTableProps</span> = (<span class="params"></span>) =&gt; (&#123;</span><br><span class="line">    ...rest,</span><br><span class="line">    <span class="attr">columnsState</span>: newColumnsState,</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;<span class="title class_">ProTable</span>&lt;<span class="title class_">DataType</span>, <span class="title class_">Params</span>, <span class="title class_">ValueType</span>&gt;</span><br><span class="line">      &#123;...<span class="title function_">getTableProps</span>()&#125;</span><br><span class="line">    &gt;&#123;props?.<span class="property">children</span>&#125;&lt;/<span class="title class_">ProTable</span>&gt;</span><br><span class="line">  );</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="2-3-封装前后调用对比"><a href="#2-3-封装前后调用对比" class="headerlink" title="2.3 封装前后调用对比"></a>2.3 封装前后调用对比</h3><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">  <span class="keyword">const</span> columns = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&#x27;序号&#x27;</span>,</span><br><span class="line">    <span class="attr">valueType</span>: <span class="string">&#x27;index&#x27;</span>,</span><br><span class="line">    <span class="attr">width</span>: <span class="number">65</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">dataIndex</span>: <span class="string">&#x27;name&#x27;</span>,</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&#x27;用户名称&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">dataIndex</span>: <span class="string">&#x27;mobile&#x27;</span>,</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&#x27;联系电话&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">dataIndex</span>: <span class="string">&#x27;type&#x27;</span>,</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&#x27;好友类型&#x27;</span>,</span><br><span class="line">    <span class="attr">hideInSearch</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">valueEnum</span>: [],</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&#x27;操作&#x27;</span>,</span><br><span class="line">    <span class="attr">valueType</span>: <span class="string">&#x27;option&#x27;</span>,</span><br><span class="line">    <span class="attr">width</span>: <span class="number">180</span>,</span><br><span class="line">    <span class="attr">render</span>: <span class="function">(<span class="params">_, record</span>) =&gt;</span> [<span class="language-xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">key</span>=<span class="string">&quot;manage&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;&#125;&#125;&gt;管理<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span>]</span><br><span class="line">  &#125;,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">  &lt;<span class="title class_">ProTable</span></span><br><span class="line">    columns=&#123;columns&#125;</span><br><span class="line">    columnsState=&#123;&#123;</span><br><span class="line">      <span class="attr">persistenceType</span>: <span class="string">&#x27;localStorage&#x27;</span>,</span><br><span class="line">      <span class="attr">persistenceKey</span>: <span class="string">&#x27;persistenceKey&#x27;</span></span><br><span class="line">      &#125;&#125;</span><br><span class="line">    rowKey=<span class="string">&quot;id&quot;</span></span><br><span class="line">    scroll=&#123;&#123; <span class="attr">x</span>: <span class="number">800</span> &#125;&#125;</span><br><span class="line">    actionRef=&#123;actionRef&#125;</span><br><span class="line">    request=&#123;getContactListApi&#125;</span><br><span class="line">  /&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">CSProTable</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">persistenceKey</span>=<span class="string">&quot;persistenceKey&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">columns</span>=<span class="string">&#123;columns&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">rowKey</span>=<span class="string">&quot;id&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">scroll</span>=<span class="string">&#123;&#123;</span> <span class="attr">x:</span> <span class="attr">800</span> &#125;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">actionRef</span>=<span class="string">&#123;actionRef&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">request</span>=<span class="string">&#123;getContactListApi&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">  /&gt;</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>两者调用基本差不多,设置标题持久化 <code>CSProTable</code> 的配置会简单些,还有他会默认对单行文本过长折叠</p>
<h2 id="3-完整封装代码"><a href="#3-完整封装代码" class="headerlink" title="3. 完整封装代码"></a>3. 完整封装代码</h2><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * @Description:  CSProTable,对原有的做一些定制化的东西,方便调用</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">ParamsType</span>, <span class="title class_">ProTableProps</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@ant-design/pro-components&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ProTable</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@ant-design/pro-components&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Icon</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;antd&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; isBoolean &#125; <span class="keyword">from</span> <span class="string">&#x27;lodash&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; <span class="title class_">ReactNode</span>, useMemo &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** ProTable 的类型定义 继承自 antd 的 Table */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">declare</span> <span class="keyword">type</span> <span class="title class_">CSProTableProps</span>&lt;<span class="title class_">DataSource</span>, U, <span class="title class_">ValueType</span> = <span class="string">&#x27;text&#x27;</span>&gt; = &#123;</span><br><span class="line">  searchTitle?: <span class="built_in">string</span> | <span class="title class_">ReactNode</span>; <span class="comment">// 搜索标题</span></span><br><span class="line">  excludeEllipsis?: <span class="built_in">string</span>[]; <span class="comment">// 不需要折叠的数组,默认所有的都折叠 option 不折叠</span></span><br><span class="line">  persistenceKey?: <span class="built_in">string</span>; <span class="comment">// 表格列表持久化 key,提前出来传参</span></span><br><span class="line">&#125; &amp; <span class="title class_">ProTableProps</span>&lt;<span class="title class_">DataSource</span>, U, <span class="title class_">ValueType</span>&gt;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">CSProTable</span> = &lt;</span><br><span class="line">  <span class="title class_">DataType</span> <span class="keyword">extends</span> <span class="title class_">Record</span>&lt;<span class="built_in">string</span>, <span class="built_in">any</span>&gt;,</span><br><span class="line">  <span class="title class_">Params</span> <span class="keyword">extends</span> <span class="title class_">ParamsType</span> = <span class="title class_">ParamsType</span>,</span><br><span class="line">  <span class="title class_">ValueType</span> = <span class="string">&#x27;text&#x27;</span>,</span><br><span class="line">&gt;<span class="function">(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">  props: CSProTableProps&lt;DataType, Params, ValueType&gt;</span></span></span><br><span class="line"><span class="params"><span class="function"></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;</span><br><span class="line">    searchTitle,</span><br><span class="line">    excludeEllipsis = [],</span><br><span class="line">    columns = [],</span><br><span class="line">    pagination = &#123;&#125;,</span><br><span class="line">    search,</span><br><span class="line">    scroll = &#123;&#125;,</span><br><span class="line">    searchFormRender,</span><br><span class="line">    persistenceKey,</span><br><span class="line">    columnsState,</span><br><span class="line">    options,</span><br><span class="line">    cardBordered = <span class="literal">true</span>,</span><br><span class="line">    bordered = <span class="literal">true</span>,</span><br><span class="line">    ...rest &#125; = props</span><br><span class="line">  <span class="keyword">const</span> newColumns = <span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">nc</span>: <span class="built_in">any</span> = columns?.<span class="property">map</span>?.(<span class="function"><span class="params">it</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; dataIndex = <span class="string">&#x27;&#x27;</span>, valueType = <span class="string">&#x27;&#x27;</span> &#125;: <span class="built_in">any</span> = it</span><br><span class="line">      <span class="keyword">const</span> tempIt = &#123; ...it, <span class="attr">ellipsis</span>: <span class="literal">true</span> &#125;</span><br><span class="line">      <span class="keyword">if</span> (excludeEllipsis?.<span class="property">includes</span>?.(dataIndex)) &#123;</span><br><span class="line">        tempIt.<span class="property">ellipsis</span> = <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (it?.<span class="title function_">hasOwnProperty</span>(<span class="string">&#x27;ellipsis&#x27;</span>)) &#123;</span><br><span class="line">        tempIt.<span class="property">ellipsis</span> = it?.<span class="property">ellipsis</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (it?.<span class="title function_">hasOwnProperty</span>(<span class="string">&#x27;valueEnum&#x27;</span>) || valueType === <span class="string">&#x27;select&#x27;</span>) &#123;</span><br><span class="line">        tempIt.<span class="property">fieldProps</span> = &#123; <span class="attr">showSearch</span>: <span class="literal">true</span>, ...tempIt?.<span class="property">fieldProps</span> &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (dataIndex === <span class="string">&#x27;option&#x27;</span> || valueType === <span class="string">&#x27;option&#x27;</span>) &#123;</span><br><span class="line">        tempIt.<span class="property">fixed</span> = <span class="string">&#x27;right&#x27;</span></span><br><span class="line">        tempIt.<span class="property">hideInSetting</span> = <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (dataIndex === <span class="string">&#x27;index&#x27;</span> || valueType === <span class="string">&#x27;index&#x27;</span>) &#123;</span><br><span class="line">        tempIt.<span class="property">fixed</span> = <span class="string">&#x27;left&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (dataIndex === <span class="string">&#x27;indexBorder&#x27;</span> || valueType === <span class="string">&#x27;indexBorder&#x27;</span>) &#123;</span><br><span class="line">        tempIt.<span class="property">fixed</span> = <span class="string">&#x27;left&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> tempIt</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> nc</span><br><span class="line">  &#125;, [columns, excludeEllipsis])</span><br><span class="line">  <span class="keyword">const</span> newOptions = <span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> no = &#123;&#125;</span><br><span class="line">    <span class="keyword">if</span> (options) &#123;</span><br><span class="line">      no = options</span><br><span class="line">      <span class="keyword">if</span> (!options?.<span class="property">hasOwnProperty</span>?.(<span class="string">&#x27;reloadIcon&#x27;</span>)) &#123;</span><br><span class="line">        no = &#123; ...no, <span class="attr">reloadIcon</span>: <span class="language-xml"><span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&quot;icon-shuaxin&quot;</span> /&gt;</span></span> &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (!options?.<span class="property">hasOwnProperty</span>?.(<span class="string">&#x27;density&#x27;</span>)) &#123;</span><br><span class="line">        no = &#123; ...no, <span class="attr">density</span>: <span class="literal">false</span> &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (!options?.<span class="property">hasOwnProperty</span>?.(<span class="string">&#x27;setting&#x27;</span>)) &#123;</span><br><span class="line">        <span class="keyword">let</span> setting = options?.<span class="property">setting</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_">isBoolean</span>(setting)) &#123;</span><br><span class="line">          no = &#123; ...no, setting &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (!setting?.<span class="property">hasOwnProperty</span>?.(<span class="string">&#x27;settingIcon&#x27;</span>)) &#123;</span><br><span class="line">            setting = &#123; ...setting, <span class="attr">settingIcon</span>: <span class="language-xml"><span class="tag">&lt;<span class="name">CFIcon</span> <span class="attr">type</span>=<span class="string">&quot;icon-shezhi&quot;</span> /&gt;</span></span> &#125;</span><br><span class="line">          &#125;</span><br><span class="line">          no = &#123; ...no, setting &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">isBoolean</span>(options)) &#123;</span><br><span class="line">      no = options</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      no = &#123;</span><br><span class="line">        <span class="attr">setting</span>: &#123;</span><br><span class="line">          <span class="attr">draggable</span>: <span class="literal">true</span>,</span><br><span class="line">          <span class="attr">settingIcon</span>: <span class="language-xml"><span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&quot;icon-shezhi&quot;</span> /&gt;</span></span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">reloadIcon</span>: <span class="language-xml"><span class="tag">&lt;<span class="name">Icon</span> <span class="attr">type</span>=<span class="string">&quot;icon-shuaxin&quot;</span> /&gt;</span></span>,</span><br><span class="line">        <span class="attr">density</span>: <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> no</span><br><span class="line">  &#125;, [])</span><br><span class="line">  <span class="keyword">const</span> newPagination = <span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> np = &#123;&#125;</span><br><span class="line">    <span class="keyword">if</span> (pagination) &#123;</span><br><span class="line">      np = pagination</span><br><span class="line">      <span class="keyword">if</span> (!pagination?.<span class="property">hasOwnProperty</span>?.(<span class="string">&#x27;showSizeChanger&#x27;</span>)) &#123;</span><br><span class="line">        np = &#123; ...np, <span class="attr">showSizeChanger</span>: <span class="literal">true</span> &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (!pagination?.<span class="property">hasOwnProperty</span>?.(<span class="string">&#x27;showQuickJumper&#x27;</span>)) &#123;</span><br><span class="line">        np = &#123; ...np, <span class="attr">showQuickJumper</span>: <span class="literal">true</span> &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">isBoolean</span>(pagination)) &#123;</span><br><span class="line">      np = options</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      np = &#123;</span><br><span class="line">        <span class="attr">showSizeChanger</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">showQuickJumper</span>: <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> np</span><br><span class="line">  &#125;, [])</span><br><span class="line">  <span class="keyword">const</span> newColumnsState = <span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="attr">ncs</span>: <span class="built_in">any</span> = &#123;</span><br><span class="line">      <span class="attr">persistenceType</span>: <span class="string">&#x27;localStorage&#x27;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (persistenceKey &amp;&amp; !columnsState) &#123;</span><br><span class="line">      ncs.<span class="property">persistenceKey</span> = persistenceKey</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (columnsState) &#123;</span><br><span class="line">      ncs = &#123; ...ncs, columnsState &#125;</span><br><span class="line">      <span class="keyword">if</span> (!ncs?.<span class="property">persistenceKey</span> &amp;&amp; persistenceKey) &#123;</span><br><span class="line">        ncs.<span class="property">persistenceKey</span> = persistenceKey</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ncs</span><br><span class="line">  &#125;, [persistenceKey, columnsState])</span><br><span class="line">  <span class="keyword">const</span> newSearch = <span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="attr">ns</span>: <span class="built_in">any</span> = &#123;</span><br><span class="line">      <span class="attr">span</span>: &#123;</span><br><span class="line">        <span class="attr">xs</span>: <span class="number">24</span>,</span><br><span class="line">        <span class="attr">sm</span>: <span class="number">24</span>,</span><br><span class="line">        <span class="attr">md</span>: <span class="number">12</span>,</span><br><span class="line">        <span class="attr">lg</span>: <span class="number">8</span>,</span><br><span class="line">        <span class="attr">xl</span>: <span class="number">6</span>,</span><br><span class="line">        <span class="attr">xxl</span>: <span class="number">6</span>,</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">isBoolean</span>(search)) &#123;</span><br><span class="line">      ns = search</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      ns = &#123; ...ns, ...search &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ns</span><br><span class="line">  &#125;, [search])</span><br><span class="line">  <span class="keyword">const</span> newScroll = <span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">x</span>: <span class="number">1300</span>, ...scroll &#125;</span><br><span class="line">  &#125;, [scroll])</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">newSearchFormRender</span> = (<span class="params">props, defaultDom</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;searchTitle &amp;&amp; <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;searchTitle absolute text-base z-50 font-medium text-[#333]&#x27;</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">top:</span> &#x27;<span class="attr">40px</span>&#x27;, <span class="attr">left:</span> &#x27;<span class="attr">44px</span>&#x27; &#125;&#125;&gt;</span>&#123;searchTitle&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml">      &#123;defaultDom&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">getTableProps</span> = (<span class="params"></span>) =&gt; (&#123;</span><br><span class="line">    ...rest,</span><br><span class="line">    cardBordered,</span><br><span class="line">    bordered,</span><br><span class="line">    <span class="attr">columnsState</span>: newColumnsState,</span><br><span class="line">    <span class="attr">search</span>: newSearch,</span><br><span class="line">    <span class="attr">scroll</span>: newScroll,</span><br><span class="line">    <span class="attr">pagination</span>: newPagination,</span><br><span class="line">    <span class="attr">columns</span>: newColumns,</span><br><span class="line">    <span class="attr">options</span>: newOptions,</span><br><span class="line">    <span class="attr">searchFormRender</span>: searchFormRender ? searchFormRender : newSearchFormRender</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;<span class="title class_">ProTable</span>&lt;<span class="title class_">DataType</span>, <span class="title class_">Params</span>, <span class="title class_">ValueType</span>&gt;</span><br><span class="line">      &#123;...<span class="title function_">getTableProps</span>()&#125;</span><br><span class="line">    &gt;&#123;props?.<span class="property">children</span>&#125;&lt;/<span class="title class_">ProTable</span>&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123; <span class="title class_">CSProTable</span> &#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="4-参考引用"><a href="#4-参考引用" class="headerlink" title="4. 参考引用"></a>4. 参考引用</h2><p><span class="exturl" data-url="aHR0cHM6Ly9wcm8tY29tcG9uZW50cy5hbnRkaWdpdGFsLmRldi9jb21wb25lbnRzL3RhYmxlP2N1cnJlbnQ9MSZwYWdlU2l6ZT01I2NvbHVtbnMtJUU1JTg4JTk3JUU1JUFFJTlBJUU0JUI5JTg5">Pro-Components 组件 ProTable 文档<i class="fa fa-external-link-alt"></i></span></p>
]]></content>
  </entry>
  <entry>
    <title>命令式打开弹窗设计</title>
    <url>/2023/10/14/%E5%91%BD%E4%BB%A4%E5%BC%8F%E6%89%93%E5%BC%80%E5%BC%B9%E7%AA%97%E8%AE%BE%E8%AE%A1/</url>
    <content><![CDATA[<h2 id="0-痛点-为什么要使用命令式打开弹层"><a href="#0-痛点-为什么要使用命令式打开弹层" class="headerlink" title="0. 痛点-为什么要使用命令式打开弹层"></a>0. 痛点-为什么要使用命令式打开弹层</h2><p>Modal 模态对话框在中台业务中非常常见。声明式 Modal 是一种常见的定义方式，可以通过组件库内置的组件来实现。在声明式 Modal 中，需要手动控制 Modal 的打开状态，并将状态和 UI 绑定在一起。随着业务的增加，页面上可能会出现多个 Modal 和 Button，导致代码变得冗长且难以维护。为了解决这个问题，可以将 Modal 抽离到外部组件中，但这样会导致父组件的状态堆积。另一种解决方案是将 Modal 和 Button 直接耦合在一起，但这样无法单独复用 Modal。为了解耦 Modal，需要编写大量代码并且状态变得混乱。后续可能还会遇到无法在父组件中直接控制 Modal 的问题，可以通过将状态下沉到外部 Store 或者 Context 中来解决。</p>
<h2 id="2-代码实现"><a href="#2-代码实现" class="headerlink" title="2. 代码实现"></a>2. 代码实现</h2><h3 id="2-1-创建-layer-context-tsx"><a href="#2-1-创建-layer-context-tsx" class="headerlink" title="2.1 创建 layer-context.tsx"></a>2.1 创建 <code>layer-context.tsx</code></h3><figure class="highlight tsx"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Drawer</span>, <span class="title class_">Modal</span>, <span class="title class_">ModalProps</span>, <span class="title class_">DrawerProps</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;antd&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ModalForm</span>, <span class="title class_">DrawerForm</span>, <span class="title class_">ModalFormProps</span>, <span class="title class_">DrawerFormProps</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@ant-design/pro-components&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  <span class="title class_">Dispatch</span>,</span><br><span class="line">  <span class="title class_">ReactNode</span>,</span><br><span class="line">  <span class="title class_">SetStateAction</span>,</span><br><span class="line">  createContext,</span><br><span class="line">  useContext,</span><br><span class="line">  useId,</span><br><span class="line">  useMemo,</span><br><span class="line">  useRef,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">LayerInstance</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./layer&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">LayerContentProps</span> = &#123;</span><br><span class="line">  <span class="attr">close</span>: <span class="function">() =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">LayerProps</span> = &#123;</span><br><span class="line">  id?: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">content</span>: <span class="title class_">ReactNode</span> | (<span class="function">(<span class="params">props: LayerContentProps</span>) =&gt;</span> <span class="title class_">ReactNode</span>);</span><br><span class="line">  <span class="title class_">Component</span>: <span class="title class_">ReactNode</span> | (<span class="function">(<span class="params">props: LayerContentProps</span>) =&gt;</span> <span class="title class_">ReactNode</span>);</span><br><span class="line">&#125; &amp; <span class="title class_">Omit</span>&lt;<span class="title class_">ModalProps</span>, <span class="string">&#x27;open&#x27;</span> | <span class="string">&#x27;content&#x27;</span>&gt; &amp;</span><br><span class="line">  <span class="title class_">DrawerProps</span> &amp;</span><br><span class="line">  <span class="title class_">ModalFormProps</span> &amp;</span><br><span class="line">  <span class="title class_">DrawerFormProps</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">LayerStackContextValue</span> <span class="keyword">extends</span> <span class="title class_">LayerProps</span> &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="built_in">string</span>;</span><br><span class="line">  ins?: <span class="title class_">LayerInstance</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">LayerStackContext</span> = createContext&lt;<span class="title class_">LayerStackContextValue</span>[]&gt;([]);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">LayerActionContext</span> = createContext&lt;<span class="title class_">Dispatch</span>&lt;<span class="title class_">SetStateAction</span>&lt;<span class="title class_">LayerStackContextValue</span>[]&gt;&gt;&gt;(</span><br><span class="line">  <span class="function">() =&gt;</span> <span class="built_in">void</span> <span class="number">0</span>,</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">useLayerStack</span>: <span class="built_in">any</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> id = <span class="title function_">useId</span>();</span><br><span class="line">  <span class="keyword">const</span> currentCount = <span class="title function_">useRef</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> setLayerStack = <span class="title function_">useContext</span>(<span class="title class_">LayerActionContext</span>);</span><br><span class="line">  <span class="comment">// eslint-disable-next-line @typescript-eslint/no-unused-vars</span></span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="title function_">openModal</span>(<span class="params">props: LayerProps &amp; &#123; id?: <span class="built_in">string</span> &#125;</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> layerId = <span class="string">`<span class="subst">$&#123;id&#125;</span>-Modal-<span class="subst">$&#123;currentCount.current++&#125;</span>`</span>;</span><br><span class="line">        <span class="title function_">setLayerStack</span>(<span class="function">(<span class="params">p = []</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">const</span> layerProps = &#123;</span><br><span class="line">            ...props,</span><br><span class="line">            <span class="attr">id</span>: props?.<span class="property">id</span> ?? layerId,</span><br><span class="line">            <span class="title class_">Component</span>: <span class="title class_">Modal</span>,</span><br><span class="line">            <span class="attr">_layerName</span>:<span class="string">&#x27;modal&#x27;</span></span><br><span class="line">          &#125;;</span><br><span class="line">          <span class="keyword">const</span> pp = p?.<span class="title function_">concat</span>(layerProps);</span><br><span class="line">          <span class="keyword">return</span> pp;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">const</span> <span class="title function_">hide</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">          <span class="title function_">setLayerStack</span>(<span class="function">(<span class="params">p = []</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> p?.<span class="title function_">filter</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> item.<span class="property">id</span> !== layerId);</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">return</span> [layerId, hide];</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="title function_">openDrawer</span>(<span class="params">props: LayerProps &amp; &#123; id?: <span class="built_in">string</span> &#125;</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> layerId = <span class="string">`<span class="subst">$&#123;id&#125;</span>-Drawer-<span class="subst">$&#123;currentCount.current++&#125;</span>`</span>;</span><br><span class="line">        <span class="title function_">setLayerStack</span>(<span class="function">(<span class="params">p = []</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">const</span> layerProps = &#123;</span><br><span class="line">            ...props,</span><br><span class="line">            <span class="attr">id</span>: props?.<span class="property">id</span> ?? layerId,</span><br><span class="line">            <span class="title class_">Component</span>: <span class="title class_">Drawer</span>,</span><br><span class="line">            <span class="attr">_layerName</span>:<span class="string">&#x27;drawer&#x27;</span></span><br><span class="line">          &#125;;</span><br><span class="line">          <span class="keyword">const</span> pp = p?.<span class="title function_">concat</span>(layerProps);</span><br><span class="line">          <span class="keyword">return</span> pp;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">const</span> <span class="title function_">hide</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">          <span class="title function_">setLayerStack</span>(<span class="function">(<span class="params">p</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> p?.<span class="title function_">filter</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> item.<span class="property">id</span> !== layerId);</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">return</span> [layerId, hide];</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="title function_">openFormModal</span>(<span class="params">props: LayerProps &amp; &#123; id?: <span class="built_in">string</span> &#125;</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> layerId = <span class="string">`<span class="subst">$&#123;id&#125;</span>-ModalForm-<span class="subst">$&#123;currentCount.current++&#125;</span>`</span>;</span><br><span class="line">        <span class="title function_">setLayerStack</span>(<span class="function">(<span class="params">p = []</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">const</span> layerProps = &#123;</span><br><span class="line">            ...props,</span><br><span class="line">            <span class="attr">id</span>: props?.<span class="property">id</span> ?? layerId,</span><br><span class="line">            <span class="title class_">Component</span>: <span class="title class_">ModalForm</span>,</span><br><span class="line">            <span class="attr">_layerName</span>:<span class="string">&#x27;formModal&#x27;</span></span><br><span class="line">          &#125;;</span><br><span class="line">          <span class="keyword">const</span> pp = p?.<span class="title function_">concat</span>(layerProps);</span><br><span class="line">          <span class="keyword">return</span> pp;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">const</span> <span class="title function_">hide</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">          <span class="title function_">setLayerStack</span>(<span class="function">(<span class="params">p = []</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> p?.<span class="title function_">filter</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> item.<span class="property">id</span> !== layerId);</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">return</span> [layerId, hide];</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="title function_">openFormDrawer</span>(<span class="params">props: LayerProps &amp; &#123; id?: <span class="built_in">string</span> &#125;</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> layerId = <span class="string">`<span class="subst">$&#123;id&#125;</span>-DrawerForm-<span class="subst">$&#123;currentCount.current++&#125;</span>`</span>;</span><br><span class="line">        <span class="title function_">setLayerStack</span>(<span class="function">(<span class="params">p = []</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">const</span> layerProps = &#123;</span><br><span class="line">            ...props,</span><br><span class="line">            <span class="attr">id</span>: props?.<span class="property">id</span> ?? layerId,</span><br><span class="line">            <span class="title class_">Component</span>: <span class="title class_">DrawerForm</span>,</span><br><span class="line">            <span class="attr">_layerNameName</span>:<span class="string">&#x27;drawerForm&#x27;</span></span><br><span class="line">          &#125;;</span><br><span class="line">          <span class="keyword">const</span> pp = p?.<span class="title function_">concat</span>(layerProps);</span><br><span class="line">          <span class="keyword">return</span> pp;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">const</span> <span class="title function_">hide</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">          <span class="title function_">setLayerStack</span>(<span class="function">(<span class="params">p</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> p?.<span class="title function_">filter</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> item.<span class="property">id</span> !== layerId);</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">return</span> [layerId, hide];</span><br><span class="line">      &#125;,</span><br><span class="line"></span><br><span class="line">      <span class="title function_">closeByLayerId</span>(<span class="params">id: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">        <span class="title function_">setLayerStack</span>(<span class="function">(<span class="params">p</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">const</span> m = p.<span class="title function_">find</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> item.<span class="property">id</span> === id);</span><br><span class="line">          <span class="keyword">if</span> (m?.<span class="property">ins</span>) &#123;</span><br><span class="line">            m?.<span class="property">ins</span>?.<span class="property">close</span>?.();</span><br><span class="line">            <span class="keyword">return</span> p;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">return</span> p.<span class="title function_">filter</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> item.<span class="property">id</span> !== id);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="title function_">destroyAll</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title function_">setLayerStack</span>(<span class="function">(<span class="params">p</span>) =&gt;</span> &#123;</span><br><span class="line">          p.<span class="title function_">forEach</span>(<span class="function">(<span class="params">m</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (m?.<span class="property">ins</span>) &#123;</span><br><span class="line">              m?.<span class="property">ins</span>?.<span class="property">close</span>?.();</span><br><span class="line">              <span class="keyword">return</span> p;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;);</span><br><span class="line">          <span class="keyword">return</span> p;</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;, [id, setLayerStack]);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="2-2-创建-layer-stack-provider-tsx"><a href="#2-2-创建-layer-stack-provider-tsx" class="headerlink" title="2.2 创建 layer-stack-provider.tsx"></a>2.2 创建 <code>layer-stack-provider.tsx</code></h3><figure class="highlight tsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">FC</span>, <span class="title class_">PropsWithChildren</span>, useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">LayerActionContext</span>, <span class="title class_">LayerStackContext</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./layer-context&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">LayerStack</span> <span class="keyword">from</span> <span class="string">&#x27;./layer-stack&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">LayerStackProvider</span>: <span class="variable constant_">FC</span>&lt;<span class="title class_">PropsWithChildren</span>&gt; = <span class="function">(<span class="params">&#123; children &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [layerStack, setLayerStack] = <span class="title function_">useState</span>([] <span class="keyword">as</span> <span class="title class_">React</span>.<span class="property">ContextType</span>&lt;<span class="keyword">typeof</span> <span class="title class_">LayerStackContext</span>&gt;);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">LayerActionContext.Provider</span> <span class="attr">value</span>=<span class="string">&#123;setLayerStack&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;children&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">LayerStackContext.Provider</span> <span class="attr">value</span>=<span class="string">&#123;layerStack&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">LayerStack</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">LayerStackContext.Provider</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">LayerActionContext.Provider</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="2-3-创建-layer-stack-tsx"><a href="#2-3-创建-layer-stack-tsx" class="headerlink" title="2.3 创建 layer-stack.tsx"></a>2.3 创建 <code>layer-stack.tsx</code></h3><figure class="highlight tsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">FC</span>, <span class="title class_">PropsWithChildren</span>, useContext &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">LayerStackContext</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./layer-context&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Layer</span> <span class="keyword">from</span> <span class="string">&#x27;./layer&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">LayerStack</span>: <span class="variable constant_">FC</span>&lt;<span class="title class_">PropsWithChildren</span>&gt; = <span class="function">(<span class="params">&#123;&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> layerStack = <span class="title function_">useContext</span>(<span class="title class_">LayerStackContext</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;layerStack?.map?.((item, index) =&gt; &#123;</span></span><br><span class="line"><span class="language-xml">        return <span class="tag">&lt;<span class="name">Layer</span> <span class="attr">key</span>=<span class="string">&#123;item?.id&#125;</span> <span class="attr">item</span>=<span class="string">&#123;item&#125;</span> <span class="attr">index</span>=<span class="string">&#123;index&#125;</span> /&gt;</span>;</span></span><br><span class="line"><span class="language-xml">      &#125;)&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">LayerStack</span>;</span><br></pre></td></tr></table></figure>

<h3 id="2-4-创建-layer-tsx"><a href="#2-4-创建-layer-tsx" class="headerlink" title="2.4 创建 layer.tsx"></a>2.4 创建 <code>layer.tsx</code></h3><figure class="highlight tsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  memo,</span><br><span class="line">  useContext,</span><br><span class="line">  useCallback,</span><br><span class="line">  useRef,</span><br><span class="line">  useState,</span><br><span class="line">  useEffect,</span><br><span class="line">  createElement,</span><br><span class="line">  <span class="title class_">MouseEvent</span>,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">LayerActionContext</span>, <span class="title class_">LayerProps</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./layer-context&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ProFormInstance</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@ant-design/pro-components&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">LayerInstance</span> = &#123;</span><br><span class="line">  <span class="attr">close</span>: <span class="function">() =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Layer</span> = memo&lt;&#123;</span><br><span class="line">  <span class="attr">item</span>: <span class="title class_">LayerProps</span> &amp; &#123; <span class="attr">id</span>: <span class="built_in">string</span>; <span class="attr">onOk</span>: <span class="function">(<span class="params">e: <span class="built_in">any</span>, close: <span class="built_in">any</span></span>) =&gt;</span> <span class="built_in">void</span> &#125;;</span><br><span class="line">  <span class="attr">index</span>: <span class="built_in">number</span>;</span><br><span class="line">&#125;&gt;(<span class="function">(<span class="params">&#123; item, index &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> setLayerStack = <span class="title function_">useContext</span>(<span class="title class_">LayerActionContext</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> close = <span class="title function_">useCallback</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">setLayerStack</span>(<span class="function">(<span class="params">p</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> p?.<span class="title function_">filter</span>(<span class="function">(<span class="params">layer</span>) =&gt;</span> layer?.<span class="property">id</span> !== item.<span class="property">id</span>);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;, <span class="number">500</span>);</span><br><span class="line">  &#125;, [item.<span class="property">id</span>]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> &#123; content, title, centered = <span class="literal">true</span>, <span class="title class_">Component</span>, onOk, modalProps, footer, _layerName, ...rest &#125; = item;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> [open, setOpen] = <span class="title function_">useState</span>(<span class="literal">false</span>);</span><br><span class="line">  <span class="keyword">const</span> formRef = useRef&lt;<span class="title class_">ProFormInstance</span>&gt;();</span><br><span class="line">  <span class="keyword">const</span> dataRef = useRef&lt;<span class="built_in">any</span>&gt;();</span><br><span class="line">  <span class="keyword">const</span> instanceRef = useRef&lt;<span class="title class_">LayerInstance</span>&gt;(&#123;</span><br><span class="line">    <span class="attr">close</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">setOpen</span>(<span class="literal">false</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">setOpen</span>(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_">setLayerStack</span>(<span class="function">(<span class="params">p</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> newStack = [...p];</span><br><span class="line">      newStack[index].<span class="property">ins</span> = instanceRef.<span class="property">current</span>;</span><br><span class="line">      <span class="keyword">return</span> newStack;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;, []);</span><br><span class="line">  <span class="keyword">const</span> handleClose = <span class="title function_">useCallback</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">setOpen</span>(<span class="literal">false</span>);</span><br><span class="line">  &#125;, []);</span><br><span class="line">  <span class="keyword">const</span> afterClose = <span class="title function_">useCallback</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    item?.<span class="property">afterClose</span>?.();</span><br><span class="line">    <span class="title function_">close</span>();</span><br><span class="line">  &#125;, []);</span><br><span class="line">  <span class="keyword">const</span> onCancel = <span class="title function_">useCallback</span>(<span class="function">(<span class="params">e: MouseEvent&lt;HTMLButtonElement, globalThis.MouseEvent&gt;</span>) =&gt;</span> &#123;</span><br><span class="line">    item?.<span class="property">onCancel</span>?.(e);</span><br><span class="line">    <span class="title function_">handleClose</span>();</span><br><span class="line">  &#125;, []);</span><br><span class="line">  <span class="keyword">const</span> afterOpenChange = <span class="title function_">useCallback</span>(<span class="function">(<span class="params">open: <span class="built_in">boolean</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!open) &#123;</span><br><span class="line">      item?.<span class="property">afterClose</span>?.();</span><br><span class="line">      <span class="title function_">handleClose</span>();</span><br><span class="line">      <span class="title function_">close</span>();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, []);</span><br><span class="line">  <span class="keyword">const</span> handleOnOk = <span class="title function_">useCallback</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> data = dataRef.<span class="property">current</span>;</span><br><span class="line">    onOk?.(data, handleClose);</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> handleFooter = footer;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> handleFooter === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">    <span class="comment">// @ts-ignore</span></span><br><span class="line">    handleFooter = handleFooter.<span class="title function_">bind</span>(<span class="literal">null</span>, handleClose);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> layerSelfProps = &#123;&#125;</span><br><span class="line">  <span class="keyword">if</span>(_layerName === <span class="string">&#x27;modal&#x27;</span> || _layerName === <span class="string">&#x27;drawer&#x27;</span>) &#123;</span><br><span class="line">    layerSelfProps =&#123;</span><br><span class="line">      centered,</span><br><span class="line">      afterClose,</span><br><span class="line">      afterOpenChange,</span><br><span class="line">      <span class="attr">onOk</span>: handleOnOk,</span><br><span class="line">      onCancel,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Component</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">open</span>=<span class="string">&#123;open&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      &#123;<span class="attr">...layerSelfProps</span>&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">formRef</span>=<span class="string">&#123;formRef&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">onClose</span>=<span class="string">&#123;onCancel&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">onOpenChange</span>=<span class="string">&#123;afterOpenChange&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">title</span>=<span class="string">&#123;title&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">modalProps</span>=<span class="string">&#123;&#123;</span> <span class="attr">centered</span>, <span class="attr">...modalProps</span> &#125;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">footer</span>=<span class="string">&#123;handleFooter&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      &#123;<span class="attr">...rest</span>&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    &gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;createElement(content, &#123;</span></span><br><span class="line"><span class="language-xml">        close: handleClose,</span></span><br><span class="line"><span class="language-xml">        formRef: formRef,</span></span><br><span class="line"><span class="language-xml">        dataRef: dataRef,</span></span><br><span class="line"><span class="language-xml">      &#125;)&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Component</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Layer</span>;</span><br></pre></td></tr></table></figure>

<h3 id="2-5-创建导出-index-tsx"><a href="#2-5-创建导出-index-tsx" class="headerlink" title="2.5 创建导出 index.tsx"></a>2.5 创建导出 <code>index.tsx</code></h3><figure class="highlight tsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Layer</span> <span class="keyword">from</span> <span class="string">&#x27;./layer&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">LayerStack</span> <span class="keyword">from</span> <span class="string">&#x27;./layer-stack&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">LayerStackProvider</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./layer-stack-provider&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&#x27;./layer-context&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> &#123; <span class="title class_">Layer</span>, <span class="title class_">LayerStack</span>, <span class="title class_">LayerStackProvider</span> &#125;;</span><br></pre></td></tr></table></figure>

<h3 id="3-如何使用"><a href="#3-如何使用" class="headerlink" title="3. 如何使用"></a>3. 如何使用</h3><ol>
<li>在根节点引入</li>
</ol>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Button</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;antd&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">LayerStackProvider</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@/components/Layer&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">AppFC</span>: <span class="title class_">React</span>.<span class="property">FC</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">LayerStackProvider</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;children&#125;<span class="tag">&lt;<span class="name">div</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">LayerStackProvider</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  );</span></span><br><span class="line"><span class="language-xml">&#125;;</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">export default TestFC;</span></span><br><span class="line"><span class="language-xml"></span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在其他地方使用消费</li>
</ol>
<figure class="highlight tsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Button</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;antd&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useLayerStack &#125; <span class="keyword">from</span> <span class="string">&#x27;@/components/Layer&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">TestFC</span>: <span class="title class_">React</span>.<span class="property">FC</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> &#123; openDrawer, openModal, destroyAll, openFormDrawer, openFormModal &#125; = <span class="title function_">useLayerStack</span>();</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">openM</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="title function_">openModal</span>(&#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;openModal&#x27;</span>,</span><br><span class="line">      <span class="attr">content</span>: <span class="function">(<span class="params">&#123; close &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">          <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">div</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">className</span>=<span class="string">&quot;&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">                close();</span></span><br><span class="line"><span class="language-xml">              &#125;&#125;</span></span><br><span class="line"><span class="language-xml">            &gt;</span></span><br><span class="line"><span class="language-xml">              关闭</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">                openD();</span></span><br><span class="line"><span class="language-xml">              &#125;&#125; &gt;再开一个<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">div</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">className</span>=<span class="string">&quot;&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">                destroyAll();</span></span><br><span class="line"><span class="language-xml">              &#125;&#125;</span></span><br><span class="line"><span class="language-xml">            &gt;关闭所有<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        );</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">openFM</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="title function_">openFormModal</span>(&#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;openFormModal&#x27;</span>,</span><br><span class="line">      <span class="attr">content</span>: <span class="function">(<span class="params">&#123; close, formRef &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">          <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">ProFormText</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">width</span>=<span class="string">&quot;md&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">name</span>=<span class="string">&quot;name&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">label</span>=<span class="string">&quot;签约客户名称&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">tooltip</span>=<span class="string">&quot;最长为 24 位&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">placeholder</span>=<span class="string">&quot;请输入名称&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">rules</span>=<span class="string">&#123;[&#123;</span> <span class="attr">required:</span> <span class="attr">true</span> &#125;]&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            /&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">ProFormText</span> <span class="attr">width</span>=<span class="string">&quot;md&quot;</span> <span class="attr">name</span>=<span class="string">&quot;company&quot;</span> <span class="attr">label</span>=<span class="string">&quot;我方公司名称&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入名称&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">                console.log(&#x27;清楚签约客户名称&#x27;, formRef);</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">                formRef?.current?.setFieldsValue?.(&#123; name: &#x27;&#x27; &#125;);</span></span><br><span class="line"><span class="language-xml">              &#125;&#125;</span></span><br><span class="line"><span class="language-xml">            &gt;</span></span><br><span class="line"><span class="language-xml">              清楚签约客户名称</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        );</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">onFinish</span>: <span class="keyword">async</span> (values) =&gt; &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(values);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">openFD</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> [layerId, hide] = <span class="keyword">await</span> <span class="title function_">openFormDrawer</span>(&#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;openFormDrawer&#x27;</span>,</span><br><span class="line">      <span class="attr">content</span>: <span class="function">(<span class="params">&#123; close, formRef &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">          <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">ProFormText</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">width</span>=<span class="string">&quot;md&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">name</span>=<span class="string">&quot;name&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">label</span>=<span class="string">&quot;签约客户名称&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">tooltip</span>=<span class="string">&quot;最长为 24 位&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">placeholder</span>=<span class="string">&quot;请输入名称&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">rules</span>=<span class="string">&#123;[&#123;</span> <span class="attr">required:</span> <span class="attr">true</span> &#125;]&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            /&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">ProFormText</span> <span class="attr">width</span>=<span class="string">&quot;md&quot;</span> <span class="attr">name</span>=<span class="string">&quot;company&quot;</span> <span class="attr">label</span>=<span class="string">&quot;我方公司名称&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入名称&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">                console.log(&#x27;清楚签约客户名称&#x27;, formRef);</span></span><br><span class="line"><span class="language-xml">                formRef?.current?.setFieldsValue?.(&#123; name: &#x27;&#x27; &#125;);</span></span><br><span class="line"><span class="language-xml">              &#125;&#125;</span></span><br><span class="line"><span class="language-xml">            &gt;</span></span><br><span class="line"><span class="language-xml">              清楚签约客户名称</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        );</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">onFinish</span>: <span class="keyword">async</span> (values) =&gt; &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(values);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">openD</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="title function_">openDrawer</span>(&#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;openDrawer&#x27;</span>,</span><br><span class="line">      <span class="attr">content</span>: <span class="function">(<span class="params">&#123; close &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">          <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">div</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">className</span>=<span class="string">&quot;&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">                close();</span></span><br><span class="line"><span class="language-xml">              &#125;&#125;</span></span><br><span class="line"><span class="language-xml">            &gt;</span></span><br><span class="line"><span class="language-xml">              关闭</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">                openD();</span></span><br><span class="line"><span class="language-xml">              &#125;&#125; &gt;再开一个<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">div</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">className</span>=<span class="string">&quot;&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">                destroyAll();</span></span><br><span class="line"><span class="language-xml">              &#125;&#125;</span></span><br><span class="line"><span class="language-xml">            &gt;关闭所有<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        );</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.container&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">key</span>=<span class="string">&quot;new&quot;</span> <span class="attr">size</span>=<span class="string">&quot;small&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;openM&#125;</span>&gt;</span>打开 Modal<span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">key</span>=<span class="string">&quot;new&quot;</span> <span class="attr">size</span>=<span class="string">&quot;small&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;openD&#125;</span>&gt;</span>打开 Drawer<span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">key</span>=<span class="string">&quot;new&quot;</span> <span class="attr">size</span>=<span class="string">&quot;small&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;openFM&#125;</span>&gt;</span>打开 FormModal<span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">key</span>=<span class="string">&quot;new&quot;</span> <span class="attr">size</span>=<span class="string">&quot;small&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;openFD&#125;</span>&gt;</span>打开 FormDrawer<span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">TestFC</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="4-参考引用"><a href="#4-参考引用" class="headerlink" title="4. 参考引用"></a>4. 参考引用</h2><p><span class="exturl" data-url="aHR0cHM6Ly9pbm5laS5pbi9wb3N0cy9wcm9ncmFtbWluZy93aHktaS1wcmVmZXItaW1wZXJhdGl2ZS1tb2RhbA==">为什么我更推荐命令式 Modal<i class="fa fa-external-link-alt"></i></span></p>
]]></content>
  </entry>
  <entry>
    <title>如何微调和修改前端依赖包</title>
    <url>/2024/02/19/%E5%A6%82%E4%BD%95%E5%BE%AE%E8%B0%83%E5%92%8C%E4%BF%AE%E6%94%B9%E5%89%8D%E7%AB%AF%E4%BE%9D%E8%B5%96%E5%8C%85/</url>
    <content><![CDATA[<h2 id="0-起因"><a href="#0-起因" class="headerlink" title="0. 起因"></a>0. 起因</h2><p>最近工作中要对系统做整体重构,在重构过程中发现有些依赖功能不足,我们需要对其做适当修改,目前实践了 2 种方式作为依赖微调如下:</p>
<ol>
<li>通过脚本在 <code>postinstall</code> 阶段去替换现有的文件,或者替换字符串;</li>
<li>通过 <code>patch-package</code> 直接在 <code>node_modules</code> 修改文件,然后 <code>patch-package</code> 生成 patch 文件,在 <code>postinstall</code> 阶段,再 <code>patch</code> 回去;</li>
<li>通过 <code>webpack</code> 打包工具中的 <code>alias</code> 把原本依赖替换成新的依赖包;</li>
</ol>
<h2 id="1-脚本替换处理"><a href="#1-脚本替换处理" class="headerlink" title="1. 脚本替换处理"></a>1. 脚本替换处理</h2><p>脚本替换处理是比较粗糙的替换手段</p>
<h3 id="1-1-替换脚本编写-replace-sh"><a href="#1-1-替换脚本编写-replace-sh" class="headerlink" title="1.1 替换脚本编写 replace.sh"></a>1.1 替换脚本编写 <code>replace.sh</code></h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">folder=&quot;node_modules/some-package&quot;</span><br><span class="line">for file in $(find $folder -name &quot;*.js&quot;)</span><br><span class="line">do</span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">Replace string</span></span><br><span class="line">  sed -i &#x27;s/要被替换的文本/被替换的文本/g&#x27; $file</span><br><span class="line">  </span><br><span class="line">  echo &quot;Replaced in $file&quot;</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<h3 id="1-2-配置-package-json"><a href="#1-2-配置-package-json" class="headerlink" title="1.2 配置 package.json"></a>1.2 配置 <code>package.json</code></h3><p>在 <code>package.json</code> 的 <code>scripts</code> 中增加一个 <code>postinstall</code>, 这样在项目安装依赖完成后会执行这个脚本</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="string">&quot;echo start&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;postinstall&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sh replace.sh&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="2-使用-patch-package-更改"><a href="#2-使用-patch-package-更改" class="headerlink" title="2. 使用 patch-package 更改"></a>2. 使用 <code>patch-package</code> 更改</h2><h3 id="2-1-安装-patch-package-依赖"><a href="#2-1-安装-patch-package-依赖" class="headerlink" title="2.1 安装 patch-package 依赖"></a>2.1 安装 <code>patch-package</code> 依赖</h3><p><code>npm i patch-package --save-dev</code></p>
<h3 id="2-2-修改依赖文件-并生成-patch-文件"><a href="#2-2-修改依赖文件-并生成-patch-文件" class="headerlink" title="2.2 修改依赖文件,并生成 patch 文件"></a>2.2 修改依赖文件,并生成 <code>patch</code> 文件</h3><ol>
<li>修改我们要更改的依赖包如 <code>react-native-camera</code> 中的文件并报存;</li>
<li>执行 <code>npx patch-package react-native-camera</code> 生成 <code>patch</code> 文件</li>
</ol>
<p><img data-src="https://cdn.jsdelivr.net/gh/strawferry/GSS@master/uPic/%202024-02/27-14-20-HfgZyq-M3VfIh.png" alt="27-14-20-HfgZyq-M3VfIh"></p>
<h3 id="2-3-配置-package-json"><a href="#2-3-配置-package-json" class="headerlink" title="2.3 配置 package.json"></a>2.3 配置 <code>package.json</code></h3><p>在 <code>package.json</code> 的 <code>scripts</code> 中增加一个 <code>postinstall</code>, 这样在项目安装依赖完成后会执行这个脚本</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="string">&quot;echo start&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;postinstall&quot;</span><span class="punctuation">:</span> <span class="string">&quot;patch-package&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="3-使用-alias-替换依赖"><a href="#3-使用-alias-替换依赖" class="headerlink" title="3. 使用 alias 替换依赖"></a>3. 使用 <code>alias</code> 替换依赖</h2><p>使用 <code>alias</code> 替换依赖比较适合被更改的依赖比较底层,还有更改内容较多,还会编译出文件,这里介绍 <code>antd</code> 中依赖的基础组件 <code>rc-dialog</code> 的替换</p>
<h3 id="3-1-首先在-github-先-fork-下来-dialog-的代码"><a href="#3-1-首先在-github-先-fork-下来-dialog-的代码" class="headerlink" title="3.1 首先在 github 先 fork 下来 dialog 的代码"></a>3.1 首先在 <code>github</code> 先 <code>fork</code> 下来 <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3JlYWN0LWNvbXBvbmVudC9kaWFsb2c=">dialog<i class="fa fa-external-link-alt"></i></span> 的代码</h3><p><img data-src="https://cdn.jsdelivr.net/gh/strawferry/GSS@master/uPic/%202024-02/27-14-30-b2xRIT-7YlbmR.png" alt="27-14-30-b2xRIT-7YlbmR"></p>
<h3 id="3-2-拉取-fork-的仓库代码-并把自己需要的功能加上-更改-package-json-中的包名"><a href="#3-2-拉取-fork-的仓库代码-并把自己需要的功能加上-更改-package-json-中的包名" class="headerlink" title="3.2 拉取 fork 的仓库代码,并把自己需要的功能加上,更改 package.json 中的包名"></a>3.2 拉取 <code>fork</code> 的仓库代码,并把自己需要的功能加上,更改 <code>package.json</code> 中的包名</h3><p><img data-src="https://cdn.jsdelivr.net/gh/strawferry/GSS@master/uPic/%202024-02/27-14-34-kVvJHR-P8Tybe.png" alt="27-14-34-kVvJHR-P8Tybe"></p>
<h3 id="3-3-更改完成后-把这个包构建并发布到-npm上"><a href="#3-3-更改完成后-把这个包构建并发布到-npm上" class="headerlink" title="3.3 更改完成后,把这个包构建并发布到 npm上"></a>3.3 更改完成后,把这个包构建并发布到 <code>npm</code>上</h3><p>文件目录下执行 <code>npm publish</code> 发布版本到 <code>npm</code> 上</p>
<h3 id="3-4-在要替换的项目中安装修改的这个依赖"><a href="#3-4-在要替换的项目中安装修改的这个依赖" class="headerlink" title="3.4 在要替换的项目中安装修改的这个依赖"></a>3.4 在要替换的项目中安装修改的这个依赖</h3><p>在项目中安装依赖 <code>npm install rc-cfhy-draggable-dialog</code></p>
<h3 id="3-5-在-webpack-中配置-alias-项"><a href="#3-5-在-webpack-中配置-alias-项" class="headerlink" title="3.5 在 webpack 中配置 alias 项"></a>3.5 在 <code>webpack</code> 中配置 <code>alias</code> 项</h3><p>通过下面的配置,这样项目中使用到 <code>rc-dialog</code> 的都会改为新的依赖 <code>rc-cfhy-draggable-dialog</code>,这样就满足了需求</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="attr">alias</span>: &#123;</span><br><span class="line">    <span class="string">&#x27;@&#x27;</span>: <span class="string">&#x27;/src&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;rc-dialog&#x27;</span>: <span class="string">&#x27;rc-cfhy-draggable-dialog&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="4-参考引用"><a href="#4-参考引用" class="headerlink" title="4. 参考引用"></a>4. 参考引用</h2><p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2RzMzAwL3BhdGNoLXBhY2thZ2U=">patch-package<i class="fa fa-external-link-alt"></i></span><br><span class="exturl" data-url="aHR0cHM6Ly9jbG91ZC50ZW5jZW50LmNvbS9kZXZlbG9wZXIvYXJ0aWNsZS8xNjA3NjAz">Webpack 技巧 - 联合 alias 和 mainFields 提高多库联调效率<i class="fa fa-external-link-alt"></i></span></p>
]]></content>
  </entry>
  <entry>
    <title>小型失物招领 App 客户端(ReactNative)</title>
    <url>/2018/02/24/%E5%B0%8F%E5%9E%8B%E5%A4%B1%E7%89%A9%E6%8B%9B%E9%A2%86%20App%20%E5%AE%A2%E6%88%B7%E7%AB%AF(ReactNative)/</url>
    <content><![CDATA[<h1 id="小型失物招领-App-客户端-iOS-安卓"><a href="#小型失物招领-App-客户端-iOS-安卓" class="headerlink" title="小型失物招领 App 客户端(iOS &amp;&amp; 安卓)"></a>小型失物招领 App 客户端(iOS &amp;&amp; 安卓)</h1><h2 id="项目说明"><a href="#项目说明" class="headerlink" title="项目说明"></a>项目说明</h2><p>本身是搞 iOS 的后面入了 ReactNative 的坑,慢慢的就比较多的接触 JavaScript ,还有就是 JavaScript 慢慢的可以做的东西越来越多;<br>不仅可以做前端网页,还可以做移动端 App(ReactNative),还能做后端(Node.js),还有其他的;</p>
<p>这个 App 是为了搭配<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3N0cmF3ZmVycnkvbG9zdHNlcnZlcg==">小型失物招领后端<i class="fa fa-external-link-alt"></i></span>所做的,同时也使用了 <code>redux</code> <code>react-navigation</code> 等的做数据管理以及路由切换;</p>
<p>目前主要的 Feature:  </p>
<ol>
<li>用户登录注册;</li>
<li>基本的管理员权限管理;</li>
<li>失物招领信息发布,关注收藏,通知审核等;</li>
<li>管理员的基本功能的管理与审核;</li>
<li>极光推送对接,使内容实时推送给用户;</li>
</ol>
<h2 id="本地运行条件"><a href="#本地运行条件" class="headerlink" title="本地运行条件"></a>本地运行条件</h2><ul>
<li>需要相应后端服务开启,本地 server 服务或者线上 server,下面会有相应的配置说明;</li>
</ul>
<h2 id="下载体验"><a href="#下载体验" class="headerlink" title="下载体验"></a>下载体验</h2><p>iOS 没有发布,下载安卓体验</p>
<p><span class="exturl" data-url="aHR0cHM6Ly9maXIuaW0vY3B0MQ==">安卓 fir.im 下载<i class="fa fa-external-link-alt"></i></span></p>
<p>或者直接扫码下载</p>
<blockquote>
<p><img data-src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAYAAACtWK6eAAANMUlEQVR4Xu2dbXIbOQxEk5ulcgLvSTc3S1Uu4C1lK4qlGX7gDUCN5Je/Akiw0Q2AlO18/fb9+/uXJ/73748fKPp/3t52/bLXu2yyes3W2RBQRfHTWFb7fVUgt5CvJnMv4T2i9+JUIHkyUiB3WCqQLbkqMMmjcO1KCkSBDBmmQIYQndcgO3nZ63kHOS93ZiKzg9hBhjypKBrDTU9i0BQIBaXiXBWXVXI+evmtuFCvXpPkleaN7HXEpxenAgkgq0ACYH358kWBxPDC1hRo6tcKVIHEUpiNf2z3eWs7yA5Wjlh5z7mkoBD85ykfs1QgCmSKMdmktYNMwX7ciAJN/UhF7J1y9YW6YhQkWczGn8Qw42MHsYPM8AT/zBgpKNndauqADaN0gdAKVVFlK6rzEbD3fFeTIbty0/Uq/GhuKE/QM68CiaVJgcQeBM7ELwUS4zqyViAKBBHnoxNtgdTvcMCBBRSIAgnQZd+UEp36HQ44sIACUSABuiiQw2ANFqCX4+zXKBqHd5Dgs+uZgCbktoPYQQhvbnzoqETJl12lzhLH4UQEF6jIW3ZuLkeicb70K1Yv19lJUCBbtM/U+RVIsPIpkCBgDXNKPOpHo6b72UEo4nd+dhA7yBWB7Op7ZEY8CzHPEkeS3qeXoZWZ+k0HFihgn/ZnsbyDUDrN+1GiU7/5yG4t6X6OWBTxQIVaKdSk40wvQ4lH/aYDC+Tn03YQ+opCk0D8KsbVXhx0FMw+mwIJIkoBq/ALhn7IXIHELvcUbMqTlx6x7CBbOtlBYoJUILQkJfnZQWKEpbDbQXaQs4PYQf4goEAUyFRxdcSKdSxHrCla1Rk5YsUISzOxtIPQIKkfHZUI+SiQz+JHckC7Ds0bifGIT/r3IEeCIb4UaAVC0M67t9C85UQ9v4oCmccK/96AHSQ2KtGuFEjltKkCmYaK/2KNAlEgAZrlmtJW7YiVkwda7WnecqKeX8UOMo+VI9YOVgokEZQAF6dNaSWyg0xD3DVUIDk4PmSV7Nm/QozZMV6AXhlnxV4PIQvY9KX/E0+SWOKzmrCr96vABHD1IS4K5A72CjLYQR7C7ZRNFYgCuSLQEnJF0Uhh74JFFIgCUSAdoSkQBaJAFMgWgZXjhHeQBbNQ0RZff/769V609sOXzf4epHegijm94vuH3hmyi8bDCZAQgAK5A7GClBUdhIpVgcRUo0AUSNkdJEbFc1orEAWiQHqXdO8gt+g4Ym3ZQu9X5+wJsajsIHYQO4gdZL5q2EHsIB8RQF8UPvurDH0Bqjg3HV+o33yp+GtJ9yLP7KP4aA7I693FR4HcIVdBBprUCr8RAfc+r8CExHHxoZgokB0EyLhUQQaa1Ao/QswKTEgcCqSBGm3VCoTS8NZPgQRxXF3ZFMhjL84KRIFcEaggQ0VBoXEGU/3bnO5FCxu9L9D9evnxku4lfagZBRK84FYolSZhmN2gQcXZKp6V6ZqkOlNMyF6jdFXwpLfm0r/uXjFqjACNfk7JQB4EjowvCmSLQEUOFEhgxHqFikjOQIsG2WtU0OwgwXFvBGj0c0qGiupVsSYhLcWE7DXKlwJRIFcEFMiWDApEgSiQThs5jUBGra71Ob2IP8N+9Gy0E1BMskciGv9qMlO80r8HobNlduIucVDSEjDpXpRgJMbRyxhZk8avQILjkAIh9Iz7ZOOsQOI5aHrQKktDWLkf3YsSjGKiQGLIOWLF8EoXvwLZQkoxyRb/aExHP4vlHWTN8yPVdTaJKshcsSbFyw5Ckbvzc8SKAflpL+mr1U+JSTtdy48mnPrF6DhnfZZYaJdbzQU0YimQ2Ex9FlKOnoBpXuekeWulQHZQexZQ7CCE8jGfZ+GCHSSQV9oJqF8gtGnTs8SiQOwgVwTOQkpHrP06kv6KRWfVZ6kajljTDQkbPgsXHLECKaadgPoFQps2PUssTyOQ1l93P9MB6HPtM5CBduMeJvTcLb/VT6srzzaqLM2/7q5ARtDNf04JO7/D/BMqITvxGcVOCwPFkvJZgYwymfA5TSrdmu5nB9kirkAoCwN+lLCBLW5M6X4KRIFcEaAtnpCWEpbsdeQpV4EoEAXy40dTdwpEgSgQBRJqzOnfg6weJ0KnnTCm8dNXkpWj3uj42R2Evn6dCRMFcscaBbKVUQXRKc4jkWd/rkAUyBUBO8jOHeTb9+/vUdVVVJRoDFX2tLI5Yq3pPFV5b61rB7GD2EE6qlMgCkSBKJD5xuyItWZUojjPZzLHsvmjJr3l6eHO5Nc63+r7FcUkJ/1zq1Tcr+i5aSxzJ925pLd+3F2BbBGgSa3Akiac+FFSVhQbGgs598XHDnKHXEVSFUhesVEgO2yilZuAqUBiZO6JvwJLklPaPewgO8hVJNUOEhMdzcERIbR8HbEcsYa8olWbEp36DQ8CDBSIAhnSRoEkzv2rx4ns5GWvd8GDrlkx3w/VEBw7yXojTGgHqfBDv3JLfxyZXrap6AjBKJlpcijBVu5H803zRs9W4adA7rKoQLa0ViCOWFcEFIgC+YiAHcQOMpzy7CB2EDtIRyYKRIEoEAWyiwD6HmTYk5MNVt4LKqolhYO++mX7VWBCY1yNpQK5Q7yCDKuTSslHfid99dlW76dAFMhwvKwoGlTECiR4HyJfBl58VlbL1Uml5FuJCY1xNZZ2EDuIHaTz1yYViAJRIApk25hXjhOrxwI6vqzEhMa4GkvUQSqeXSsOTtakP/BG9hr50Fiy/Wi+R+drfZ4d/yiO3vkUSGDEegWikMr9CufuiUSBjErIh89p9QpsMW1KY8n2UyDTKfvfkAK2+j09eKzf5pRcZK+RD40l24/me3Q+R6zA+ELBzE4eJReNv+dHY8n2y8Z4hFV2/KP9HLFGCDlidbunAgkQyBErCNYB84pK6iV9m5BuB2n9/yA0OZQPdD/qR+ZferYKP0J0GgftINm5Gd0Re+ejZ2j+9wcVhzvTvK1A5uVCyVXBIfrQQ8+gQBY8JMxTcd7SDjKP1ZFrgQJRIEOm0eprBxlCO29AwaR+jljzuVEgO1hlE2+UDrof9VMgo4z8/VyBKJArAvQSOE+3HEvvIDEcqcjRDyvGQpuzXpnwuYi2VhRk2uWoWLPjrMhNdoyjnNL9FMgI2Q+fU5AVyJpi00slzZ0CUSDD8dIOEiBJlWlFErJjpVXIDmIHOcxFBbKF0DvI4zFxxApI2w7yeMKuLhrom/SKyxAdQ3qxZK+5Ojk0fhpnC0taGAK1Z9p0NSYKZDo1/d82PFPRUCB5nU6BKJAhAnaQHYhoFaJg0tbpiJVXLR2xtgjYQYb186/BsxQNGqcCUSBXBEino8Qje10CpV2VxqlAFIgCCXTMP6ZU4GCrocvqonGa70GGyACD7MTSylzxJWj22XodqyJ++upHBQLo89tFgQSQUyD1DwKXHaggK4qGAlEgVwRaBYASNgDtjSndT4EEEc8GzA5iBwlS8NzmCiSWHzvIzivWz1+/3mMwPo+1AonlSoEokBhj7qwdsT7hiNX606OHmLTQeeWznwKJCaTisr06B80fNVnI8UNbKZBD8N04Z49YCiQvN3glBYKh2zgqkJ07iCPWPMFWt/deZNkPEJe9FIgCmVfDjqUC8Q5yiECPcHbEykPdDmIHOcQmO4gd5IoAJcMhBjac6WsImeHpuSvuBBRLeobWfhX4k9xQPEZ+PbzSf6NwFAz5vCJBrTUpuRQIyey+z2osFchOHhTIPKErCpQdZB7/oWVFghTIEParQQX+CmQe/6FlRYIUyBB2BXL5jULy30DPQ5tjqUBiONJ7lJf0wDNvNsixFN9aK5AYetm5q8D/pUesilcG+oVfNhlWJ67i3NmErsh3TPJ/rSvy3TsfGrEqAKsgCk0CGTXoXhXnViCxbCiQGF5N62cpDAoklnAFEsNLgdwhUFEYaEocsXaQy66INDkVRHHEimVDgSiQw98/ZBeUisIQk4WX9NP8oWZfsbYIKJAdVtDWX1EZaEUkiaUtnOx1wepZ9iN5pZiQvUY+FOeXfuYlCaJAkr0UyIjWeZ/TvCqQuxxQIBXIa45mCkSB5JXpF3weViAKRIF0EFAgCkSBKJB5DngHmcdqZEnvZaN1yec0ry/dQch3GvR5myaAJPuID30yP7Jn1LdCWDSvCiQwYj0DuUZkfIYzKJDELyZp5W4lgVYaGseI0NmfK5DYc7QdxA5yReAsIreD2EGyG8P0enYQO8gUWRyxtjDZQbaYOGI5Yjlivb01iyoSyFSJTjSiYwH1a4VeMRsnwnR4qVYHoeemDx69g9AuR7mgQAK0okQJbPFQUwWSNGKtziJVP/Wzg9wiQAuDHWSRUijRqZ8CUSB/EHDECoicVtLAFg81dcRyxDr0YqNAYvp1xIrhha3pqET9HLEcsYYjFmbzYsfsKkWfERcfu7vdZy0MlAs9v+Yd5EwJp+/iZCRSIFu0CY6P4I8C2UGdgtJKoAJRIB8RsIPc8UGBKBAF0un/CkSBKBAFEroieAcJwXUuY+8gsYpPOuRnFsh/hUFzhMaoQOUAAAAASUVORK5CYII=" alt="扫码下载"></p>
</blockquote>
<h2 id="基础配置"><a href="#基础配置" class="headerlink" title="基础配置"></a>基础配置</h2><ul>
<li>代码热更新配置(可不配置);</li>
</ul>
<blockquote>
<p><img data-src="http://ww1.sinaimg.cn/large/8bbf0afbly1forvmdtezxj21r41084bn.jpg" alt="iOS"><br><img data-src="http://ww1.sinaimg.cn/large/8bbf0afbly1forvzfmss4j228g1huniw.jpg" alt="Android"></p>
</blockquote>
<ul>
<li>极光推送 appkey 配置</li>
</ul>
<blockquote>
<p><img data-src="http://ww1.sinaimg.cn/large/8bbf0afbly1forvmdt6kmj21ts0xen9o.jpg" alt="iOS"><br><img data-src="http://ww1.sinaimg.cn/large/8bbf0afbly1forvzfndrzj21q81hudzn.jpg" alt="Android"></p>
</blockquote>
<ul>
<li>后端服务器地址配置</li>
</ul>
<p>把在相应的服务地址填入对应环境中,设置 <code>SET_ENV</code> <code>DEV</code> 为开发地址 <code>APP</code> 为线上地址</p>
<blockquote>
<p><img data-src="http://ww1.sinaimg.cn/large/8bbf0afbly1forw8hqeqyj21ri1i4ard.jpg" alt="config"></p>
</blockquote>
<h2 id="仓库地址"><a href="#仓库地址" class="headerlink" title="仓库地址"></a>仓库地址</h2><p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3N0cmF3ZmVycnkvbG9zdHNlcnZlcg==">服务器地址 GitHub 地址,具体配置看文档<i class="fa fa-external-link-alt"></i></span></p>
<p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3N0cmF3ZmVycnkvbG9zdGFwcA==">App 地址,具体配置看文档<i class="fa fa-external-link-alt"></i></span></p>
<h1 id="个人博客"><a href="#个人博客" class="headerlink" title="个人博客"></a>个人博客</h1><h3 id="博客地址-https-cblog-ferryvip-com"><a href="#博客地址-https-cblog-ferryvip-com" class="headerlink" title="博客地址: https://cblog.ferryvip.com/"></a><strong>博客地址: <a href="https://cblog.ferryvip.com/"><code>https://cblog.ferryvip.com/</code></a></strong></h3>]]></content>
  </entry>
  <entry>
    <title>小型失物招领后端(Express 版本)</title>
    <url>/2018/02/24/%E5%B0%8F%E5%9E%8B%E5%A4%B1%E7%89%A9%E6%8B%9B%E9%A2%86%E5%90%8E%E7%AB%AF(Express%20%E7%89%88%E6%9C%AC)/</url>
    <content><![CDATA[<h1 id="小型失物招领后端-Express-版本"><a href="#小型失物招领后端-Express-版本" class="headerlink" title="小型失物招领后端(Express 版本)"></a>小型失物招领后端(Express 版本)</h1><h2 id="项目说明"><a href="#项目说明" class="headerlink" title="项目说明"></a>项目说明</h2><p>本身是搞 iOS 的后面入了 ReactNative 的坑,慢慢的就比较多的接触 JavaScript ,还有就是 JavaScript 慢慢的可以做的东西越来越多;<br>不仅可以做前端网页,还可以做移动端 App(ReactNative),还能做后端(Node.js),还有其他的;</p>
<p>这个失物招领是为了练手 Node.js,同时也为了配合这个写了个 App 前端(iOS 和 安卓),链接在后面也会放出了;</p>
<p>目前主要的 Feature:  </p>
<ol>
<li>用户登录注册;</li>
<li>基本的管理员权限管理;</li>
<li>失物招领信息发布,关注收藏,通知审核等;</li>
<li>管理员的基本功能的管理与审核;</li>
<li>极光推送对接,使内容实时推送给用户;</li>
</ol>
<h2 id="本地运行条件"><a href="#本地运行条件" class="headerlink" title="本地运行条件"></a>本地运行条件</h2><ul>
<li>MongoDB 数据库</li>
<li>Node.js 环境</li>
</ul>
<h2 id="基础配置"><a href="#基础配置" class="headerlink" title="基础配置"></a>基础配置</h2><ol>
<li>七牛配置<ol>
<li>七牛配置是为了保存图片到七牛;</li>
<li>申请相应的开发者账号,填入到 <code>config文件夹的config文件</code>;</li>
<li>配置错误,或未配置调用到会导致程序崩溃;</li>
</ol>
</li>
</ol>
<blockquote>
<p><img data-src="http://ww1.sinaimg.cn/large/8bbf0afbly1form5qgmtaj21x20yin26.jpg"><br><img data-src="http://ww1.sinaimg.cn/large/8bbf0afbly1form5qgpx8j21x013qn4q.jpg"></p>
</blockquote>
<ol start="2">
<li>极光配置<ol>
<li>使消息即使让用户知道;</li>
<li>申请相应的开发者账号,填入到 <code>config文件夹的config文件</code>;</li>
<li>配置错误,或未配置调用到会导致程序崩溃;</li>
</ol>
</li>
</ol>
<blockquote>
<p><img data-src="http://ww1.sinaimg.cn/large/8bbf0afbly1form5qgf31j21ui196jxm.jpg"></p>
</blockquote>
<h2 id="造一些假数据的"><a href="#造一些假数据的" class="headerlink" title="造一些假数据的"></a>造一些假数据的</h2><p>项目目录下执行 <code>node data.js</code> 两次就行;</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">超级管理员</span><br><span class="line">用户名: admin@163.com</span><br><span class="line">密码: 123456</span><br><span class="line">其他的用户: user[1 - 10]@163.com 密码: 123456</span><br></pre></td></tr></table></figure>
<h2 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h2><ul>
<li><p>本地启动 </p>
<ol>
<li>首先启动本地 MongoDB 数据库,项目目录下执行 <code>npm run mongo</code> 数据库跑默认的段口;</li>
<li>项目目录下执行 <code>npm start</code> 启动;</li>
<li><span class="exturl" data-url="aHR0cDovL2xvY2FsaG9zdDo1NTY2L2RvY3M=">就可以打开文档 http://localhost:5566/docs<i class="fa fa-external-link-alt"></i></span></li>
</ol>
</li>
<li><p>服务器部署(主要使用 <code>pm2</code> 部署)</p>
<ol>
<li>服务器安装 <code>node</code> <code>pm2</code> <code>MongoDB</code> 环境等; </li>
<li>项目目录下执行 <ol>
<li>测试 <code>pm2 start dev.json</code></li>
<li>正式 <code>pm2 start dev.json</code></li>
</ol>
</li>
<li>查看日志 <code>pm2 logs</code></li>
</ol>
</li>
</ul>
<h2 id="对应的客户端"><a href="#对应的客户端" class="headerlink" title="对应的客户端"></a>对应的客户端</h2><ul>
<li>目前就只做了 App 端,按理说目前接口基本可以做个网页前端的,微信公众号以及小程序,在做些修改也是应该可以的;</li>
</ul>
<h2 id="下载体验"><a href="#下载体验" class="headerlink" title="下载体验"></a>下载体验</h2><p>iOS 没有发布,下载安卓体验</p>
<p><span class="exturl" data-url="aHR0cHM6Ly9maXIuaW0vY3B0MQ==">安卓 fir.im 下载<i class="fa fa-external-link-alt"></i></span></p>
<p>或者直接扫码下载</p>
<blockquote>
<p><img data-src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAYAAACtWK6eAAANMUlEQVR4Xu2dbXIbOQxEk5ulcgLvSTc3S1Uu4C1lK4qlGX7gDUCN5Je/Akiw0Q2AlO18/fb9+/uXJ/73748fKPp/3t52/bLXu2yyes3W2RBQRfHTWFb7fVUgt5CvJnMv4T2i9+JUIHkyUiB3WCqQLbkqMMmjcO1KCkSBDBmmQIYQndcgO3nZ63kHOS93ZiKzg9hBhjypKBrDTU9i0BQIBaXiXBWXVXI+evmtuFCvXpPkleaN7HXEpxenAgkgq0ACYH358kWBxPDC1hRo6tcKVIHEUpiNf2z3eWs7yA5Wjlh5z7mkoBD85ykfs1QgCmSKMdmktYNMwX7ciAJN/UhF7J1y9YW6YhQkWczGn8Qw42MHsYPM8AT/zBgpKNndauqADaN0gdAKVVFlK6rzEbD3fFeTIbty0/Uq/GhuKE/QM68CiaVJgcQeBM7ELwUS4zqyViAKBBHnoxNtgdTvcMCBBRSIAgnQZd+UEp36HQ44sIACUSABuiiQw2ANFqCX4+zXKBqHd5Dgs+uZgCbktoPYQQhvbnzoqETJl12lzhLH4UQEF6jIW3ZuLkeicb70K1Yv19lJUCBbtM/U+RVIsPIpkCBgDXNKPOpHo6b72UEo4nd+dhA7yBWB7Op7ZEY8CzHPEkeS3qeXoZWZ+k0HFihgn/ZnsbyDUDrN+1GiU7/5yG4t6X6OWBTxQIVaKdSk40wvQ4lH/aYDC+Tn03YQ+opCk0D8KsbVXhx0FMw+mwIJIkoBq/ALhn7IXIHELvcUbMqTlx6x7CBbOtlBYoJUILQkJfnZQWKEpbDbQXaQs4PYQf4goEAUyFRxdcSKdSxHrCla1Rk5YsUISzOxtIPQIKkfHZUI+SiQz+JHckC7Ds0bifGIT/r3IEeCIb4UaAVC0M67t9C85UQ9v4oCmccK/96AHSQ2KtGuFEjltKkCmYaK/2KNAlEgAZrlmtJW7YiVkwda7WnecqKeX8UOMo+VI9YOVgokEZQAF6dNaSWyg0xD3DVUIDk4PmSV7Nm/QozZMV6AXhlnxV4PIQvY9KX/E0+SWOKzmrCr96vABHD1IS4K5A72CjLYQR7C7ZRNFYgCuSLQEnJF0Uhh74JFFIgCUSAdoSkQBaJAFMgWgZXjhHeQBbNQ0RZff/769V609sOXzf4epHegijm94vuH3hmyi8bDCZAQgAK5A7GClBUdhIpVgcRUo0AUSNkdJEbFc1orEAWiQHqXdO8gt+g4Ym3ZQu9X5+wJsajsIHYQO4gdZL5q2EHsIB8RQF8UPvurDH0Bqjg3HV+o33yp+GtJ9yLP7KP4aA7I693FR4HcIVdBBprUCr8RAfc+r8CExHHxoZgokB0EyLhUQQaa1Ao/QswKTEgcCqSBGm3VCoTS8NZPgQRxXF3ZFMhjL84KRIFcEaggQ0VBoXEGU/3bnO5FCxu9L9D9evnxku4lfagZBRK84FYolSZhmN2gQcXZKp6V6ZqkOlNMyF6jdFXwpLfm0r/uXjFqjACNfk7JQB4EjowvCmSLQEUOFEhgxHqFikjOQIsG2WtU0OwgwXFvBGj0c0qGiupVsSYhLcWE7DXKlwJRIFcEFMiWDApEgSiQThs5jUBGra71Ob2IP8N+9Gy0E1BMskciGv9qMlO80r8HobNlduIucVDSEjDpXpRgJMbRyxhZk8avQILjkAIh9Iz7ZOOsQOI5aHrQKktDWLkf3YsSjGKiQGLIOWLF8EoXvwLZQkoxyRb/aExHP4vlHWTN8yPVdTaJKshcsSbFyw5Ckbvzc8SKAflpL+mr1U+JSTtdy48mnPrF6DhnfZZYaJdbzQU0YimQ2Ex9FlKOnoBpXuekeWulQHZQexZQ7CCE8jGfZ+GCHSSQV9oJqF8gtGnTs8SiQOwgVwTOQkpHrP06kv6KRWfVZ6kajljTDQkbPgsXHLECKaadgPoFQps2PUssTyOQ1l93P9MB6HPtM5CBduMeJvTcLb/VT6srzzaqLM2/7q5ARtDNf04JO7/D/BMqITvxGcVOCwPFkvJZgYwymfA5TSrdmu5nB9kirkAoCwN+lLCBLW5M6X4KRIFcEaAtnpCWEpbsdeQpV4EoEAXy40dTdwpEgSgQBRJqzOnfg6weJ0KnnTCm8dNXkpWj3uj42R2Evn6dCRMFcscaBbKVUQXRKc4jkWd/rkAUyBUBO8jOHeTb9+/vUdVVVJRoDFX2tLI5Yq3pPFV5b61rB7GD2EE6qlMgCkSBKJD5xuyItWZUojjPZzLHsvmjJr3l6eHO5Nc63+r7FcUkJ/1zq1Tcr+i5aSxzJ925pLd+3F2BbBGgSa3Akiac+FFSVhQbGgs598XHDnKHXEVSFUhesVEgO2yilZuAqUBiZO6JvwJLklPaPewgO8hVJNUOEhMdzcERIbR8HbEcsYa8olWbEp36DQ8CDBSIAhnSRoEkzv2rx4ns5GWvd8GDrlkx3w/VEBw7yXojTGgHqfBDv3JLfxyZXrap6AjBKJlpcijBVu5H803zRs9W4adA7rKoQLa0ViCOWFcEFIgC+YiAHcQOMpzy7CB2EDtIRyYKRIEoEAWyiwD6HmTYk5MNVt4LKqolhYO++mX7VWBCY1yNpQK5Q7yCDKuTSslHfid99dlW76dAFMhwvKwoGlTECiR4HyJfBl58VlbL1Uml5FuJCY1xNZZ2EDuIHaTz1yYViAJRIApk25hXjhOrxwI6vqzEhMa4GkvUQSqeXSsOTtakP/BG9hr50Fiy/Wi+R+drfZ4d/yiO3vkUSGDEegWikMr9CufuiUSBjErIh89p9QpsMW1KY8n2UyDTKfvfkAK2+j09eKzf5pRcZK+RD40l24/me3Q+R6zA+ELBzE4eJReNv+dHY8n2y8Z4hFV2/KP9HLFGCDlidbunAgkQyBErCNYB84pK6iV9m5BuB2n9/yA0OZQPdD/qR+ZferYKP0J0GgftINm5Gd0Re+ejZ2j+9wcVhzvTvK1A5uVCyVXBIfrQQ8+gQBY8JMxTcd7SDjKP1ZFrgQJRIEOm0eprBxlCO29AwaR+jljzuVEgO1hlE2+UDrof9VMgo4z8/VyBKJArAvQSOE+3HEvvIDEcqcjRDyvGQpuzXpnwuYi2VhRk2uWoWLPjrMhNdoyjnNL9FMgI2Q+fU5AVyJpi00slzZ0CUSDD8dIOEiBJlWlFErJjpVXIDmIHOcxFBbKF0DvI4zFxxApI2w7yeMKuLhrom/SKyxAdQ3qxZK+5Ojk0fhpnC0taGAK1Z9p0NSYKZDo1/d82PFPRUCB5nU6BKJAhAnaQHYhoFaJg0tbpiJVXLR2xtgjYQYb186/BsxQNGqcCUSBXBEino8Qje10CpV2VxqlAFIgCCXTMP6ZU4GCrocvqonGa70GGyACD7MTSylzxJWj22XodqyJ++upHBQLo89tFgQSQUyD1DwKXHaggK4qGAlEgVwRaBYASNgDtjSndT4EEEc8GzA5iBwlS8NzmCiSWHzvIzivWz1+/3mMwPo+1AonlSoEokBhj7qwdsT7hiNX606OHmLTQeeWznwKJCaTisr06B80fNVnI8UNbKZBD8N04Z49YCiQvN3glBYKh2zgqkJ07iCPWPMFWt/deZNkPEJe9FIgCmVfDjqUC8Q5yiECPcHbEykPdDmIHOcQmO4gd5IoAJcMhBjac6WsImeHpuSvuBBRLeobWfhX4k9xQPEZ+PbzSf6NwFAz5vCJBrTUpuRQIyey+z2osFchOHhTIPKErCpQdZB7/oWVFghTIEParQQX+CmQe/6FlRYIUyBB2BXL5jULy30DPQ5tjqUBiONJ7lJf0wDNvNsixFN9aK5AYetm5q8D/pUesilcG+oVfNhlWJ67i3NmErsh3TPJ/rSvy3TsfGrEqAKsgCk0CGTXoXhXnViCxbCiQGF5N62cpDAoklnAFEsNLgdwhUFEYaEocsXaQy66INDkVRHHEimVDgSiQw98/ZBeUisIQk4WX9NP8oWZfsbYIKJAdVtDWX1EZaEUkiaUtnOx1wepZ9iN5pZiQvUY+FOeXfuYlCaJAkr0UyIjWeZ/TvCqQuxxQIBXIa45mCkSB5JXpF3weViAKRIF0EFAgCkSBKJB5DngHmcdqZEnvZaN1yec0ry/dQch3GvR5myaAJPuID30yP7Jn1LdCWDSvCiQwYj0DuUZkfIYzKJDELyZp5W4lgVYaGseI0NmfK5DYc7QdxA5yReAsIreD2EGyG8P0enYQO8gUWRyxtjDZQbaYOGI5Yjlivb01iyoSyFSJTjSiYwH1a4VeMRsnwnR4qVYHoeemDx69g9AuR7mgQAK0okQJbPFQUwWSNGKtziJVP/Wzg9wiQAuDHWSRUijRqZ8CUSB/EHDECoicVtLAFg81dcRyxDr0YqNAYvp1xIrhha3pqET9HLEcsYYjFmbzYsfsKkWfERcfu7vdZy0MlAs9v+Yd5EwJp+/iZCRSIFu0CY6P4I8C2UGdgtJKoAJRIB8RsIPc8UGBKBAF0un/CkSBKBAFEroieAcJwXUuY+8gsYpPOuRnFsh/hUFzhMaoQOUAAAAASUVORK5CYII=" alt="扫码下载"></p>
</blockquote>
<h2 id="仓库地址"><a href="#仓库地址" class="headerlink" title="仓库地址"></a>仓库地址</h2><p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3N0cmF3ZmVycnkvbG9zdHNlcnZlcg==">服务器地址 GitHub 地址,具体配置看文档<i class="fa fa-external-link-alt"></i></span></p>
<p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3N0cmF3ZmVycnkvbG9zdGFwcA==">App 地址,具体配置看文档<i class="fa fa-external-link-alt"></i></span></p>
<h1 id="个人博客"><a href="#个人博客" class="headerlink" title="个人博客"></a>个人博客</h1><h3 id="博客地址-https-cblog-ferryvip-com"><a href="#博客地址-https-cblog-ferryvip-com" class="headerlink" title="博客地址: https://cblog.ferryvip.com/"></a><strong>博客地址: <a href="https://cblog.ferryvip.com/"><code>https://cblog.ferryvip.com/</code></a></strong></h3>]]></content>
  </entry>
  <entry>
    <title>小型失物招领后端(Koa 版本)</title>
    <url>/2018/03/12/%E5%B0%8F%E5%9E%8B%E5%A4%B1%E7%89%A9%E6%8B%9B%E9%A2%86%E5%90%8E%E7%AB%AF(Koa%20%E7%89%88%E6%9C%AC)/</url>
    <content><![CDATA[<h1 id="小型失物招领后端-Koa-版本"><a href="#小型失物招领后端-Koa-版本" class="headerlink" title="小型失物招领后端(Koa 版本)"></a>小型失物招领后端(Koa 版本)</h1><h2 id="项目说明"><a href="#项目说明" class="headerlink" title="项目说明"></a>项目说明</h2><p>本身是搞 iOS 的后面入了 ReactNative 的坑,慢慢的就比较多的接触 JavaScript ,还有就是 JavaScript 慢慢的可以做的东西越来越多;<br>不仅可以做前端网页,还可以做移动端 App(ReactNative),还能做后端(Node.js),还有其他的;</p>
<p>这个失物招领是为了练手 Node.js,同时也为了配合这个写了个 App 前端(iOS 和 安卓),链接在后面也会放出了;</p>
<p>目前主要的 Feature:  </p>
<ol>
<li>用户登录注册;</li>
<li>基本的管理员权限管理;</li>
<li>失物招领信息发布,关注收藏,通知审核等;</li>
<li>管理员的基本功能的管理与审核;</li>
<li>极光推送对接,使内容实时推送给用户;</li>
</ol>
<h2 id="本地运行条件"><a href="#本地运行条件" class="headerlink" title="本地运行条件"></a>本地运行条件</h2><ul>
<li>MongoDB 数据库</li>
<li>Node.js 环境</li>
</ul>
<h2 id="基础配置"><a href="#基础配置" class="headerlink" title="基础配置"></a>基础配置</h2><ol>
<li>七牛配置<ol>
<li>七牛配置是为了保存图片到七牛;</li>
<li>申请相应的开发者账号,填入到 <code>config文件夹的config文件</code>;</li>
<li>配置错误,或未配置调用到会导致程序崩溃;</li>
</ol>
</li>
</ol>
<blockquote>
<p><img data-src="http://ww1.sinaimg.cn/large/8bbf0afbly1form5qgmtaj21x20yin26.jpg"><br><img data-src="http://ww1.sinaimg.cn/large/8bbf0afbly1form5qgpx8j21x013qn4q.jpg"></p>
</blockquote>
<ol start="2">
<li>极光配置<ol>
<li>使消息即使让用户知道;</li>
<li>申请相应的开发者账号,填入到 <code>config文件夹的config文件</code>;</li>
<li>配置错误,或未配置调用到会导致程序崩溃;</li>
</ol>
</li>
</ol>
<blockquote>
<p><img data-src="http://ww1.sinaimg.cn/large/8bbf0afbly1form5qgf31j21ui196jxm.jpg"></p>
</blockquote>
<h2 id="造一些假数据的"><a href="#造一些假数据的" class="headerlink" title="造一些假数据的"></a>造一些假数据的</h2><p>项目目录下执行 <code>node data.js</code> 两次就行;</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">超级管理员</span><br><span class="line">用户名: admin@163.com</span><br><span class="line">密码: 123456</span><br><span class="line">其他的用户: user[1 - 10]@163.com 密码: 123456</span><br></pre></td></tr></table></figure>
<h2 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h2><ul>
<li><p>本地启动 </p>
<ol>
<li>首先启动本地 MongoDB 数据库,项目目录下执行 <code>npm run mongo</code> 数据库跑默认的段口;</li>
<li>项目目录下执行 <code>npm start</code> 启动;</li>
<li><span class="exturl" data-url="aHR0cDovL2xvY2FsaG9zdDo1NTY2L2RvY3M=">就可以打开文档 http://localhost:5566/docs/<i class="fa fa-external-link-alt"></i></span></li>
</ol>
</li>
<li><p>服务器部署(主要使用 <code>pm2</code> 部署)</p>
<ol>
<li>服务器安装 <code>node</code> <code>pm2</code> <code>MongoDB</code> 环境等; </li>
<li>项目目录下执行 <ol>
<li>测试 <code>pm2 start dev.json</code></li>
<li>正式 <code>pm2 start dev.json</code></li>
</ol>
</li>
<li>查看日志 <code>pm2 logs</code></li>
</ol>
</li>
</ul>
<h2 id="对应的客户端"><a href="#对应的客户端" class="headerlink" title="对应的客户端"></a>对应的客户端</h2><ul>
<li>目前就只做了 App 端,按理说目前接口基本可以做个网页前端的,微信公众号以及小程序,在做些修改也是应该可以的;</li>
</ul>
<h2 id="下载体验"><a href="#下载体验" class="headerlink" title="下载体验"></a>下载体验</h2><p>iOS 没有发布,下载安卓体验</p>
<p><span class="exturl" data-url="aHR0cHM6Ly9maXIuaW0vY3B0MQ==">安卓 fir.im 下载<i class="fa fa-external-link-alt"></i></span></p>
<p>或者直接扫码下载</p>
<blockquote>
<p><img data-src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAYAAACtWK6eAAANMUlEQVR4Xu2dbXIbOQxEk5ulcgLvSTc3S1Uu4C1lK4qlGX7gDUCN5Je/Akiw0Q2AlO18/fb9+/uXJ/73748fKPp/3t52/bLXu2yyes3W2RBQRfHTWFb7fVUgt5CvJnMv4T2i9+JUIHkyUiB3WCqQLbkqMMmjcO1KCkSBDBmmQIYQndcgO3nZ63kHOS93ZiKzg9hBhjypKBrDTU9i0BQIBaXiXBWXVXI+evmtuFCvXpPkleaN7HXEpxenAgkgq0ACYH358kWBxPDC1hRo6tcKVIHEUpiNf2z3eWs7yA5Wjlh5z7mkoBD85ykfs1QgCmSKMdmktYNMwX7ciAJN/UhF7J1y9YW6YhQkWczGn8Qw42MHsYPM8AT/zBgpKNndauqADaN0gdAKVVFlK6rzEbD3fFeTIbty0/Uq/GhuKE/QM68CiaVJgcQeBM7ELwUS4zqyViAKBBHnoxNtgdTvcMCBBRSIAgnQZd+UEp36HQ44sIACUSABuiiQw2ANFqCX4+zXKBqHd5Dgs+uZgCbktoPYQQhvbnzoqETJl12lzhLH4UQEF6jIW3ZuLkeicb70K1Yv19lJUCBbtM/U+RVIsPIpkCBgDXNKPOpHo6b72UEo4nd+dhA7yBWB7Op7ZEY8CzHPEkeS3qeXoZWZ+k0HFihgn/ZnsbyDUDrN+1GiU7/5yG4t6X6OWBTxQIVaKdSk40wvQ4lH/aYDC+Tn03YQ+opCk0D8KsbVXhx0FMw+mwIJIkoBq/ALhn7IXIHELvcUbMqTlx6x7CBbOtlBYoJUILQkJfnZQWKEpbDbQXaQs4PYQf4goEAUyFRxdcSKdSxHrCla1Rk5YsUISzOxtIPQIKkfHZUI+SiQz+JHckC7Ds0bifGIT/r3IEeCIb4UaAVC0M67t9C85UQ9v4oCmccK/96AHSQ2KtGuFEjltKkCmYaK/2KNAlEgAZrlmtJW7YiVkwda7WnecqKeX8UOMo+VI9YOVgokEZQAF6dNaSWyg0xD3DVUIDk4PmSV7Nm/QozZMV6AXhlnxV4PIQvY9KX/E0+SWOKzmrCr96vABHD1IS4K5A72CjLYQR7C7ZRNFYgCuSLQEnJF0Uhh74JFFIgCUSAdoSkQBaJAFMgWgZXjhHeQBbNQ0RZff/769V609sOXzf4epHegijm94vuH3hmyi8bDCZAQgAK5A7GClBUdhIpVgcRUo0AUSNkdJEbFc1orEAWiQHqXdO8gt+g4Ym3ZQu9X5+wJsajsIHYQO4gdZL5q2EHsIB8RQF8UPvurDH0Bqjg3HV+o33yp+GtJ9yLP7KP4aA7I693FR4HcIVdBBprUCr8RAfc+r8CExHHxoZgokB0EyLhUQQaa1Ao/QswKTEgcCqSBGm3VCoTS8NZPgQRxXF3ZFMhjL84KRIFcEaggQ0VBoXEGU/3bnO5FCxu9L9D9evnxku4lfagZBRK84FYolSZhmN2gQcXZKp6V6ZqkOlNMyF6jdFXwpLfm0r/uXjFqjACNfk7JQB4EjowvCmSLQEUOFEhgxHqFikjOQIsG2WtU0OwgwXFvBGj0c0qGiupVsSYhLcWE7DXKlwJRIFcEFMiWDApEgSiQThs5jUBGra71Ob2IP8N+9Gy0E1BMskciGv9qMlO80r8HobNlduIucVDSEjDpXpRgJMbRyxhZk8avQILjkAIh9Iz7ZOOsQOI5aHrQKktDWLkf3YsSjGKiQGLIOWLF8EoXvwLZQkoxyRb/aExHP4vlHWTN8yPVdTaJKshcsSbFyw5Ckbvzc8SKAflpL+mr1U+JSTtdy48mnPrF6DhnfZZYaJdbzQU0YimQ2Ex9FlKOnoBpXuekeWulQHZQexZQ7CCE8jGfZ+GCHSSQV9oJqF8gtGnTs8SiQOwgVwTOQkpHrP06kv6KRWfVZ6kajljTDQkbPgsXHLECKaadgPoFQps2PUssTyOQ1l93P9MB6HPtM5CBduMeJvTcLb/VT6srzzaqLM2/7q5ARtDNf04JO7/D/BMqITvxGcVOCwPFkvJZgYwymfA5TSrdmu5nB9kirkAoCwN+lLCBLW5M6X4KRIFcEaAtnpCWEpbsdeQpV4EoEAXy40dTdwpEgSgQBRJqzOnfg6weJ0KnnTCm8dNXkpWj3uj42R2Evn6dCRMFcscaBbKVUQXRKc4jkWd/rkAUyBUBO8jOHeTb9+/vUdVVVJRoDFX2tLI5Yq3pPFV5b61rB7GD2EE6qlMgCkSBKJD5xuyItWZUojjPZzLHsvmjJr3l6eHO5Nc63+r7FcUkJ/1zq1Tcr+i5aSxzJ925pLd+3F2BbBGgSa3Akiac+FFSVhQbGgs598XHDnKHXEVSFUhesVEgO2yilZuAqUBiZO6JvwJLklPaPewgO8hVJNUOEhMdzcERIbR8HbEcsYa8olWbEp36DQ8CDBSIAhnSRoEkzv2rx4ns5GWvd8GDrlkx3w/VEBw7yXojTGgHqfBDv3JLfxyZXrap6AjBKJlpcijBVu5H803zRs9W4adA7rKoQLa0ViCOWFcEFIgC+YiAHcQOMpzy7CB2EDtIRyYKRIEoEAWyiwD6HmTYk5MNVt4LKqolhYO++mX7VWBCY1yNpQK5Q7yCDKuTSslHfid99dlW76dAFMhwvKwoGlTECiR4HyJfBl58VlbL1Uml5FuJCY1xNZZ2EDuIHaTz1yYViAJRIApk25hXjhOrxwI6vqzEhMa4GkvUQSqeXSsOTtakP/BG9hr50Fiy/Wi+R+drfZ4d/yiO3vkUSGDEegWikMr9CufuiUSBjErIh89p9QpsMW1KY8n2UyDTKfvfkAK2+j09eKzf5pRcZK+RD40l24/me3Q+R6zA+ELBzE4eJReNv+dHY8n2y8Z4hFV2/KP9HLFGCDlidbunAgkQyBErCNYB84pK6iV9m5BuB2n9/yA0OZQPdD/qR+ZferYKP0J0GgftINm5Gd0Re+ejZ2j+9wcVhzvTvK1A5uVCyVXBIfrQQ8+gQBY8JMxTcd7SDjKP1ZFrgQJRIEOm0eprBxlCO29AwaR+jljzuVEgO1hlE2+UDrof9VMgo4z8/VyBKJArAvQSOE+3HEvvIDEcqcjRDyvGQpuzXpnwuYi2VhRk2uWoWLPjrMhNdoyjnNL9FMgI2Q+fU5AVyJpi00slzZ0CUSDD8dIOEiBJlWlFErJjpVXIDmIHOcxFBbKF0DvI4zFxxApI2w7yeMKuLhrom/SKyxAdQ3qxZK+5Ojk0fhpnC0taGAK1Z9p0NSYKZDo1/d82PFPRUCB5nU6BKJAhAnaQHYhoFaJg0tbpiJVXLR2xtgjYQYb186/BsxQNGqcCUSBXBEino8Qje10CpV2VxqlAFIgCCXTMP6ZU4GCrocvqonGa70GGyACD7MTSylzxJWj22XodqyJ++upHBQLo89tFgQSQUyD1DwKXHaggK4qGAlEgVwRaBYASNgDtjSndT4EEEc8GzA5iBwlS8NzmCiSWHzvIzivWz1+/3mMwPo+1AonlSoEokBhj7qwdsT7hiNX606OHmLTQeeWznwKJCaTisr06B80fNVnI8UNbKZBD8N04Z49YCiQvN3glBYKh2zgqkJ07iCPWPMFWt/deZNkPEJe9FIgCmVfDjqUC8Q5yiECPcHbEykPdDmIHOcQmO4gd5IoAJcMhBjac6WsImeHpuSvuBBRLeobWfhX4k9xQPEZ+PbzSf6NwFAz5vCJBrTUpuRQIyey+z2osFchOHhTIPKErCpQdZB7/oWVFghTIEParQQX+CmQe/6FlRYIUyBB2BXL5jULy30DPQ5tjqUBiONJ7lJf0wDNvNsixFN9aK5AYetm5q8D/pUesilcG+oVfNhlWJ67i3NmErsh3TPJ/rSvy3TsfGrEqAKsgCk0CGTXoXhXnViCxbCiQGF5N62cpDAoklnAFEsNLgdwhUFEYaEocsXaQy66INDkVRHHEimVDgSiQw98/ZBeUisIQk4WX9NP8oWZfsbYIKJAdVtDWX1EZaEUkiaUtnOx1wepZ9iN5pZiQvUY+FOeXfuYlCaJAkr0UyIjWeZ/TvCqQuxxQIBXIa45mCkSB5JXpF3weViAKRIF0EFAgCkSBKJB5DngHmcdqZEnvZaN1yec0ry/dQch3GvR5myaAJPuID30yP7Jn1LdCWDSvCiQwYj0DuUZkfIYzKJDELyZp5W4lgVYaGseI0NmfK5DYc7QdxA5yReAsIreD2EGyG8P0enYQO8gUWRyxtjDZQbaYOGI5Yjlivb01iyoSyFSJTjSiYwH1a4VeMRsnwnR4qVYHoeemDx69g9AuR7mgQAK0okQJbPFQUwWSNGKtziJVP/Wzg9wiQAuDHWSRUijRqZ8CUSB/EHDECoicVtLAFg81dcRyxDr0YqNAYvp1xIrhha3pqET9HLEcsYYjFmbzYsfsKkWfERcfu7vdZy0MlAs9v+Yd5EwJp+/iZCRSIFu0CY6P4I8C2UGdgtJKoAJRIB8RsIPc8UGBKBAF0un/CkSBKBAFEroieAcJwXUuY+8gsYpPOuRnFsh/hUFzhMaoQOUAAAAASUVORK5CYII=" alt="扫码下载"></p>
</blockquote>
<h2 id="仓库地址"><a href="#仓库地址" class="headerlink" title="仓库地址"></a>仓库地址</h2><p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3N0cmF3ZmVycnkvbG9zdHNlcnZlcg==">Express 版本 GitHub 地址,具体配置看文档<i class="fa fa-external-link-alt"></i></span></p>
<p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3N0cmF3ZmVycnkvb3Blbmxvc3Rrb2E=">Koa 版本 GitHub 地址,具体配置看文档<i class="fa fa-external-link-alt"></i></span></p>
<p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3N0cmF3ZmVycnkvbG9zdGFwcA==">App 地址,具体配置看文档<i class="fa fa-external-link-alt"></i></span></p>
<h1 id="个人博客"><a href="#个人博客" class="headerlink" title="个人博客"></a>个人博客</h1><h3 id="博客地址-https-cblog-ferryvip-com"><a href="#博客地址-https-cblog-ferryvip-com" class="headerlink" title="博客地址: https://cblog.ferryvip.com/"></a><strong>博客地址: <a href="https://cblog.ferryvip.com/"><code>https://cblog.ferryvip.com/</code></a></strong></h3>]]></content>
  </entry>
  <entry>
    <title>小红书分享工具开发</title>
    <url>/2025/01/17/%E5%B0%8F%E7%BA%A2%E4%B9%A6%E5%88%86%E4%BA%AB%E5%B7%A5%E5%85%B7%E5%BC%80%E5%8F%91/</url>
    <content><![CDATA[<h1 id="小红书分享"><a href="#小红书分享" class="headerlink" title="小红书分享"></a><span class="exturl" data-url="aHR0cHM6Ly94aWFvaG9uZ3NodXNoYXJlLm9ubGluZS8=">小红书分享<i class="fa fa-external-link-alt"></i></span></h1><p>起因是小红书大量涌入美国的 <code>tiktok</code> 难民,但是小红书的内容大部分都是中文,想着能不能用 AI 工具去翻译一下,顺便熟悉下当前最流行的 cursor 编辑器,然后就有了这个项目.</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/strawferry/GSS@master/uPic/20250123/14-12-29-3bDToi.png" alt="项目主页"></p>
<blockquote>
<p>这是一个使用  <code>cursor</code> 编辑器通过自然语言写出的 AI 工具集合,目前主要包含以下功能:</p>
</blockquote>
<ol>
<li>小红书中英文翻译;</li>
<li>AI 起中文名;</li>
<li>表情包内容解析;</li>
<li>小红书使用教程;</li>
<li>后续可能会再增加其他功能;</li>
</ol>
<h2 id="1-项目展示"><a href="#1-项目展示" class="headerlink" title="1. 项目展示"></a>1. 项目展示</h2><table>
<thead>
<tr>
<th align="center">小红书中英文翻译</th>
<th align="center">AI 起中文名</th>
<th align="center">表情包内容解析</th>
<th align="center">小红书使用教程</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><img data-src="https://cdn.jsdelivr.net/gh/strawferry/GSS@master/uPic/20250123/14-20-59-shotEasy-screencapture-xiaohongshushare-online.png" alt="14-20-59-shotEasy-screencapture-xiaohongshushare-online"></td>
<td align="center"><img data-src="https://cdn.jsdelivr.net/gh/strawferry/GSS@master/uPic/20250123/14-21-18-shotEasy-screencapture-xiaohongshushare-online%20(1).png" alt="14-21-18-shotEasy-screencapture-xiaohongshushare-online(1)"></td>
<td align="center"><img data-src="https://cdn.jsdelivr.net/gh/strawferry/GSS@master/uPic/20250123/14-21-32-shotEasy-screencapture-xiaohongshushare-online%20(2).png" alt="14-21-32-shotEasy-screencapture-xiaohongshushare-online(2)"></td>
<td align="center"><img data-src="https://cdn.jsdelivr.net/gh/strawferry/GSS@master/uPic/20250123/14-21-43-shotEasy-screencapture-xiaohongshushare-online%20(3).png" alt="14-21-43-shotEasy-screencapture-xiaohongshushare-online(3)"></td>
</tr>
</tbody></table>
<p><strong>在线访问: <span class="exturl" data-url="aHR0cHM6Ly94aWFvaG9uZ3NodXNoYXJlLm9ubGluZS8=">小红书分享<i class="fa fa-external-link-alt"></i></span></strong></p>
<p><strong>代码仓库: <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3N0cmF3ZmVycnkveGlhb2hvbmdzaHVzaGFyZQ==">xiaohongshushare<i class="fa fa-external-link-alt"></i></span></strong></p>
<h2 id="2-项目运行"><a href="#2-项目运行" class="headerlink" title="2. 项目运行"></a>2. 项目运行</h2><ol>
<li>安装依赖</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install --force</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>配置环境变量</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cp</span> .env.example .<span class="built_in">env</span></span><br><span class="line">// 重命名为 .<span class="built_in">env</span></span><br><span class="line">// 填入你的 DEEPSEEK_API_KEY 和 GEMINI_API_KEY</span><br><span class="line">// DEEPSEEK_API_KEY 翻译和起名字用到 GEMINI_API_KEY 识别图片用到</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>运行项目</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm run dev</span><br></pre></td></tr></table></figure>

<h2 id="3-cursor-的项目开发过程"><a href="#3-cursor-的项目开发过程" class="headerlink" title="3. cursor 的项目开发过程"></a>3. cursor 的项目开发过程</h2><p>访问仓库下的 <a href="/.specstory/history/%E5%B0%8F%E7%BA%A2%E4%B9%A6%E4%B8%AD%E8%8B%B1%E6%96%87%E7%BF%BB%E8%AF%91%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91.md">.specstory&#x2F;history&#x2F;小红书中英文翻译应用开发.md</a> 查看详细的开发过程.</p>
<hr>
<blockquote>
<p>项目一开始的产品说明文档</p>
</blockquote>
<h2 id="小红书中英文翻译"><a href="#小红书中英文翻译" class="headerlink" title="小红书中英文翻译"></a>小红书中英文翻译</h2><h2 id="主要功能点"><a href="#主要功能点" class="headerlink" title="主要功能点"></a>主要功能点</h2><ol>
<li>用户文本框中输入文本,通过 AI 对内容进行翻译;</li>
<li>翻译的输出格式分为两种显示,一种是直接整体翻译输出显示,另一种是根据内容段落,分为原内容一段,翻译内容换行一段,交叉显示,有点像双语字幕的形式;</li>
<li>翻译内容可以做点击语音播报出来;</li>
<li>翻译历史展示,翻译数据存储起来;</li>
</ol>
<h2 id="技术选型"><a href="#技术选型" class="headerlink" title="技术选型"></a>技术选型</h2><ol>
<li>使用 nextjs 的全栈模式去开发功能;</li>
<li>使用 DeepSeek 大语言模型对内容做 AI 翻译; <span class="exturl" data-url="aHR0cHM6Ly9hcGktZG9jcy5kZWVwc2Vlay5jb20vemgtY24v">api 开发文档<i class="fa fa-external-link-alt"></i></span></li>
<li>部署到 vercel 上面,数据库使用 vercel-postgres 存储</li>
</ol>
]]></content>
  </entry>
  <entry>
    <title>微信小程序开发 Jenkins 合并代码提交体验版本</title>
    <url>/2019/02/22/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%BC%80%E5%8F%91%20Jenkins%20%E5%90%88%E5%B9%B6%E4%BB%A3%E7%A0%81%E6%8F%90%E4%BA%A4%E4%BD%93%E9%AA%8C%E7%89%88%E6%9C%AC/</url>
    <content><![CDATA[<h1 id="微信小程序开发-Jenkins-合并代码提交体验版本"><a href="#微信小程序开发-Jenkins-合并代码提交体验版本" class="headerlink" title="微信小程序开发 Jenkins 合并代码提交体验版本"></a>微信小程序开发 Jenkins 合并代码提交体验版本</h1><h2 id="1-起因"><a href="#1-起因" class="headerlink" title="1. 起因"></a>1. 起因</h2><p>最近公司项目在做小程序开发,有多个小伙伴一起开发,测试的小伙伴也要加入测试,为了做到敏捷开发,我这个懒人就在想有啥办法可以做到这点,最后发现微信的小程序工具提供<span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXJzLndlaXhpbi5xcS5jb20vbWluaXByb2dyYW0vZGV2L2RldnRvb2xzL2NsaS5odG1s">命令行调用<i class="fa fa-external-link-alt"></i></span>,查看其文档发现了新大陆,也就有了这篇文章;</p>
<h2 id="2-流程"><a href="#2-流程" class="headerlink" title="2. 流程"></a>2. 流程</h2><ol>
<li>开发人员开发后代码推到 git 仓库;</li>
<li>测试人员或开发触发 Jenkins 构建;</li>
<li>通过微信的工具上传微信小程序最新代码,并通过钉钉机器人通知打包成功;</li>
<li>测试就可以打开微信小程序的体验版开始体验最新的修改;</li>
</ol>
<p><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1g0ge56olm3j217m0loacj.jpg"></p>
<h2 id="3-Jenkins-配置"><a href="#3-Jenkins-配置" class="headerlink" title="3. Jenkins 配置"></a>3. Jenkins 配置</h2><p><strong>1.</strong> 配置参数化构建, 主要是配置了 接口请求环境,和打包的 Git 分支</p>
<p><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1g0gek8npfvj21ho14adk3.jpg"></p>
<p><strong>2.</strong> Git 配置</p>
<p><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1g0gem3ja0vj21i60v8q6p.jpg"></p>
<p><strong>3.</strong> Build 执行 shell 脚本</p>
<p><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1g0gena00thj21ik0s4adu.jpg"></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo ------------ 构建分支 --------------</span><br><span class="line">echo $BRANCH </span><br><span class="line">echo ------------ 打包环境 --------------</span><br><span class="line">echo $ENV</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">导入 node 环境</span></span><br><span class="line">export PATH=$PATH:/usr/local/bin </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">执行 接口请求环境的 替换操作</span></span><br><span class="line">node env.js $ENV</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">上传最新修改到微信小程序</span></span><br><span class="line">/Applications/wechatwebdevtools.app/Contents/MacOS/cli -u 1.0.0@$PWD --upload-desc &#x27;Jenkins 小程序更新最新代码了,快去体验版查看&#x27;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">上传成功后发送钉钉通知</span></span><br><span class="line">node index.js $ENV $BRANCH</span><br></pre></td></tr></table></figure>

<h2 id="4-微信开发工具配置"><a href="#4-微信开发工具配置" class="headerlink" title="4. 微信开发工具配置"></a>4. 微信开发工具配置</h2><ol>
<li>微信开发工具登录并打开设置里面安全的服务端口,还有就是微信版本管理把这个上传的微信版本选为体验版,这样下次再上传上去体验版就可以下载最新的上传修改了;</li>
</ol>
<blockquote>
<p>本人手上是有一台 Mac 电脑专门用来打包 App 的,所以只讲了 Mac 的,但道理是差不多一样的,可以自己折腾 Windows 的系统,要在这台打包电脑安装 <code>Jenkins</code> 还有 <code>微信开发工具</code>;(因为自己脚本写的太差了,所以有两个地方用到了 <code>node</code> 来实现,所以还安装了 <code>node</code> 环境);</p>
</blockquote>
<p><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1g0ggb5q8r8j227i1psqmv.jpg"></p>
<h2 id="钉钉设置机器人"><a href="#钉钉设置机器人" class="headerlink" title="钉钉设置机器人"></a>钉钉设置机器人</h2><p><span class="exturl" data-url="aHR0cHM6Ly9nYmxvZy5mZXJyeXZpcC5jb20vMjAxOC8wMi8yNi9Mb2c0anMlMjAtJTIwQXBwZW5kZXJzJTIwJUU1JUJDJTgwJUU1JThGJTkxLCVFNiVCNiU4OCVFNiU4MSVBRiVFNyU5QiVCNCVFNSU4RiU5MSVFOSU5MiU4OSVFOSU5MiU4OSVFNiU5QyVCQSVFNSU5OSVBOCVFNCVCQSVCQS8=">之前我已经写了几个涉及钉钉机器人的配置,直接看之前的配置<i class="fa fa-external-link-alt"></i></span></p>
<p>配置完成后,获取里面的 token</p>
<h2 id="5-主要代码配置"><a href="#5-主要代码配置" class="headerlink" title="5. 主要代码配置"></a>5. 主要代码配置</h2><p><strong>1.</strong> 配置环境的文件 <code>&#39;./config/index.js&#39;</code> </p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 全局配置文件</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable constant_">HOST</span> = <span class="string">&#x27;&#x27;</span>, <span class="variable constant_">USERHOST</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable constant_">ENV</span> = <span class="string">&#x27;DEV&#x27;</span>; <span class="comment">// 设置环境 测试 DEV, 正式环境 PROD</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable constant_">ENV</span> === <span class="string">&#x27;PROD&#x27;</span>) &#123;</span><br><span class="line">  <span class="comment">// 正式环境 host</span></span><br><span class="line">  <span class="variable constant_">HOST</span> = <span class="string">&#x27;https://api.prod.com&#x27;</span>;</span><br><span class="line">  <span class="variable constant_">USERHOST</span> = <span class="string">&#x27;https://user.prod.com&#x27;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="comment">// 测试环境 host</span></span><br><span class="line">  <span class="variable constant_">HOST</span> = <span class="string">&#x27;https://api.dev.com&#x27;</span>;</span><br><span class="line">  <span class="variable constant_">USERHOST</span> = <span class="string">&#x27;https://user.dev.com&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">ENV</span>: <span class="variable constant_">ENV</span>,</span><br><span class="line">  <span class="attr">HOST</span>: <span class="variable constant_">HOST</span>,</span><br><span class="line">  <span class="attr">USERHOST</span>: <span class="variable constant_">USERHOST</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>2.</strong> 替换接口环境的文件 <code>&#39;./env.js&#39;</code></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">ENV</span> = process.<span class="property">argv</span>[<span class="number">2</span>];</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`/************* 替换环境为 <span class="subst">$&#123;ENV&#125;</span> 开始 *************/`</span>);</span><br><span class="line"><span class="comment">// 环境文本</span></span><br><span class="line"><span class="keyword">const</span> prodTep = <span class="string">`</span></span><br><span class="line"><span class="string">// 全局配置文件</span></span><br><span class="line"><span class="string">let HOST = &#x27;&#x27;, USERHOST = &#x27;&#x27;;</span></span><br><span class="line"><span class="string">let ENV = &#x27;<span class="subst">$&#123;ENV&#125;</span>&#x27;; // 设置环境 测试 DEV, 正式环境 PROD</span></span><br><span class="line"><span class="string">if (ENV === &#x27;PROD&#x27;) &#123;</span></span><br><span class="line"><span class="string">  // 正式环境 host</span></span><br><span class="line"><span class="string">  HOST = &#x27;https://api.prod.com&#x27;;</span></span><br><span class="line"><span class="string">  USERHOST = &#x27;https://user.prod.com&#x27;;</span></span><br><span class="line"><span class="string">&#125; else &#123;</span></span><br><span class="line"><span class="string">  // 测试环境 host</span></span><br><span class="line"><span class="string">  HOST = &#x27;https://api.dev.com&#x27;;</span></span><br><span class="line"><span class="string">  USERHOST = &#x27;https://user.dev.com&#x27;;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">module.exports = &#123;</span></span><br><span class="line"><span class="string">  ENV: ENV,</span></span><br><span class="line"><span class="string">  HOST: HOST,</span></span><br><span class="line"><span class="string">  USERHOST: USERHOST,</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line">process.<span class="title function_">chdir</span>(<span class="string">`./config`</span>); <span class="comment">// cd $1</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`/************* 前往 config 文件夹,并替换写入文件 *************/`</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(prodTep);</span><br><span class="line">fs.<span class="title function_">writeFileSync</span>(<span class="string">&#x27;index.js&#x27;</span>, prodTep);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`/************* 替换环境为 <span class="subst">$&#123;ENV&#125;</span> 成功 *************/`</span>);</span><br><span class="line">process.<span class="title function_">exit</span>(<span class="number">0</span>);</span><br></pre></td></tr></table></figure>
<p><strong>3.</strong> 发送钉钉消息的文件 <code>&#39;./index.js&#39;</code></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="variable constant_">ENV</span> = process.<span class="property">argv</span>[<span class="number">2</span>];</span><br><span class="line"><span class="keyword">const</span> branch = process.<span class="property">argv</span>[<span class="number">3</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ddtoken = <span class="string">&#x27;you-dingding-token&#x27;</span>; <span class="comment">// 钉钉机器人 token</span></span><br><span class="line"><span class="keyword">const</span> qrurl = <span class="string">&#x27;you-qrcode-url&#x27;</span>;  <span class="comment">// 微信体验版的 二维码地址</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> tokens = [</span><br><span class="line">  wscUrl,</span><br><span class="line">];</span><br><span class="line"><span class="keyword">const</span> env = <span class="variable constant_">ENV</span> === <span class="string">&#x27;PROD&#x27;</span> ? <span class="string">&#x27;正式环境&#x27;</span> : <span class="string">&#x27;测试环境&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> exec = <span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>).<span class="property">exec</span>;</span><br><span class="line"><span class="comment">//  git 最近 5 条修改的 commit 信息</span></span><br><span class="line"><span class="keyword">const</span> str = <span class="string">`git log -5 --date=format:&#x27;%Y-%m-%d %H:%M:%S&#x27; --pretty=format:&quot;* %cd - %s &quot;`</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">runExec</span>(<span class="params">cmdStr</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">exec</span>(cmdStr, <span class="keyword">function</span> (<span class="params">err, stdout, stderr</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;runExec error:&#x27;</span> + stderr);</span><br><span class="line">        <span class="title function_">reject</span>();</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// console.log(stdout);</span></span><br><span class="line">        <span class="title function_">resolve</span>(stdout);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> gitlog = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="title function_">runExec</span>(str).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; tokens.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">let</span> token = tokens[i];</span><br><span class="line">    gitlog = res;</span><br><span class="line">    <span class="title function_">sendDing</span>(token, gitlog)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">sendDing</span>(<span class="params">token, gitlog</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> https = <span class="built_in">require</span>(<span class="string">&#x27;https&#x27;</span>);</span><br><span class="line">  <span class="keyword">var</span> options = &#123;</span><br><span class="line">    <span class="attr">hostname</span>: <span class="string">&quot;oapi.dingtalk.com&quot;</span>, <span class="comment">// 呼叫的域名</span></span><br><span class="line">    <span class="attr">port</span>: <span class="number">443</span>,				<span class="comment">// 端口固定</span></span><br><span class="line">    <span class="attr">path</span>: <span class="string">`/robot/send?access_token=<span class="subst">$&#123;token&#125;</span>`</span>,				<span class="comment">// 请求的api名称</span></span><br><span class="line">    <span class="attr">method</span>: <span class="string">&quot;POST&quot;</span>,			<span class="comment">// get和post请求</span></span><br><span class="line">    <span class="attr">json</span>: <span class="literal">true</span>,				<span class="comment">// 此地方表示json</span></span><br><span class="line">    <span class="attr">rejectUnauthorized</span>: <span class="literal">true</span>,  <span class="comment">//请校验服务器证书，否则ssl没有意义。</span></span><br><span class="line">    <span class="attr">headers</span>: &#123;</span><br><span class="line">      <span class="string">&#x27;Accept&#x27;</span>: <span class="string">&#x27;application/json;version=2.0&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>,             <span class="comment">//此地方和json很有关联，需要注意</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">var</span> post_data = &#123;</span><br><span class="line">    <span class="string">&quot;msgtype&quot;</span>: <span class="string">&quot;markdown&quot;</span>,</span><br><span class="line">    <span class="string">&quot;markdown&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;title&quot;</span>: <span class="string">&quot;小程序新包更新&quot;</span>,</span><br><span class="line">      <span class="string">&quot;text&quot;</span>: <span class="string">`# 小程序新包发布 \n \n &gt; 分支: <span class="subst">$&#123;branch&#125;</span> \n \n &gt; 服务器环境: <span class="subst">$&#123;env&#125;</span> \n \n &gt; 更新内容: \n \n <span class="subst">$&#123;gitlog&#125;</span>  \n \n &gt; 微信扫码体验小程序: ![](<span class="subst">$&#123;qrurl&#125;</span>)`</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">var</span> json = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(post_data);</span><br><span class="line">  <span class="keyword">var</span> req = https.<span class="title function_">request</span>(options, <span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">    res.<span class="title function_">setEncoding</span>(<span class="string">&#x27;utf8&#x27;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  req.<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;problem with request: &#x27;</span> + e.<span class="property">message</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  req.<span class="title function_">write</span>(json);</span><br><span class="line">  req.<span class="title function_">end</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="6-最终钉钉消息效果"><a href="#6-最终钉钉消息效果" class="headerlink" title="6. 最终钉钉消息效果"></a>6. 最终钉钉消息效果</h2><p><img data-src="https://ws1.sinaimg.cn/large/8bbf0afbly1g0ggu8vrcsj20ui1catej.jpg"></p>
<h2 id="地址"><a href="#地址" class="headerlink" title="地址"></a>地址</h2><blockquote>
<p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3N0cmF3ZmVycnkvd2VhcHBqZW5raW5z">GitHub 仓库地址<i class="fa fa-external-link-alt"></i></span></p>
</blockquote>
<h2 id="个人博客"><a href="#个人博客" class="headerlink" title="个人博客"></a>个人博客</h2><p><strong>博客地址:</strong><br><span class="exturl" data-url="aHR0cHM6Ly9nYmxvZy5mZXJyeXZpcC5jb20v">https://gblog.ferryvip.com/<i class="fa fa-external-link-alt"></i></span> </p>
]]></content>
  </entry>
  <entry>
    <title>MacMini M4 本地部署运行 DeepSeek R1 大模型</title>
    <url>/2025/02/03/%E6%9C%AC%E5%9C%B0%E9%83%A8%E7%BD%B2%E8%BF%90%E8%A1%8C%20DeepSeek%20R1%20%E5%A4%A7%E6%A8%A1%E5%9E%8B/</url>
    <content><![CDATA[<h1 id="MacMini-M4-本地部署运行-DeepSeek-R1-大模型"><a href="#MacMini-M4-本地部署运行-DeepSeek-R1-大模型" class="headerlink" title="MacMini M4 本地部署运行 DeepSeek R1 大模型"></a>MacMini M4 本地部署运行 DeepSeek R1 大模型</h1><h3 id="一、模型介绍"><a href="#一、模型介绍" class="headerlink" title="一、模型介绍"></a><strong>一、模型介绍</strong></h3><p>DeepSeek R1 是由 DeepSeek 公司开发的一款基于 LLaMA 模型的开源大模型，它在多个基准测试中表现出色，包括 GSM8K、MATH、ARC、BBH 等。</p>
<p>下面介绍我们在自己的机器上部署该大模型。</p>
<h3 id="二、部署工具"><a href="#二、部署工具" class="headerlink" title="二、部署工具"></a><strong>二、部署工具</strong></h3><p>推荐使用 <strong>Ollama</strong> 框架，它支持 macOS 的本地模型管理，并简化了依赖安装流程：</p>
<ol>
<li><p><strong>安装 Ollama</strong></p>
<ol>
<li><strong>官网下载安装</strong><br><img data-src="https://cdn.jsdelivr.net/gh/strawferry/GSS@master/uPic/20250203/22-54-56-LyWVLd.png" alt="官网下载安装"></li>
<li>在终端执行命令一键安装：</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">curl -fsSL https://ollama.com/install.sh | sh</span><br></pre></td></tr></table></figure>

<p>验证安装：<code>ollama -v</code> 。</p>
</li>
<li><p><strong>下载模型</strong><br>运行命令下载 7B 模型：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ollama run deepseek-r1:7b</span><br></pre></td></tr></table></figure></li>
</ol>
<p><img data-src="https://cdn.jsdelivr.net/gh/strawferry/GSS@master/uPic/20250203/23-02-46-%E4%B8%8B%E8%BD%BD%E6%89%A7%E8%A1%8C.png" alt="23-02-46-下载执行"><br>   模型将自动下载至本地（约 4.7GB）。</p>
<hr>
<h3 id="三、交互方式"><a href="#三、交互方式" class="headerlink" title="三、交互方式"></a><strong>三、交互方式</strong></h3><ol>
<li><p><strong>终端直接对话</strong><br>运行 <code>ollama run deepseek-r1:7b</code> 后输入问题即可，退出输入 <code>/bye</code> 。<br><img data-src="https://cdn.jsdelivr.net/gh/strawferry/GSS@master/uPic/20250203/23-03-12-%E5%91%BD%E4%BB%A4%E8%A1%8C%E8%BF%90%E8%A1%8C.png" alt="23-03-12-命令行运行"></p>
</li>
<li><p><strong>Web 界面（推荐）</strong><br>使用 <strong>Open WebUI</strong> 提供类似 ChatGPT 的图形界面：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker run -d -p 3000:8080 \</span><br><span class="line">  --add-host=host.docker.internal:host-gateway \</span><br><span class="line">  -v open-webui:/app/backend/data \</span><br><span class="line">  --name open-webui \</span><br><span class="line">  --restart unless-stopped \</span><br><span class="line">  ghcr.io/open-webui/open-webui:main</span><br></pre></td></tr></table></figure></li>
</ol>
<p><img data-src="https://cdn.jsdelivr.net/gh/strawferry/GSS@master/uPic/20250203/23-04-22-OpoPzc.png" alt="docker 启动 OpenWebUI"><br>   访问 <code>http://localhost:3000</code>，选择 <code>deepseek-r1:7b</code> 即可使用。</p>
<blockquote>
<p>OpenWebUI初始化界面<br><img data-src="https://cdn.jsdelivr.net/gh/strawferry/GSS@master/uPic/20250203/23-12-54-Vz7O4L.png" alt="OpenWebUI初始化界面"></p>
</blockquote>
<blockquote>
<p>创建管理员账号<br><img data-src="https://cdn.jsdelivr.net/gh/strawferry/GSS@master/uPic/20250203/23-14-11-ZvdplU.png" alt="创建管理员账号"></p>
</blockquote>
<blockquote>
<p>选择模型开始对话<br><img data-src="https://cdn.jsdelivr.net/gh/strawferry/GSS@master/uPic/20250203/23-15-55-BAkNT6.png" alt="选择模型开始对话"></p>
</blockquote>
<blockquote>
<p>模型对话<br><img data-src="https://cdn.jsdelivr.net/gh/strawferry/GSS@master/uPic/20250203/23-21-00-SGCgjk.png" alt="模型对话"></p>
</blockquote>
<blockquote>
<p>本地模型速度<br><img data-src="https://cdn.jsdelivr.net/gh/strawferry/GSS@master/uPic/20250203/23-21-58-vQboLy.png" alt="本地模型速度"></p>
</blockquote>
<hr>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>通过 Ollama 框架，我们可以方便地在本地部署和运行 DeepSeek R1 大模型，实现高效的交互体验。在 MacMini M4 16GB 内存最低配的机器上,发现模型运行速度还是很不错的,基本可以满足日常使用。</p>
]]></content>
      <tags>
        <tag>DeepSeek R1, 大模型, 本地部署, OpenWebUI, 本地运行</tag>
      </tags>
  </entry>
</search>
